\hypertarget{a00227_source}{}\doxysection{nanort.\+h}
\label{a00227_source}\index{Cpp/raytracer/src/nanort.h@{Cpp/raytracer/src/nanort.h}}
\mbox{\hyperlink{a00227}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{a00227_source_l00001}00001 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00002}00002 \textcolor{comment}{// NanoRT, single header only modern ray tracing kernel.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00003}00003 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00005}00005 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00006}00006 \textcolor{comment}{// Notes : The number of primitives are up to 2G. If you want to render large}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00007}00007 \textcolor{comment}{// data, please split data into chunks(\string~ 2G prims) and use NanoSG scene graph}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00008}00008 \textcolor{comment}{// library(`\$\{nanort\}/examples/nanosg`).}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00009}00009 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00010}00010 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00011}00011 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00012}00012 \textcolor{comment}{The MIT License (MIT)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00013}00013 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00014}00014 \textcolor{comment}{Copyright (c) 2015 -\/ 2019 Light Transport Entertainment, Inc.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00015}00015 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00016}00016 \textcolor{comment}{Permission is hereby granted, free of charge, to any person obtaining a copy}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00017}00017 \textcolor{comment}{of this software and associated documentation files (the "{}Software"{}), to deal}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00018}00018 \textcolor{comment}{in the Software without restriction, including without limitation the rights}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00019}00019 \textcolor{comment}{to use, copy, modify, merge, publish, distribute, sublicense, and/or sell}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00020}00020 \textcolor{comment}{copies of the Software, and to permit persons to whom the Software is}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00021}00021 \textcolor{comment}{furnished to do so, subject to the following conditions:}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00022}00022 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00023}00023 \textcolor{comment}{The above copyright notice and this permission notice shall be included in}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00024}00024 \textcolor{comment}{all copies or substantial portions of the Software.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00025}00025 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00026}00026 \textcolor{comment}{THE SOFTWARE IS PROVIDED "{}AS IS"{}, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00027}00027 \textcolor{comment}{IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00028}00028 \textcolor{comment}{FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00029}00029 \textcolor{comment}{AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00030}00030 \textcolor{comment}{LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00031}00031 \textcolor{comment}{OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00032}00032 \textcolor{comment}{THE SOFTWARE.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00033}00033 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00035}00035 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00036}00036 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00037}00037 \textcolor{preprocessor}{\#ifndef NANORT\_H\_}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00038}\mbox{\hyperlink{a00227_aea82a5adc845e9b5799c245703456e24}{00038}} \textcolor{preprocessor}{\#define NANORT\_H\_}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00039}00039 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00040}00040 \textcolor{preprocessor}{\#undef min}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00041}00041 \textcolor{preprocessor}{\#undef max}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00042}00042 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00043}00043 \textcolor{preprocessor}{\#include <algorithm>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00044}00044 \textcolor{preprocessor}{\#include <cassert>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00045}00045 \textcolor{preprocessor}{\#include <cmath>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00046}00046 \textcolor{preprocessor}{\#include <cstdio>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00047}00047 \textcolor{preprocessor}{\#include <cstdlib>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00048}00048 \textcolor{preprocessor}{\#include <cstring>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00049}00049 \textcolor{preprocessor}{\#include <functional>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00050}00050 \textcolor{preprocessor}{\#include <limits>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00051}00051 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00052}00052 \textcolor{preprocessor}{\#include <queue>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00053}00053 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00054}00054 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00055}00055 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00056}00056 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00057}00057 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00058}00058 \textcolor{comment}{// compiler macros}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00059}00059 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00060}00060 \textcolor{comment}{// NANORT\_USE\_CPP11\_FEATURE : Enable C++11 feature}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00061}00061 \textcolor{comment}{// NANORT\_ENABLE\_PARALLEL\_BUILD : Enable parallel BVH build.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00062}00062 \textcolor{comment}{// NANORT\_ENABLE\_SERIALIZATION : Enable serialization feature for built BVH.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00063}00063 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00064}00064 \textcolor{comment}{// Parallelized BVH build is supported on C++11 thread version.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00065}00065 \textcolor{comment}{// OpenMP version is not fully tested.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00066}00066 \textcolor{comment}{// thus turn off if you face a problem when building BVH in parallel.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00067}00067 \textcolor{comment}{// \#define NANORT\_ENABLE\_PARALLEL\_BUILD}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00068}00068 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00069}00069 \textcolor{comment}{// Some constants}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00070}\mbox{\hyperlink{a00227_a02232012dcf3dea116113dd4fec7f95d}{00070}} \textcolor{preprocessor}{\#define kNANORT\_MAX\_STACK\_DEPTH (512)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00071}\mbox{\hyperlink{a00227_a0c674d5d198095296c8251eecfdb4377}{00071}} \textcolor{preprocessor}{\#define kNANORT\_MIN\_PRIMITIVES\_FOR\_PARALLEL\_BUILD (1024 * 8)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00072}\mbox{\hyperlink{a00227_aaa838182f89d868d24b4f3ddb0df6b81}{00072}} \textcolor{preprocessor}{\#define kNANORT\_SHALLOW\_DEPTH (4)  }\textcolor{comment}{// will create 2**N subtrees}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00073}00073 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00074}00074 \textcolor{preprocessor}{\#ifdef NANORT\_USE\_CPP11\_FEATURE}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00075}00075 \textcolor{comment}{// Assume C++11 compiler has thread support.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00076}00076 \textcolor{comment}{// In some situation (e.g. embedded system, JIT compilation), thread feature}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00077}00077 \textcolor{comment}{// may not be available though...}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00078}00078 \textcolor{preprocessor}{\#include <atomic>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00079}00079 \textcolor{preprocessor}{\#include <mutex>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00080}00080 \textcolor{preprocessor}{\#include <thread>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00081}00081 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00082}00082 \textcolor{preprocessor}{\#define kNANORT\_MAX\_THREADS (256)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00083}00083 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00084}00084 \textcolor{comment}{// Parallel build should work well for C++11 version, thus force enable it.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00085}00085 \textcolor{preprocessor}{\#ifndef NANORT\_ENABLE\_PARALLEL\_BUILD}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00086}00086 \textcolor{preprocessor}{\#define NANORT\_ENABLE\_PARALLEL\_BUILD}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00087}00087 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00088}00088 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00089}00089 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00090}00090 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00091}\mbox{\hyperlink{a00474}{00091}} \textcolor{keyword}{namespace }\mbox{\hyperlink{a00474}{nanort}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00092}00092 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00093}00093     \textcolor{comment}{// RayType}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00094}\mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661}{00094}}     \textcolor{keyword}{typedef} \textcolor{keyword}{enum} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00095}\mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661a26df8dc570dac0c6a8e2f0b1c5599035}{00095}}         \mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661a26df8dc570dac0c6a8e2f0b1c5599035}{RAY\_TYPE\_NONE}} = 0x0,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00096}\mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661afa98b1a81432b92a40f2fb253dc3a90a}{00096}}         \mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661afa98b1a81432b92a40f2fb253dc3a90a}{RAY\_TYPE\_PRIMARY}} = 0x1,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00097}\mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661a6be2832475a21a71054c96191824c846}{00097}}         \mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661a6be2832475a21a71054c96191824c846}{RAY\_TYPE\_SECONDARY}} = 0x2,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00098}\mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661ab3c3a5f9859b5578509fc75f6295cf6b}{00098}}         \mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661ab3c3a5f9859b5578509fc75f6295cf6b}{RAY\_TYPE\_DIFFUSE}} = 0x4,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00099}\mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661ac321bb5b2eb584854abd74cf63ad14d3}{00099}}         \mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661ac321bb5b2eb584854abd74cf63ad14d3}{RAY\_TYPE\_REFLECTION}} = 0x8,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00100}00100         \mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661a0da6cb6314b88bcad5b2e4bd4445789f}{RAY\_TYPE\_REFRACTION}} = 0x10}
\DoxyCodeLine{\Hypertarget{a00227_source_l00101}\mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661a0da6cb6314b88bcad5b2e4bd4445789f}{00101}}     \} \mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661}{RayType}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00102}00102 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00103}00103 \textcolor{preprocessor}{\#ifdef \_\_clang\_\_}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00104}00104 \textcolor{preprocessor}{\#pragma clang diagnostic push}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00105}00105 \textcolor{preprocessor}{\#if \_\_has\_warning("{}-\/Wzero-\/as-\/null-\/pointer-\/constant"{}})}
\DoxyCodeLine{\Hypertarget{a00227_source_l00106}00106 \textcolor{preprocessor}{\#pragma clang diagnostic ignored "{}-\/Wzero-\/as-\/null-\/pointer-\/constant"{}}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00107}00107 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00108}00108 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00109}00109 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00110}00110     \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00111}00111     \textcolor{comment}{// Small vector class useful for multi-\/threaded environment.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00112}00112     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00113}00113     \textcolor{comment}{// stack\_container.h}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00114}00114     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00115}00115     \textcolor{comment}{// Copyright (c) 2006-\/2008 The Chromium Authors. All rights reserved.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00116}00116     \textcolor{comment}{// Use of this source code is governed by a BSD-\/style license that can be}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00117}00117     \textcolor{comment}{// found in the LICENSE file.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00118}00118 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00119}00119     \textcolor{comment}{// This allocator can be used with STL containers to provide a stack buffer}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00120}00120     \textcolor{comment}{// from which to allocate memory and overflows onto the heap. This stack buffer}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00121}00121     \textcolor{comment}{// would be allocated on the stack and allows us to avoid heap operations in}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00122}00122     \textcolor{comment}{// some situations.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00123}00123     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00124}00124     \textcolor{comment}{// STL likes to make copies of allocators, so the allocator itself can't hold}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00125}00125     \textcolor{comment}{// the data. Instead, we make the creator responsible for creating a}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00126}00126     \textcolor{comment}{// StackAllocator::Source which contains the data. Copying the allocator}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00127}00127     \textcolor{comment}{// merely copies the pointer to this shared source, so all allocators created}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00128}00128     \textcolor{comment}{// based on our allocator will share the same stack buffer.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00129}00129     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00130}00130     \textcolor{comment}{// This stack buffer implementation is very simple. The first allocation that}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00131}00131     \textcolor{comment}{// fits in the stack buffer will use the stack buffer. Any subsequent}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00132}00132     \textcolor{comment}{// allocations will not use the stack buffer, even if there is unused room.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00133}00133     \textcolor{comment}{// This makes it appropriate for array-\/like containers, but the caller should}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00134}00134     \textcolor{comment}{// be sure to reserve() in the container up to the stack buffer size. Otherwise}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00135}00135     \textcolor{comment}{// the container will allocate a small array which will "{}use up"{} the stack}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00136}00136     \textcolor{comment}{// buffer.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00137}00137     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T, \textcolor{keywordtype}{size\_t} stack\_capacity>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00138}\mbox{\hyperlink{a01423}{00138}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01423}{StackAllocator}} : \textcolor{keyword}{public} std::allocator<T> \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00139}00139     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00140}\mbox{\hyperlink{a01423_a6397373387f6be6e360ce62d29cd97fa}{00140}}         \textcolor{keyword}{typedef} \textcolor{keyword}{typename} std::allocator<T>::pointer \mbox{\hyperlink{a01423_a6397373387f6be6e360ce62d29cd97fa}{pointer}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00141}\mbox{\hyperlink{a01423_a19e16d250851f2e0cc2b6bf1758ca4e5}{00141}}         \textcolor{keyword}{typedef} \textcolor{keyword}{typename} std::allocator<T>::size\_type \mbox{\hyperlink{a01423_a19e16d250851f2e0cc2b6bf1758ca4e5}{size\_type}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00142}00142 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00143}00143         \textcolor{comment}{// Backing store for the allocator. The container owner is responsible for}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00144}00144         \textcolor{comment}{// maintaining this for as long as any containers using this allocator are}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00145}00145         \textcolor{comment}{// live.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00146}\mbox{\hyperlink{a01427}{00146}}         \textcolor{keyword}{struct }\mbox{\hyperlink{a01427}{Source}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00147}\mbox{\hyperlink{a01427_a38ed74046bc9ec6d9d8c6f28b2ed93ee}{00147}}             \mbox{\hyperlink{a01427_a38ed74046bc9ec6d9d8c6f28b2ed93ee}{Source}}() : \mbox{\hyperlink{a01427_ae9ae5f1c043a2a5fcd6df58108e67182}{used\_stack\_buffer\_}}(false) \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00148}00148 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00149}00149             \textcolor{comment}{// Casts the buffer in its right type.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00150}\mbox{\hyperlink{a01427_a7b32e78fcb2d7476011e4222abbc1943}{00150}}             T* \mbox{\hyperlink{a01427_a7b32e78fcb2d7476011e4222abbc1943}{stack\_buffer}}() \{ \textcolor{keywordflow}{return} \textcolor{keyword}{reinterpret\_cast<}T*\textcolor{keyword}{>}(\mbox{\hyperlink{a01427_a305996e6c091358dcf5526b65b1889b2}{stack\_buffer\_}}); \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00151}\mbox{\hyperlink{a01427_a33fc79f562de8940c185880ec11384e4}{00151}}             \textcolor{keyword}{const} T* \mbox{\hyperlink{a01427_a33fc79f562de8940c185880ec11384e4}{stack\_buffer}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00152}00152                 \textcolor{keywordflow}{return} \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const }T*\textcolor{keyword}{>}(\mbox{\hyperlink{a01427_a305996e6c091358dcf5526b65b1889b2}{stack\_buffer\_}});}
\DoxyCodeLine{\Hypertarget{a00227_source_l00153}00153             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00154}00154 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00155}00155             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00156}00156             \textcolor{comment}{// IMPORTANT: Take care to ensure that stack\_buffer\_ is aligned}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00157}00157             \textcolor{comment}{// since it is used to mimic an array of T.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00158}00158             \textcolor{comment}{// Be careful while declaring any unaligned types (like bool)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00159}00159             \textcolor{comment}{// before stack\_buffer\_.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00160}00160             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00161}00161 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00162}00162             \textcolor{comment}{// The buffer itself. It is not of type T because we don't want the}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00163}00163             \textcolor{comment}{// constructors and destructors to be automatically called. Define a POD}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00164}00164             \textcolor{comment}{// buffer of the right size instead.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00165}\mbox{\hyperlink{a01427_a305996e6c091358dcf5526b65b1889b2}{00165}}             \textcolor{keywordtype}{char} \mbox{\hyperlink{a01427_a305996e6c091358dcf5526b65b1889b2}{stack\_buffer\_}}[\textcolor{keyword}{sizeof}(T[stack\_capacity])];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00166}00166 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00167}00167             \textcolor{comment}{// Set when the stack buffer is used for an allocation. We do not track}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00168}00168             \textcolor{comment}{// how much of the buffer is used, only that somebody is using it.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00169}\mbox{\hyperlink{a01427_ae9ae5f1c043a2a5fcd6df58108e67182}{00169}}             \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01427_ae9ae5f1c043a2a5fcd6df58108e67182}{used\_stack\_buffer\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00170}00170         \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00171}00171 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00172}00172         \textcolor{comment}{// Used by containers when they want to refer to an allocator of type U.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00173}00173         \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00174}\mbox{\hyperlink{a01423}{00174}}         \textcolor{keyword}{struct }\mbox{\hyperlink{a01423_a01431}{rebind}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00175}\mbox{\hyperlink{a01423_a698baf091fd2fa48069785c07d96a0bc}{00175}}             \textcolor{keyword}{typedef} \mbox{\hyperlink{a01423}{StackAllocator<U, stack\_capacity>}} \mbox{\hyperlink{a01423_a698baf091fd2fa48069785c07d96a0bc}{other}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00176}00176         \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00177}00177 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00178}00178         \textcolor{comment}{// For the straight up copy c-\/tor, we can share storage.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00179}\mbox{\hyperlink{a01423_abb6fcf8f97b38ce41e00019887efcbeb}{00179}}         \mbox{\hyperlink{a01423_abb6fcf8f97b38ce41e00019887efcbeb}{StackAllocator}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01423}{StackAllocator<T, stack\_capacity>}}\& rhs)}
\DoxyCodeLine{\Hypertarget{a00227_source_l00180}00180             : \mbox{\hyperlink{a01423_ad719f77abb3cff5d39872840de127cf0}{source\_}}(rhs.\mbox{\hyperlink{a01423_ad719f77abb3cff5d39872840de127cf0}{source\_}}) \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00181}00181 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00182}00182         \textcolor{comment}{// ISO C++ requires the following constructor to be defined,}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00183}00183         \textcolor{comment}{// and std::vector in VC++2008SP1 Release fails with an error}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00184}00184         \textcolor{comment}{// in the class \_Container\_base\_aux\_alloc\_real (from <xutility>)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00185}00185         \textcolor{comment}{// if the constructor does not exist.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00186}00186         \textcolor{comment}{// For this constructor, we cannot share storage; there's}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00187}00187         \textcolor{comment}{// no guarantee that the Source buffer of Ts is large enough}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00188}00188         \textcolor{comment}{// for Us.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00189}00189         \textcolor{comment}{// TODO(Google): If we were fancy pants, perhaps we could share storage}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00190}00190         \textcolor{comment}{// iff sizeof(T) == sizeof(U).}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00191}00191         \textcolor{keyword}{template} <\textcolor{keyword}{typename} U, \textcolor{keywordtype}{size\_t} other\_capacity>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00192}\mbox{\hyperlink{a01423_ae41a8dc7b8467e183cb2755ecc61df30}{00192}}         \mbox{\hyperlink{a01423_ae41a8dc7b8467e183cb2755ecc61df30}{StackAllocator}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01423}{StackAllocator<U, other\_capacity>}}\& other)}
\DoxyCodeLine{\Hypertarget{a00227_source_l00193}00193             : \mbox{\hyperlink{a01423_ad719f77abb3cff5d39872840de127cf0}{source\_}}(NULL) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00194}00194             (void)other;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00195}00195         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00196}00196 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00197}\mbox{\hyperlink{a01423_ae1227fcf2c34e5516b580a40178d4a66}{00197}}         \textcolor{keyword}{explicit} \mbox{\hyperlink{a01423_ae1227fcf2c34e5516b580a40178d4a66}{StackAllocator}}(\mbox{\hyperlink{a01427}{Source}}* source) : \mbox{\hyperlink{a01423_ad719f77abb3cff5d39872840de127cf0}{source\_}}(source) \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00198}00198 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00199}00199         \textcolor{comment}{// Actually do the allocation. Use the stack buffer if nobody has used it yet}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00200}00200         \textcolor{comment}{// and the size requested fits. Otherwise, fall through to the standard}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00201}00201         \textcolor{comment}{// allocator.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00202}\mbox{\hyperlink{a01423_a5e0ce428678fdd1f7e29856b1d2ef0e5}{00202}}         \mbox{\hyperlink{a01423_a6397373387f6be6e360ce62d29cd97fa}{pointer}} \mbox{\hyperlink{a01423_a5e0ce428678fdd1f7e29856b1d2ef0e5}{allocate}}(\mbox{\hyperlink{a01423_a19e16d250851f2e0cc2b6bf1758ca4e5}{size\_type}} n, \textcolor{keywordtype}{void}* hint = 0) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00203}00203             \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01423_ad719f77abb3cff5d39872840de127cf0}{source\_}} != NULL \&\& !\mbox{\hyperlink{a01423_ad719f77abb3cff5d39872840de127cf0}{source\_}}-\/>\mbox{\hyperlink{a01427_ae9ae5f1c043a2a5fcd6df58108e67182}{used\_stack\_buffer\_}} \&\&}
\DoxyCodeLine{\Hypertarget{a00227_source_l00204}00204                 n <= stack\_capacity) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00205}00205                 \mbox{\hyperlink{a01423_ad719f77abb3cff5d39872840de127cf0}{source\_}}-\/>\mbox{\hyperlink{a01427_ae9ae5f1c043a2a5fcd6df58108e67182}{used\_stack\_buffer\_}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00206}00206                 \textcolor{keywordflow}{return} \mbox{\hyperlink{a01423_ad719f77abb3cff5d39872840de127cf0}{source\_}}-\/>\mbox{\hyperlink{a01427_a7b32e78fcb2d7476011e4222abbc1943}{stack\_buffer}}();}
\DoxyCodeLine{\Hypertarget{a00227_source_l00207}00207             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00208}00208             \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00209}00209                 \textcolor{keywordflow}{return} std::allocator<T>::allocate(n, hint);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00210}00210             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00211}00211         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00212}00212 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00213}00213         \textcolor{comment}{// Free: when trying to free the stack buffer, just mark it as free. For}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00214}00214         \textcolor{comment}{// non-\/stack-\/buffer pointers, just fall though to the standard allocator.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00215}\mbox{\hyperlink{a01423_ab75f6481223b08774332f16eee4747b9}{00215}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{a01423_ab75f6481223b08774332f16eee4747b9}{deallocate}}(\mbox{\hyperlink{a01423_a6397373387f6be6e360ce62d29cd97fa}{pointer}} p, \mbox{\hyperlink{a01423_a19e16d250851f2e0cc2b6bf1758ca4e5}{size\_type}} n) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00216}00216             \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01423_ad719f77abb3cff5d39872840de127cf0}{source\_}} != NULL \&\& p == \mbox{\hyperlink{a01423_ad719f77abb3cff5d39872840de127cf0}{source\_}}-\/>\mbox{\hyperlink{a01427_a7b32e78fcb2d7476011e4222abbc1943}{stack\_buffer}}())}
\DoxyCodeLine{\Hypertarget{a00227_source_l00217}00217                 \mbox{\hyperlink{a01423_ad719f77abb3cff5d39872840de127cf0}{source\_}}-\/>\mbox{\hyperlink{a01427_ae9ae5f1c043a2a5fcd6df58108e67182}{used\_stack\_buffer\_}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00218}00218             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00219}00219                 std::allocator<T>::deallocate(p, n);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00220}00220         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00221}00221 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00222}00222     \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00223}\mbox{\hyperlink{a01423_ad719f77abb3cff5d39872840de127cf0}{00223}}         \mbox{\hyperlink{a01427}{Source}}* \mbox{\hyperlink{a01423_ad719f77abb3cff5d39872840de127cf0}{source\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00224}00224     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00225}00225 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00226}00226     \textcolor{comment}{// A wrapper around STL containers that maintains a stack-\/sized buffer that the}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00227}00227     \textcolor{comment}{// initial capacity of the vector is based on. Growing the container beyond the}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00228}00228     \textcolor{comment}{// stack capacity will transparently overflow onto the heap. The container must}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00229}00229     \textcolor{comment}{// support reserve().}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00230}00230     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00231}00231     \textcolor{comment}{// WATCH OUT: the ContainerType MUST use the proper StackAllocator for this}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00232}00232     \textcolor{comment}{// type. This object is really intended to be used only internally. You'll want}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00233}00233     \textcolor{comment}{// to use the wrappers below for different types.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00234}00234     \textcolor{keyword}{template} <\textcolor{keyword}{typename} TContainerType, \textcolor{keywordtype}{int} stack\_capacity>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00235}\mbox{\hyperlink{a01435}{00235}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01435}{StackContainer}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00236}00236     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00237}\mbox{\hyperlink{a01435_a95b22d28f0c6cb69681840cb38a3ae50}{00237}}         \textcolor{keyword}{typedef} TContainerType \mbox{\hyperlink{a01435_a95b22d28f0c6cb69681840cb38a3ae50}{ContainerType}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00238}\mbox{\hyperlink{a01435_a437fb42ea149f8bb1137cd5ac347adfb}{00238}}         \textcolor{keyword}{typedef} \textcolor{keyword}{typename} ContainerType::value\_type \mbox{\hyperlink{a01435_a437fb42ea149f8bb1137cd5ac347adfb}{ContainedType}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00239}\mbox{\hyperlink{a01435_adee41f24a3ac6ea0b7986f6867b9e196}{00239}}         \textcolor{keyword}{typedef} \mbox{\hyperlink{a01423}{StackAllocator<ContainedType, stack\_capacity>}} \mbox{\hyperlink{a01435_adee41f24a3ac6ea0b7986f6867b9e196}{Allocator}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00240}00240 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00241}00241         \textcolor{comment}{// Allocator must be constructed before the container!}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00242}\mbox{\hyperlink{a01435_a2cbf454e80a2df06299bb68501b45b1c}{00242}}         \mbox{\hyperlink{a01435_a2cbf454e80a2df06299bb68501b45b1c}{StackContainer}}() : \mbox{\hyperlink{a01435_a3deacc82000a8dd504728c4d5d4c13d2}{allocator\_}}(\&\mbox{\hyperlink{a01435_ae62c48e89ceda926c8ee1f3bd07fbbf8}{stack\_data\_}}), \mbox{\hyperlink{a01435_a57209394c4822c3b89a94b53eb3a63c7}{container\_}}(\mbox{\hyperlink{a01435_a3deacc82000a8dd504728c4d5d4c13d2}{allocator\_}}) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00243}00243             \textcolor{comment}{// Make the container use the stack allocation by reserving our buffer size}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00244}00244             \textcolor{comment}{// before doing anything else.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00245}00245             \mbox{\hyperlink{a01435_a57209394c4822c3b89a94b53eb3a63c7}{container\_}}.reserve(stack\_capacity);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00246}00246         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00247}00247 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00248}00248         \textcolor{comment}{// Getters for the actual container.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00249}00249         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00250}00250         \textcolor{comment}{// Danger: any copies of this made using the copy constructor must have}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00251}00251         \textcolor{comment}{// shorter lifetimes than the source. The copy will share the same allocator}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00252}00252         \textcolor{comment}{// and therefore the same stack buffer as the original. Use std::copy to}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00253}00253         \textcolor{comment}{// copy into a "{}real"{} container for longer-\/lived objects.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00254}\mbox{\hyperlink{a01435_a936c210e9cedf972a8d60070913c4c0b}{00254}}         \mbox{\hyperlink{a01435_a95b22d28f0c6cb69681840cb38a3ae50}{ContainerType}}\& \mbox{\hyperlink{a01435_a936c210e9cedf972a8d60070913c4c0b}{container}}() \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01435_a57209394c4822c3b89a94b53eb3a63c7}{container\_}}; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00255}\mbox{\hyperlink{a01435_a1ebcc1f2c383c175b7eae1c79d977090}{00255}}         \textcolor{keyword}{const} \mbox{\hyperlink{a01435_a95b22d28f0c6cb69681840cb38a3ae50}{ContainerType}}\& \mbox{\hyperlink{a01435_a1ebcc1f2c383c175b7eae1c79d977090}{container}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01435_a57209394c4822c3b89a94b53eb3a63c7}{container\_}}; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00256}00256 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00257}00257         \textcolor{comment}{// Support operator-\/> to get to the container. This allows nicer syntax like:}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00258}00258         \textcolor{comment}{//   StackContainer<...> foo;}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00259}00259         \textcolor{comment}{//   std::sort(foo-\/>begin(), foo-\/>end());}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00260}\mbox{\hyperlink{a01435_a0f196c7ce631f7086a4ee251d4bd3307}{00260}}         \mbox{\hyperlink{a01435_a95b22d28f0c6cb69681840cb38a3ae50}{ContainerType}}* \mbox{\hyperlink{a01435_a0f196c7ce631f7086a4ee251d4bd3307}{operator-\/>}}() \{ \textcolor{keywordflow}{return} \&\mbox{\hyperlink{a01435_a57209394c4822c3b89a94b53eb3a63c7}{container\_}}; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00261}\mbox{\hyperlink{a01435_a735d8fd70307ff670527979e0e603169}{00261}}         \textcolor{keyword}{const} \mbox{\hyperlink{a01435_a95b22d28f0c6cb69681840cb38a3ae50}{ContainerType}}* \mbox{\hyperlink{a01435_a735d8fd70307ff670527979e0e603169}{operator-\/>}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \&\mbox{\hyperlink{a01435_a57209394c4822c3b89a94b53eb3a63c7}{container\_}}; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00262}00262 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00263}00263 \textcolor{preprocessor}{\#ifdef UNIT\_TEST}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00264}00264         \textcolor{comment}{// Retrieves the stack source so that that unit tests can verify that the}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00265}00265         \textcolor{comment}{// buffer is being used properly.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00266}00266         \textcolor{keyword}{const} \textcolor{keyword}{typename} Allocator::Source\& stack\_data()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01435_ae62c48e89ceda926c8ee1f3bd07fbbf8}{stack\_data\_}}; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00267}00267 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00268}00268 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00269}00269     \textcolor{keyword}{protected}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00270}\mbox{\hyperlink{a01435_ae62c48e89ceda926c8ee1f3bd07fbbf8}{00270}}         \textcolor{keyword}{typename} Allocator::Source \mbox{\hyperlink{a01435_ae62c48e89ceda926c8ee1f3bd07fbbf8}{stack\_data\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00271}\mbox{\hyperlink{a01435_aec17d40ec4697fddd66440dee615d898}{00271}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \mbox{\hyperlink{a01435_aec17d40ec4697fddd66440dee615d898}{pad\_}}[7];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00272}\mbox{\hyperlink{a01435_a3deacc82000a8dd504728c4d5d4c13d2}{00272}}         \mbox{\hyperlink{a01423}{Allocator}} \mbox{\hyperlink{a01435_a3deacc82000a8dd504728c4d5d4c13d2}{allocator\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00273}\mbox{\hyperlink{a01435_a57209394c4822c3b89a94b53eb3a63c7}{00273}}         \mbox{\hyperlink{a01435_a95b22d28f0c6cb69681840cb38a3ae50}{ContainerType}} \mbox{\hyperlink{a01435_a57209394c4822c3b89a94b53eb3a63c7}{container\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00274}00274 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00275}00275         \textcolor{comment}{// DISALLOW\_EVIL\_CONSTRUCTORS(StackContainer);}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00276}\mbox{\hyperlink{a01435_a74af3d6ed0c9d04b05293075b47f4fb1}{00276}}         \mbox{\hyperlink{a01435_a74af3d6ed0c9d04b05293075b47f4fb1}{StackContainer}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01435}{StackContainer}}\&);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00277}\mbox{\hyperlink{a01435_ab4a7ac3bf979058399fe51398dfca19f}{00277}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{a01435_ab4a7ac3bf979058399fe51398dfca19f}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01435}{StackContainer}}\&);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00278}00278     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00279}00279 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00280}00280     \textcolor{comment}{// StackVector}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00281}00281     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00282}00282     \textcolor{comment}{// Example:}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00283}00283     \textcolor{comment}{//   StackVector<int, 16> foo;}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00284}00284     \textcolor{comment}{//   foo-\/>push\_back(22);  // we have overloaded operator-\/>}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00285}00285     \textcolor{comment}{//   foo[0] = 10;         // as well as operator[]}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00286}00286     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T, \textcolor{keywordtype}{size\_t} stack\_capacity>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00287}\mbox{\hyperlink{a01439}{00287}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01439}{StackVector}}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00288}00288         : \textcolor{keyword}{public} \mbox{\hyperlink{a01435}{StackContainer}}<std::vector<T, StackAllocator<T, stack\_capacity> >,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00289}00289         stack\_capacity> \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00290}00290     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00291}\mbox{\hyperlink{a01439_aa382716d7837c894d720b14cd5493b8e}{00291}}         \mbox{\hyperlink{a01439_aa382716d7837c894d720b14cd5493b8e}{StackVector}}()}
\DoxyCodeLine{\Hypertarget{a00227_source_l00292}00292             : \mbox{\hyperlink{a01435}{StackContainer}}<\mbox{\hyperlink{a00461}{std}}::vector<T, \mbox{\hyperlink{a01423}{StackAllocator}}<T, stack\_capacity> >,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00293}00293             stack\_capacity>() \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00294}00294 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00295}00295         \textcolor{comment}{// We need to put this in STL containers sometimes, which requires a copy}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00296}00296         \textcolor{comment}{// constructor. We can't call the regular copy constructor because that will}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00297}00297         \textcolor{comment}{// take the stack buffer from the original. Here, we create an empty object}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00298}00298         \textcolor{comment}{// and make a stack buffer of its own.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00299}\mbox{\hyperlink{a01439_a2f020ab95e8e128a252bd969c6ec2ab2}{00299}}         \mbox{\hyperlink{a01439_a2f020ab95e8e128a252bd969c6ec2ab2}{StackVector}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01439}{StackVector<T, stack\_capacity>}}\& other)}
\DoxyCodeLine{\Hypertarget{a00227_source_l00300}00300             : \mbox{\hyperlink{a01435}{StackContainer}}<\mbox{\hyperlink{a00461}{std}}::vector<T, \mbox{\hyperlink{a01423}{StackAllocator}}<T, stack\_capacity> >,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00301}00301             stack\_capacity>() \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00302}00302             this-\/>\mbox{\hyperlink{a01435_a936c210e9cedf972a8d60070913c4c0b}{container}}().assign(other-\/>begin(), other-\/>end());}
\DoxyCodeLine{\Hypertarget{a00227_source_l00303}00303         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00304}00304 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00305}\mbox{\hyperlink{a01439_a7541fa2868c6bf906284917a04a3f2c3}{00305}}         \mbox{\hyperlink{a01439}{StackVector<T, stack\_capacity>}}\& \mbox{\hyperlink{a01439_a7541fa2868c6bf906284917a04a3f2c3}{operator=}}(}
\DoxyCodeLine{\Hypertarget{a00227_source_l00306}00306             \textcolor{keyword}{const} \mbox{\hyperlink{a01439}{StackVector<T, stack\_capacity>}}\& other) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00307}00307             this-\/>\mbox{\hyperlink{a01435_a936c210e9cedf972a8d60070913c4c0b}{container}}().assign(other-\/>begin(), other-\/>end());}
\DoxyCodeLine{\Hypertarget{a00227_source_l00308}00308             \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00309}00309         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00310}00310 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00311}00311         \textcolor{comment}{// Vectors are commonly indexed, which isn't very convenient even with}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00312}00312         \textcolor{comment}{// operator-\/> (using "{}-\/>at()"{} does exception stuff we don't want).}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00313}\mbox{\hyperlink{a01439_ad87863b8de65943ea9dd6fa36d400aed}{00313}}         T\& \mbox{\hyperlink{a01439_ad87863b8de65943ea9dd6fa36d400aed}{operator[]}}(\textcolor{keywordtype}{size\_t} i) \{ \textcolor{keywordflow}{return} this-\/>\mbox{\hyperlink{a01435_a936c210e9cedf972a8d60070913c4c0b}{container}}().operator[](i); \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00314}\mbox{\hyperlink{a01439_a721b9dd781613c055cb47fd4522a150f}{00314}}         \textcolor{keyword}{const} T\& \mbox{\hyperlink{a01439_a721b9dd781613c055cb47fd4522a150f}{operator[]}}(\textcolor{keywordtype}{size\_t} i)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00315}00315             \textcolor{keywordflow}{return} this-\/>\mbox{\hyperlink{a01435_a936c210e9cedf972a8d60070913c4c0b}{container}}().operator[](i);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00316}00316         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00317}00317     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00318}00318 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00319}00319     \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00320}00320 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00321}00321     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T = \textcolor{keywordtype}{float}>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00322}\mbox{\hyperlink{a01443}{00322}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01443}{real3}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00323}00323     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00324}\mbox{\hyperlink{a01443_a0ae6f0e4cb138da0359e18103ce609b8}{00324}}         \mbox{\hyperlink{a01443_a0ae6f0e4cb138da0359e18103ce609b8}{real3}}() \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00325}\mbox{\hyperlink{a01443_aa0b4c0778d47d681f61b6381c6f01ac9}{00325}}         \mbox{\hyperlink{a01443_aa0b4c0778d47d681f61b6381c6f01ac9}{real3}}(T \mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00326}00326             \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[0] = \mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00327}00327             \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[1] = \mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00328}00328             \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[2] = \mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00329}00329         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00330}\mbox{\hyperlink{a01443_a659b53603285ae9a7baffbc9cd3416ae}{00330}}         \mbox{\hyperlink{a01443_a659b53603285ae9a7baffbc9cd3416ae}{real3}}(T xx, T yy, T zz) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00331}00331             \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[0] = xx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00332}00332             \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[1] = yy;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00333}00333             \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[2] = zz;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00334}00334         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00335}\mbox{\hyperlink{a01443_aa2f53c31ca94bb72a4fd91a16f08270b}{00335}}         \textcolor{keyword}{explicit} \mbox{\hyperlink{a01443_aa2f53c31ca94bb72a4fd91a16f08270b}{real3}}(\textcolor{keyword}{const} T* p) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00336}00336             \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[0] = p[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00337}00337             \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[1] = p[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00338}00338             \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[2] = p[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00339}00339         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00340}00340 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00341}\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{00341}}         \textcolor{keyword}{inline} T \mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[0]; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00342}\mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{00342}}         \textcolor{keyword}{inline} T \mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[1]; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00343}\mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{00343}}         \textcolor{keyword}{inline} T \mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[2]; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00344}00344 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00345}\mbox{\hyperlink{a01443_a53be64ec8d91a0d750a386c28b86d8c5}{00345}}         \mbox{\hyperlink{a01443}{real3}} \mbox{\hyperlink{a01443_a53be64ec8d91a0d750a386c28b86d8c5}{operator*}}(T f)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01443_a0ae6f0e4cb138da0359e18103ce609b8}{real3}}(\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}() * f, \mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}() * f, \mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}() * f); \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00346}\mbox{\hyperlink{a01443_aff71230adfb3070aa773cb08dad19e03}{00346}}         \mbox{\hyperlink{a01443}{real3}} \mbox{\hyperlink{a01443_aff71230adfb3070aa773cb08dad19e03}{operator-\/}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3}}\& f2)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00347}00347             \textcolor{keywordflow}{return} \mbox{\hyperlink{a01443_a0ae6f0e4cb138da0359e18103ce609b8}{real3}}(\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}() -\/ f2.\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}(), \mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}() -\/ f2.\mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}(), \mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}() -\/ f2.\mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}());}
\DoxyCodeLine{\Hypertarget{a00227_source_l00348}00348         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00349}\mbox{\hyperlink{a01443_a118c1f372e60cd34fba3bcd356cb945f}{00349}}         \mbox{\hyperlink{a01443}{real3}} \mbox{\hyperlink{a01443_a118c1f372e60cd34fba3bcd356cb945f}{operator*}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3}}\& f2)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00350}00350             \textcolor{keywordflow}{return} \mbox{\hyperlink{a01443_a0ae6f0e4cb138da0359e18103ce609b8}{real3}}(\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}() * f2.\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}(), \mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}() * f2.\mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}(), \mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}() * f2.\mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}());}
\DoxyCodeLine{\Hypertarget{a00227_source_l00351}00351         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00352}\mbox{\hyperlink{a01443_abba2600acee60dddefa6797835e44300}{00352}}         \mbox{\hyperlink{a01443}{real3}} \mbox{\hyperlink{a01443_abba2600acee60dddefa6797835e44300}{operator+}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3}}\& f2)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00353}00353             \textcolor{keywordflow}{return} \mbox{\hyperlink{a01443_a0ae6f0e4cb138da0359e18103ce609b8}{real3}}(\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}() + f2.\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}(), \mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}() + f2.\mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}(), \mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}() + f2.\mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}());}
\DoxyCodeLine{\Hypertarget{a00227_source_l00354}00354         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00355}\mbox{\hyperlink{a01443_ac5df078f42dc0877ba9fab81dc48d1c4}{00355}}         \mbox{\hyperlink{a01443}{real3}}\& \mbox{\hyperlink{a01443_ac5df078f42dc0877ba9fab81dc48d1c4}{operator+=}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3}}\& f2) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00356}00356             \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[0] += f2.\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}();}
\DoxyCodeLine{\Hypertarget{a00227_source_l00357}00357             \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[1] += f2.\mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}();}
\DoxyCodeLine{\Hypertarget{a00227_source_l00358}00358             \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[2] += f2.\mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}();}
\DoxyCodeLine{\Hypertarget{a00227_source_l00359}00359             \textcolor{keywordflow}{return} (*\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{a00227_source_l00360}00360         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00361}\mbox{\hyperlink{a01443_a0fdbf92ea5a1299ad4b6eb6199336eeb}{00361}}         \mbox{\hyperlink{a01443}{real3}} \mbox{\hyperlink{a01443_a0fdbf92ea5a1299ad4b6eb6199336eeb}{operator/}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3}}\& f2)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00362}00362             \textcolor{keywordflow}{return} \mbox{\hyperlink{a01443_a0ae6f0e4cb138da0359e18103ce609b8}{real3}}(\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}() / f2.\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}(), \mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}() / f2.\mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}(), \mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}() / f2.\mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}());}
\DoxyCodeLine{\Hypertarget{a00227_source_l00363}00363         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00364}\mbox{\hyperlink{a01443_a7f0b3509344bd281aee9ca7d437dac3c}{00364}}         \mbox{\hyperlink{a01443}{real3}} \mbox{\hyperlink{a01443_a7f0b3509344bd281aee9ca7d437dac3c}{operator-\/}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01443_a0ae6f0e4cb138da0359e18103ce609b8}{real3}}(-\/\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}(), -\/\mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}(), -\/\mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}()); \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00365}\mbox{\hyperlink{a01443_ac2677fb2b5d06854402ebff373d70cbc}{00365}}         T \mbox{\hyperlink{a01443_ac2677fb2b5d06854402ebff373d70cbc}{operator[]}}(\textcolor{keywordtype}{int} i)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[i]; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00366}\mbox{\hyperlink{a01443_a6630b78384653909f5ae624ed1d244f2}{00366}}         T\& \mbox{\hyperlink{a01443_a6630b78384653909f5ae624ed1d244f2}{operator[]}}(\textcolor{keywordtype}{int} i) \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[i]; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00367}00367 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00368}\mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{00368}}         T \mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[3];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00369}00369         \textcolor{comment}{// T pad;  // for alignment (when T = float)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00370}00370     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00371}00371 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00372}00372     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00373}\mbox{\hyperlink{a00474_ac087438e0e06d6e0bfd900f023d566cf}{00373}}     \textcolor{keyword}{inline} \mbox{\hyperlink{a01443}{real3<T>}} \mbox{\hyperlink{a00474_ac087438e0e06d6e0bfd900f023d566cf}{operator*}}(T f, \textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}}\& v) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00374}00374         \textcolor{keywordflow}{return} \mbox{\hyperlink{a01443}{real3<T>}}(v.\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}() * f, v.\mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}() * f, v.\mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}() * f);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00375}00375     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00376}00376 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00377}00377     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00378}\mbox{\hyperlink{a00474_aecb04fda18a17169fe84e62932fba761}{00378}}     \textcolor{keyword}{inline} \mbox{\hyperlink{a01443}{real3<T>}} \mbox{\hyperlink{a00474_aecb04fda18a17169fe84e62932fba761}{vneg}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}}\& rhs) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00379}00379         \textcolor{keywordflow}{return} \mbox{\hyperlink{a01443}{real3<T>}}(-\/rhs.\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}(), -\/rhs.\mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}(), -\/rhs.\mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}());}
\DoxyCodeLine{\Hypertarget{a00227_source_l00380}00380     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00381}00381 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00382}00382     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00383}\mbox{\hyperlink{a00474_ab9ba72d8d5e11d213c39ce9bd8e851ef}{00383}}     \textcolor{keyword}{inline} T \mbox{\hyperlink{a00474_ab9ba72d8d5e11d213c39ce9bd8e851ef}{vlength}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}}\& rhs) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00384}00384         \textcolor{keywordflow}{return} std::sqrt(rhs.\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}() * rhs.\mbox{\hyperlink{a01443_a245ee0e429d5695c33ea29ccbe1792ec}{x}}() + rhs.\mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}() * rhs.\mbox{\hyperlink{a01443_af92059bf1d44c9bf67c90ca2d46be17e}{y}}() + rhs.\mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}() * rhs.\mbox{\hyperlink{a01443_a96d4a74ac8a453a85c5661d38d3003d1}{z}}());}
\DoxyCodeLine{\Hypertarget{a00227_source_l00385}00385     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00386}00386 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00387}00387     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00388}\mbox{\hyperlink{a00474_a3158af945b024d902dbe469939dfd025}{00388}}     \textcolor{keyword}{inline} \mbox{\hyperlink{a01443}{real3<T>}} \mbox{\hyperlink{a00474_a3158af945b024d902dbe469939dfd025}{vnormalize}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}}\& rhs) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00389}00389         \mbox{\hyperlink{a01443}{real3<T>}} v = rhs;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00390}00390         T len = \mbox{\hyperlink{a00474_ab9ba72d8d5e11d213c39ce9bd8e851ef}{vlength}}(rhs);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00391}00391         \textcolor{keywordflow}{if} (std::fabs(len) > std::numeric\_limits<T>::epsilon()) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00392}00392             T inv\_len = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1.0) / len;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00393}00393             v.\mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[0] *= inv\_len;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00394}00394             v.\mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[1] *= inv\_len;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00395}00395             v.\mbox{\hyperlink{a01443_a934e1a725e207c8b24aef3d98495207e}{v}}[2] *= inv\_len;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00396}00396         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00397}00397         \textcolor{keywordflow}{return} v;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00398}00398     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00399}00399 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00400}00400     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00401}\mbox{\hyperlink{a00474_a58c9ca8d623495219433a3c873c13e4f}{00401}}     \textcolor{keyword}{inline} \mbox{\hyperlink{a01443}{real3<T>}} \mbox{\hyperlink{a00474_a58c9ca8d623495219433a3c873c13e4f}{vcross}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}} a, \textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}} b) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00402}00402         \mbox{\hyperlink{a01443}{real3<T>}} c;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00403}00403         c[0] = a[1] * b[2] -\/ a[2] * b[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00404}00404         c[1] = a[2] * b[0] -\/ a[0] * b[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00405}00405         c[2] = a[0] * b[1] -\/ a[1] * b[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00406}00406         \textcolor{keywordflow}{return} c;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00407}00407     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00408}00408 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00409}00409     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00410}\mbox{\hyperlink{a00474_a218842bcf14b05ea6840d88b58fc8ec6}{00410}}     \textcolor{keyword}{inline} T \mbox{\hyperlink{a00474_a218842bcf14b05ea6840d88b58fc8ec6}{vdot}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}} a, \textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}} b) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00411}00411         \textcolor{keywordflow}{return} a[0] * b[0] + a[1] * b[1] + a[2] * b[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00412}00412     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00413}00413 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00414}00414     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00415}\mbox{\hyperlink{a00474_aa6d08ee0bfbbaa13319f31e5412111bc}{00415}}     \textcolor{keyword}{inline} \mbox{\hyperlink{a01443}{real3<T>}} \mbox{\hyperlink{a00474_aa6d08ee0bfbbaa13319f31e5412111bc}{vsafe\_inverse}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}} v) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00416}00416         \mbox{\hyperlink{a01443}{real3<T>}} r;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00417}00417 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00418}00418 \textcolor{preprocessor}{\#ifdef NANORT\_USE\_CPP11\_FEATURE}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00419}00419 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00420}00420         \textcolor{keywordflow}{if} (std::fabs(v[0]) < std::numeric\_limits<T>::epsilon()) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00421}00421             r[0] = std::numeric\_limits<T>::infinity() *}
\DoxyCodeLine{\Hypertarget{a00227_source_l00422}00422                 std::copysign(\textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1), v[0]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00423}00423         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00424}00424         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00425}00425             r[0] = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1.0) / v[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00426}00426         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00427}00427 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00428}00428         \textcolor{keywordflow}{if} (std::fabs(v[1]) < std::numeric\_limits<T>::epsilon()) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00429}00429             r[1] = std::numeric\_limits<T>::infinity() *}
\DoxyCodeLine{\Hypertarget{a00227_source_l00430}00430                 std::copysign(\textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1), v[1]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00431}00431         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00432}00432         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00433}00433             r[1] = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1.0) / v[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00434}00434         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00435}00435 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00436}00436         \textcolor{keywordflow}{if} (std::fabs(v[2]) < std::numeric\_limits<T>::epsilon()) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00437}00437             r[2] = std::numeric\_limits<T>::infinity() *}
\DoxyCodeLine{\Hypertarget{a00227_source_l00438}00438                 std::copysign(\textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1), v[2]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00439}00439         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00440}00440         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00441}00441             r[2] = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1.0) / v[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00442}00442         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00443}00443 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00444}00444 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00445}00445         \textcolor{keywordflow}{if} (std::fabs(v[0]) < std::numeric\_limits<T>::epsilon()) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00446}00446             T sgn = (v[0] < \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0)) ? \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(-\/1) : \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00447}00447             r[0] = std::numeric\_limits<T>::infinity() * sgn;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00448}00448         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00449}00449         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00450}00450             r[0] = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1.0) / v[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00451}00451         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00452}00452 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00453}00453         \textcolor{keywordflow}{if} (std::fabs(v[1]) < std::numeric\_limits<T>::epsilon()) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00454}00454             T sgn = (v[1] < \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0)) ? \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(-\/1) : \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00455}00455             r[1] = std::numeric\_limits<T>::infinity() * sgn;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00456}00456         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00457}00457         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00458}00458             r[1] = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1.0) / v[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00459}00459         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00460}00460 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00461}00461         \textcolor{keywordflow}{if} (std::fabs(v[2]) < std::numeric\_limits<T>::epsilon()) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00462}00462             T sgn = (v[2] < \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0)) ? \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(-\/1) : \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00463}00463             r[2] = std::numeric\_limits<T>::infinity() * sgn;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00464}00464         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00465}00465         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00466}00466             r[2] = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1.0) / v[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00467}00467         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00468}00468 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00469}00469 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00470}00470         \textcolor{keywordflow}{return} r;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00471}00471     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00472}00472 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00473}00473     \textcolor{keyword}{template} <\textcolor{keyword}{typename} real>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00474}\mbox{\hyperlink{a00474_a91c0c4ec5d542629d67b60c3bf0e7848}{00474}}     \textcolor{keyword}{inline} \textcolor{keyword}{const} real* \mbox{\hyperlink{a00474_a91c0c4ec5d542629d67b60c3bf0e7848}{get\_vertex\_addr}}(\textcolor{keyword}{const} real* p, \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} idx,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00475}00475         \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} stride\_bytes) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00476}00476         \textcolor{keywordflow}{return} \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const }real*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{a00227_source_l00477}00477             \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const }\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}*\textcolor{keyword}{>}(p) + idx * stride\_bytes);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00478}00478     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00479}00479 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00480}00480     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T = \textcolor{keywordtype}{float}>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00481}\mbox{\hyperlink{a01447}{00481}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01447}{Ray}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00482}00482     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00483}\mbox{\hyperlink{a01447_adced19ed89c4ae2aec37fa9e2fcf8b85}{00483}}         \mbox{\hyperlink{a01447_adced19ed89c4ae2aec37fa9e2fcf8b85}{Ray}}()}
\DoxyCodeLine{\Hypertarget{a00227_source_l00484}00484             : \mbox{\hyperlink{a01447_a0e35bd37e6eb93f8233d903725d75de4}{min\_t}}(static\_cast<T>(0.0)),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00485}00485             \mbox{\hyperlink{a01447_ae36571adc2758974ef58912c4896c5e6}{max\_t}}( \mbox{\hyperlink{a00461}{std}}::numeric\_limits<T>::max()), \textcolor{comment}{// this is modified from original as it wraps numeric\_limits in paranthesis to avoid windows macro}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00486}00486             \mbox{\hyperlink{a01447_ab0fa25210dc652ee62cd84636e86df85}{type}}(\mbox{\hyperlink{a00474_a6ffc0020d7d758bc91664a49a749f661a26df8dc570dac0c6a8e2f0b1c5599035}{RAY\_TYPE\_NONE}}) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00487}00487             \mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[0] = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00488}00488             \mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[1] = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00489}00489             \mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[2] = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00490}00490             \mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[0] = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00491}00491             \mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[1] = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00492}00492             \mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[2] = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(-\/1.0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00493}00493         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00494}00494 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00495}\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{00495}}         T \mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[3];           \textcolor{comment}{// must set}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00496}\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{00496}}         T \mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[3];           \textcolor{comment}{// must set}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00497}\mbox{\hyperlink{a01447_a0e35bd37e6eb93f8233d903725d75de4}{00497}}         T \mbox{\hyperlink{a01447_a0e35bd37e6eb93f8233d903725d75de4}{min\_t}};            \textcolor{comment}{// minimum ray hit distance.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00498}\mbox{\hyperlink{a01447_ae36571adc2758974ef58912c4896c5e6}{00498}}         T \mbox{\hyperlink{a01447_ae36571adc2758974ef58912c4896c5e6}{max\_t}};            \textcolor{comment}{// maximum ray hit distance.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00499}\mbox{\hyperlink{a01447_ab0fa25210dc652ee62cd84636e86df85}{00499}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01447_ab0fa25210dc652ee62cd84636e86df85}{type}};  \textcolor{comment}{// ray type}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00500}00500 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00501}00501         \textcolor{comment}{// TODO(LTE): Align sizeof(Ray)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00502}00502     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00503}00503 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00504}00504     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T = \textcolor{keywordtype}{float}>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00505}\mbox{\hyperlink{a01451}{00505}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01451}{BVHNode}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00506}00506     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00507}\mbox{\hyperlink{a01451_a964e0ed93e80e09b263758e664602531}{00507}}         \mbox{\hyperlink{a01451_a964e0ed93e80e09b263758e664602531}{BVHNode}}() \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00508}\mbox{\hyperlink{a01451_a316e4a3009889c449c12a1edfc728471}{00508}}         \mbox{\hyperlink{a01451_a316e4a3009889c449c12a1edfc728471}{BVHNode}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01451}{BVHNode}}\& rhs) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00509}00509             \mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[0] = rhs.\mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00510}00510             \mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[1] = rhs.\mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00511}00511             \mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[2] = rhs.\mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00512}00512             \mbox{\hyperlink{a01451_a21a298034fec1fe031c54bb3a6a6fa5e}{flag}} = rhs.\mbox{\hyperlink{a01451_a21a298034fec1fe031c54bb3a6a6fa5e}{flag}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00513}00513 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00514}00514             \mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[0] = rhs.\mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00515}00515             \mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[1] = rhs.\mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00516}00516             \mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[2] = rhs.\mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00517}00517             \mbox{\hyperlink{a01451_a6988b1df6a0fc7523ea0ed099cd0495c}{axis}} = rhs.\mbox{\hyperlink{a01451_a6988b1df6a0fc7523ea0ed099cd0495c}{axis}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00518}00518 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00519}00519             \mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[0] = rhs.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00520}00520             \mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[1] = rhs.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00521}00521         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00522}00522 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00523}\mbox{\hyperlink{a01451_aadbf01ec1c7afc76eb488473bdbf06ec}{00523}}         \mbox{\hyperlink{a01451}{BVHNode}}\& \mbox{\hyperlink{a01451_aadbf01ec1c7afc76eb488473bdbf06ec}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01451}{BVHNode}}\& rhs) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00524}00524             \mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[0] = rhs.\mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00525}00525             \mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[1] = rhs.\mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00526}00526             \mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[2] = rhs.\mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00527}00527             \mbox{\hyperlink{a01451_a21a298034fec1fe031c54bb3a6a6fa5e}{flag}} = rhs.\mbox{\hyperlink{a01451_a21a298034fec1fe031c54bb3a6a6fa5e}{flag}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00528}00528 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00529}00529             \mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[0] = rhs.\mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00530}00530             \mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[1] = rhs.\mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00531}00531             \mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[2] = rhs.\mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00532}00532             \mbox{\hyperlink{a01451_a6988b1df6a0fc7523ea0ed099cd0495c}{axis}} = rhs.\mbox{\hyperlink{a01451_a6988b1df6a0fc7523ea0ed099cd0495c}{axis}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00533}00533 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00534}00534             \mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[0] = rhs.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00535}00535             \mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[1] = rhs.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00536}00536 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00537}00537             \textcolor{keywordflow}{return} (*\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{a00227_source_l00538}00538         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00539}00539 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00540}\mbox{\hyperlink{a01451_a3b683331c334d464bdb0a9a6b6929e9c}{00540}}         \mbox{\hyperlink{a01451_a3b683331c334d464bdb0a9a6b6929e9c}{\string~BVHNode}}() \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00541}00541 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00542}\mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{00542}}         T \mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[3];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00543}\mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{00543}}         T \mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[3];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00544}00544 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00545}\mbox{\hyperlink{a01451_a21a298034fec1fe031c54bb3a6a6fa5e}{00545}}         \textcolor{keywordtype}{int} \mbox{\hyperlink{a01451_a21a298034fec1fe031c54bb3a6a6fa5e}{flag}};  \textcolor{comment}{// 1 = leaf node, 0 = branch node}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00546}\mbox{\hyperlink{a01451_a6988b1df6a0fc7523ea0ed099cd0495c}{00546}}         \textcolor{keywordtype}{int} \mbox{\hyperlink{a01451_a6988b1df6a0fc7523ea0ed099cd0495c}{axis}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00547}00547 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00548}00548         \textcolor{comment}{// leaf}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00549}00549         \textcolor{comment}{//   data[0] = npoints}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00550}00550         \textcolor{comment}{//   data[1] = index}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00551}00551         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00552}00552         \textcolor{comment}{// branch}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00553}00553         \textcolor{comment}{//   data[0] = child[0]}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00554}00554         \textcolor{comment}{//   data[1] = child[1]}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00555}\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{00555}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00556}00556     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00557}00557 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00558}00558     \textcolor{keyword}{template} <\textcolor{keyword}{class} H>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00559}\mbox{\hyperlink{a01455}{00559}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01455}{IntersectComparator}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00560}00560     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00561}\mbox{\hyperlink{a01455_a67b3389f78ec232ce1a6bf03ebb16e2b}{00561}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01455_a67b3389f78ec232ce1a6bf03ebb16e2b}{operator()}}(\textcolor{keyword}{const} H\& a, \textcolor{keyword}{const} H\& b)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} a.t < b.t; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00562}00562     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00563}00563 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00565}00565     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T = \textcolor{keywordtype}{float}>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00566}\mbox{\hyperlink{a01459}{00566}}     \textcolor{keyword}{struct }\mbox{\hyperlink{a01459}{BVHBuildOptions}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00567}\mbox{\hyperlink{a01459_ae51d963cb7492e4e4751dc109a44e0d7}{00567}}         T \mbox{\hyperlink{a01459_ae51d963cb7492e4e4751dc109a44e0d7}{cost\_t\_aabb}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00568}\mbox{\hyperlink{a01459_ab5b0ecefe07c7a6d29d6d35cec57c51c}{00568}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01459_ab5b0ecefe07c7a6d29d6d35cec57c51c}{min\_leaf\_primitives}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00569}\mbox{\hyperlink{a01459_aa3c575c2202206a61c318f2df90fa438}{00569}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01459_aa3c575c2202206a61c318f2df90fa438}{max\_tree\_depth}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00570}\mbox{\hyperlink{a01459_a7551c8a386132af266e63fdb5487c027}{00570}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01459_a7551c8a386132af266e63fdb5487c027}{bin\_size}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00571}\mbox{\hyperlink{a01459_abc7ea884176924446d76f1e17c9f46c0}{00571}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01459_abc7ea884176924446d76f1e17c9f46c0}{shallow\_depth}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00572}\mbox{\hyperlink{a01459_a75d2abe7b240f074fb6369468261d793}{00572}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01459_a75d2abe7b240f074fb6369468261d793}{min\_primitives\_for\_parallel\_build}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00573}00573 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00574}00574         \textcolor{comment}{// Cache bounding box computation.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00575}00575         \textcolor{comment}{// Requires more memory, but BVHbuild can be faster.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00576}\mbox{\hyperlink{a01459_a99d7328a59abcb9aeaa23cede349e251}{00576}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01459_a99d7328a59abcb9aeaa23cede349e251}{cache\_bbox}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00577}\mbox{\hyperlink{a01459_a03eae4265033f29383f59bca5058b2a0}{00577}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \mbox{\hyperlink{a01459_a03eae4265033f29383f59bca5058b2a0}{pad}}[3];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00578}00578 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00579}00579         \textcolor{comment}{// Set default value: Taabb = 0.2}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00580}\mbox{\hyperlink{a01459_a93a7183a27726e96075373c297669c31}{00580}}         \mbox{\hyperlink{a01459_a93a7183a27726e96075373c297669c31}{BVHBuildOptions}}()}
\DoxyCodeLine{\Hypertarget{a00227_source_l00581}00581             : \mbox{\hyperlink{a01459_ae51d963cb7492e4e4751dc109a44e0d7}{cost\_t\_aabb}}(static\_cast<T>(0.2)),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00582}00582             \mbox{\hyperlink{a01459_ab5b0ecefe07c7a6d29d6d35cec57c51c}{min\_leaf\_primitives}}(4),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00583}00583             \mbox{\hyperlink{a01459_aa3c575c2202206a61c318f2df90fa438}{max\_tree\_depth}}(256),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00584}00584             \mbox{\hyperlink{a01459_a7551c8a386132af266e63fdb5487c027}{bin\_size}}(64),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00585}00585             \mbox{\hyperlink{a01459_abc7ea884176924446d76f1e17c9f46c0}{shallow\_depth}}(\mbox{\hyperlink{a00227_aaa838182f89d868d24b4f3ddb0df6b81}{kNANORT\_SHALLOW\_DEPTH}}),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00586}00586             \mbox{\hyperlink{a01459_a75d2abe7b240f074fb6369468261d793}{min\_primitives\_for\_parallel\_build}}(}
\DoxyCodeLine{\Hypertarget{a00227_source_l00587}00587                 \mbox{\hyperlink{a00227_a0c674d5d198095296c8251eecfdb4377}{kNANORT\_MIN\_PRIMITIVES\_FOR\_PARALLEL\_BUILD}}),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00588}00588             \mbox{\hyperlink{a01459_a99d7328a59abcb9aeaa23cede349e251}{cache\_bbox}}(false) \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00589}00589     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00590}00590 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00592}\mbox{\hyperlink{a01463}{00592}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01463}{BVHBuildStatistics}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00593}00593     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00594}\mbox{\hyperlink{a01463_a7ffd6278400de90a262d5bb83589c1c1}{00594}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01463_a7ffd6278400de90a262d5bb83589c1c1}{max\_tree\_depth}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00595}\mbox{\hyperlink{a01463_a42b219665f02f3eaa89c008d0215336d}{00595}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01463_a42b219665f02f3eaa89c008d0215336d}{num\_leaf\_nodes}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00596}\mbox{\hyperlink{a01463_ae95201c13555ea6ccb454f86ace83f5f}{00596}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01463_ae95201c13555ea6ccb454f86ace83f5f}{num\_branch\_nodes}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00597}\mbox{\hyperlink{a01463_a985cb8c800bd91ceaedd28174df4ed0d}{00597}}         \textcolor{keywordtype}{float} \mbox{\hyperlink{a01463_a985cb8c800bd91ceaedd28174df4ed0d}{build\_secs}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00598}00598 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00599}00599         \textcolor{comment}{// Set default value: Taabb = 0.2}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00600}\mbox{\hyperlink{a01463_a617c0ee4563bc5d60e81fe1b66a422a8}{00600}}         \mbox{\hyperlink{a01463_a617c0ee4563bc5d60e81fe1b66a422a8}{BVHBuildStatistics}}()}
\DoxyCodeLine{\Hypertarget{a00227_source_l00601}00601             : \mbox{\hyperlink{a01463_a7ffd6278400de90a262d5bb83589c1c1}{max\_tree\_depth}}(0),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00602}00602             \mbox{\hyperlink{a01463_a42b219665f02f3eaa89c008d0215336d}{num\_leaf\_nodes}}(0),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00603}00603             \mbox{\hyperlink{a01463_ae95201c13555ea6ccb454f86ace83f5f}{num\_branch\_nodes}}(0),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00604}00604             \mbox{\hyperlink{a01463_a985cb8c800bd91ceaedd28174df4ed0d}{build\_secs}}(0.0f) \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00605}00605     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00606}00606 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00610}\mbox{\hyperlink{a01467}{00610}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01467}{BVHTraceOptions}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00611}00611     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00612}00612         \textcolor{comment}{// Hit only for face IDs in indexRange.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00613}00613         \textcolor{comment}{// This feature is good to mimic something like glDrawArrays()}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00614}\mbox{\hyperlink{a01467_aa2422cb4eb30dcc6b96800987fd9c5fc}{00614}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01467_aa2422cb4eb30dcc6b96800987fd9c5fc}{prim\_ids\_range}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00615}00615 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00616}00616         \textcolor{comment}{// Prim ID to skip for avoiding self-\/intersection}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00617}00617         \textcolor{comment}{// -\/1 = no skipping}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00618}\mbox{\hyperlink{a01467_a0ad05887cb57228e022d46e95566b3ce}{00618}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01467_a0ad05887cb57228e022d46e95566b3ce}{skip\_prim\_id}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00619}00619 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00620}\mbox{\hyperlink{a01467_adb2d2c476511d304304c4e763a818fc2}{00620}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01467_adb2d2c476511d304304c4e763a818fc2}{cull\_back\_face}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00621}\mbox{\hyperlink{a01467_a53e19da9babb86ca395845e4e782e8b6}{00621}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} \mbox{\hyperlink{a01467_a53e19da9babb86ca395845e4e782e8b6}{pad}}[3];  }
\DoxyCodeLine{\Hypertarget{a00227_source_l00622}00622 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00623}\mbox{\hyperlink{a01467_a981bb66c79e80b4b960dd080a2785d8d}{00623}}         \mbox{\hyperlink{a01467_a981bb66c79e80b4b960dd080a2785d8d}{BVHTraceOptions}}() \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00624}00624             \mbox{\hyperlink{a01467_aa2422cb4eb30dcc6b96800987fd9c5fc}{prim\_ids\_range}}[0] = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00625}00625             \mbox{\hyperlink{a01467_aa2422cb4eb30dcc6b96800987fd9c5fc}{prim\_ids\_range}}[1] = 0x7FFFFFFF;  \textcolor{comment}{// Up to 2G face IDs.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00626}00626 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00627}00627             \mbox{\hyperlink{a01467_a0ad05887cb57228e022d46e95566b3ce}{skip\_prim\_id}} = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(-\/1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00628}00628             \mbox{\hyperlink{a01467_adb2d2c476511d304304c4e763a818fc2}{cull\_back\_face}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00629}00629         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00630}00630     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00631}00631 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00635}00635     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00636}\mbox{\hyperlink{a01471}{00636}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01471}{BBox}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00637}00637     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00638}\mbox{\hyperlink{a01471_aa045e09d02bdee79137a15d04f46471e}{00638}}         \mbox{\hyperlink{a01443}{real3<T>}} \mbox{\hyperlink{a01471_aa045e09d02bdee79137a15d04f46471e}{bmin}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00639}\mbox{\hyperlink{a01471_a1ab4f62812a56eebc185a97afd30ebdd}{00639}}         \mbox{\hyperlink{a01443}{real3<T>}} \mbox{\hyperlink{a01471_a1ab4f62812a56eebc185a97afd30ebdd}{bmax}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00640}00640 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00641}\mbox{\hyperlink{a01471_a7cbb4141301e0b718fc250691455007d}{00641}}         \mbox{\hyperlink{a01471_a7cbb4141301e0b718fc250691455007d}{BBox}}() \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00642}00642             \mbox{\hyperlink{a01471_aa045e09d02bdee79137a15d04f46471e}{bmin}}[0] = \mbox{\hyperlink{a01471_aa045e09d02bdee79137a15d04f46471e}{bmin}}[1] = \mbox{\hyperlink{a01471_aa045e09d02bdee79137a15d04f46471e}{bmin}}[2] = std::numeric\_limits<T>::max();}
\DoxyCodeLine{\Hypertarget{a00227_source_l00643}00643             \mbox{\hyperlink{a01471_a1ab4f62812a56eebc185a97afd30ebdd}{bmax}}[0] = \mbox{\hyperlink{a01471_a1ab4f62812a56eebc185a97afd30ebdd}{bmax}}[1] = \mbox{\hyperlink{a01471_a1ab4f62812a56eebc185a97afd30ebdd}{bmax}}[2] = -\/std::numeric\_limits<T>::max();}
\DoxyCodeLine{\Hypertarget{a00227_source_l00644}00644         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00645}00645     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00646}00646 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00653}00653     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00654}\mbox{\hyperlink{a01475}{00654}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01475}{NodeHit}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00655}00655     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00656}\mbox{\hyperlink{a01475_a3cbd27321bf1a64957b45dfdc1c7b99c}{00656}}         \mbox{\hyperlink{a01475_a3cbd27321bf1a64957b45dfdc1c7b99c}{NodeHit}}()}
\DoxyCodeLine{\Hypertarget{a00227_source_l00657}00657             : \mbox{\hyperlink{a01475_aa90100ff87025e7758063bfa091afb7a}{t\_min}}(\mbox{\hyperlink{a00461}{std}}::numeric\_limits<T>::max()),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00658}00658             \mbox{\hyperlink{a01475_a298cb4f48a58dc6ab54e167d4c6d4063}{t\_max}}(-\/\mbox{\hyperlink{a00461}{std}}::numeric\_limits<T>::max()),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00659}00659             \mbox{\hyperlink{a01475_a28b7322499ae0aee999388858c42622d}{node\_id}}(static\_cast<unsigned int>(-\/1)) \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00660}00660 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00661}\mbox{\hyperlink{a01475_a9d0f07cae0101f24e7a6fdfe71df597a}{00661}}         \mbox{\hyperlink{a01475_a9d0f07cae0101f24e7a6fdfe71df597a}{NodeHit}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01475}{NodeHit<T>}}\& rhs) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00662}00662             \mbox{\hyperlink{a01475_aa90100ff87025e7758063bfa091afb7a}{t\_min}} = rhs.\mbox{\hyperlink{a01475_aa90100ff87025e7758063bfa091afb7a}{t\_min}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00663}00663             \mbox{\hyperlink{a01475_a298cb4f48a58dc6ab54e167d4c6d4063}{t\_max}} = rhs.\mbox{\hyperlink{a01475_a298cb4f48a58dc6ab54e167d4c6d4063}{t\_max}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00664}00664             \mbox{\hyperlink{a01475_a28b7322499ae0aee999388858c42622d}{node\_id}} = rhs.\mbox{\hyperlink{a01475_a28b7322499ae0aee999388858c42622d}{node\_id}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00665}00665         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00666}00666 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00667}\mbox{\hyperlink{a01475_a92ff4dbeec15f664408ad11f1034b0c6}{00667}}         \mbox{\hyperlink{a01475}{NodeHit}}\& \mbox{\hyperlink{a01475_a92ff4dbeec15f664408ad11f1034b0c6}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01475}{NodeHit<T>}}\& rhs) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00668}00668             \mbox{\hyperlink{a01475_aa90100ff87025e7758063bfa091afb7a}{t\_min}} = rhs.\mbox{\hyperlink{a01475_aa90100ff87025e7758063bfa091afb7a}{t\_min}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00669}00669             \mbox{\hyperlink{a01475_a298cb4f48a58dc6ab54e167d4c6d4063}{t\_max}} = rhs.\mbox{\hyperlink{a01475_a298cb4f48a58dc6ab54e167d4c6d4063}{t\_max}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00670}00670             \mbox{\hyperlink{a01475_a28b7322499ae0aee999388858c42622d}{node\_id}} = rhs.\mbox{\hyperlink{a01475_a28b7322499ae0aee999388858c42622d}{node\_id}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00671}00671 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00672}00672             \textcolor{keywordflow}{return} (*\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{a00227_source_l00673}00673         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00674}00674 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00675}\mbox{\hyperlink{a01475_a5b6c8b38b0a393ab08dd024a2d341491}{00675}}         \mbox{\hyperlink{a01475_a5b6c8b38b0a393ab08dd024a2d341491}{\string~NodeHit}}() \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00676}00676 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00677}\mbox{\hyperlink{a01475_aa90100ff87025e7758063bfa091afb7a}{00677}}         T \mbox{\hyperlink{a01475_aa90100ff87025e7758063bfa091afb7a}{t\_min}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00678}\mbox{\hyperlink{a01475_a298cb4f48a58dc6ab54e167d4c6d4063}{00678}}         T \mbox{\hyperlink{a01475_a298cb4f48a58dc6ab54e167d4c6d4063}{t\_max}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00679}\mbox{\hyperlink{a01475_a28b7322499ae0aee999388858c42622d}{00679}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01475_a28b7322499ae0aee999388858c42622d}{node\_id}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00680}00680     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00681}00681 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00687}00687     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00688}\mbox{\hyperlink{a01479}{00688}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01479}{NodeHitComparator}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00689}00689     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00690}\mbox{\hyperlink{a01479_ab04e7242a9fb89d851982610548dbd1d}{00690}}         \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01479_ab04e7242a9fb89d851982610548dbd1d}{operator()}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01475}{NodeHit<T>}}\& a, \textcolor{keyword}{const} \mbox{\hyperlink{a01475}{NodeHit<T>}}\& b) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00691}00691             \textcolor{keywordflow}{return} a.\mbox{\hyperlink{a01475_aa90100ff87025e7758063bfa091afb7a}{t\_min}} < b.\mbox{\hyperlink{a01475_aa90100ff87025e7758063bfa091afb7a}{t\_min}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00692}00692         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00693}00693     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00694}00694 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00704}00704     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00705}\mbox{\hyperlink{a01483}{00705}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01483}{BVHAccel}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00706}00706     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00707}\mbox{\hyperlink{a01483_a30af1a9d966a67bc691ba560883d2780}{00707}}         \mbox{\hyperlink{a01483_a30af1a9d966a67bc691ba560883d2780}{BVHAccel}}() : \mbox{\hyperlink{a01483_ad725bfc4c37130636ef1d9df997b8696}{pad0\_}}(0) \{ (void)\mbox{\hyperlink{a01483_ad725bfc4c37130636ef1d9df997b8696}{pad0\_}}; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00708}\mbox{\hyperlink{a01483_a1773731f48394e7f0a28d2aa9cedf016}{00708}}         \mbox{\hyperlink{a01483_a1773731f48394e7f0a28d2aa9cedf016}{\string~BVHAccel}}() \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00709}00709 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00722}00722         \textcolor{keyword}{template} <\textcolor{keyword}{class} Prim, \textcolor{keyword}{class} Pred>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00723}\mbox{\hyperlink{a01483_a96521982d08e0ccd728798410dabeed5}{00723}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01483_a96521982d08e0ccd728798410dabeed5}{Build}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_primitives, \textcolor{keyword}{const} Prim\& p, \textcolor{keyword}{const} Pred\& pred,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00724}00724             \textcolor{keyword}{const} \mbox{\hyperlink{a01459}{BVHBuildOptions<T>}}\& options = \mbox{\hyperlink{a01459}{BVHBuildOptions<T>}}());}
\DoxyCodeLine{\Hypertarget{a00227_source_l00725}00725 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00731}\mbox{\hyperlink{a01483_af29580ba0608043d3776a05fb6e2eee4}{00731}}         \mbox{\hyperlink{a01463}{BVHBuildStatistics}} \mbox{\hyperlink{a01483_af29580ba0608043d3776a05fb6e2eee4}{GetStatistics}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01483_ae10926e89f91be8a3bb3fa2dd38e267b}{stats\_}}; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00732}00732 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00733}00733 \textcolor{preprocessor}{\#if defined(NANORT\_ENABLE\_SERIALIZATION)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00737}00737         \textcolor{keywordtype}{bool} Dump(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* filename) \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00738}00738         \textcolor{keywordtype}{bool} Dump(FILE* fp) \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00739}00739 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00743}00743         \textcolor{keywordtype}{bool} Load(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* filename);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00744}00744         \textcolor{keywordtype}{bool} Load(FILE* fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00745}00745 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00746}00746 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00747}\mbox{\hyperlink{a01483_a1b5f5fb5f85cf6a91987c14aa70ab456}{00747}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{a01483_a1b5f5fb5f85cf6a91987c14aa70ab456}{Debug}}();}
\DoxyCodeLine{\Hypertarget{a00227_source_l00748}00748 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00763}00763         \textcolor{keyword}{template} <\textcolor{keyword}{class} I, \textcolor{keyword}{class} H>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00764}\mbox{\hyperlink{a01483_a4d07d0fc035d860dd1bfbeaa90c14a11}{00764}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01483_a4d07d0fc035d860dd1bfbeaa90c14a11}{Traverse}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01447}{Ray<T>}}\& ray, \textcolor{keyword}{const} I\& intersector, H* isect,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00765}00765             \textcolor{keyword}{const} \mbox{\hyperlink{a01467}{BVHTraceOptions}}\& options = \mbox{\hyperlink{a01467}{BVHTraceOptions}}()) \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00766}00766 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00767}00767 \textcolor{preprocessor}{\#if 0}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00770}00770         \textcolor{keyword}{template}<\textcolor{keyword}{class} I, \textcolor{keyword}{class} H, \textcolor{keyword}{class} Comp>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00771}00771         \textcolor{keywordtype}{bool} MultiHitTraverse(\textcolor{keyword}{const} \mbox{\hyperlink{a01447}{Ray<T>}}\& ray,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00772}00772             \textcolor{keywordtype}{int} max\_intersections,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00773}00773             \textcolor{keyword}{const} I\& intersector,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00774}00774             \mbox{\hyperlink{a01439}{StackVector<H, 128>}}* isects,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00775}00775             \textcolor{keyword}{const} \mbox{\hyperlink{a01467}{BVHTraceOptions}}\& options = \mbox{\hyperlink{a01467}{BVHTraceOptions}}()) \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00776}00776 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00777}00777 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00787}00787         \textcolor{keyword}{template} <\textcolor{keyword}{class} I>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00788}\mbox{\hyperlink{a01483_a5f253e3bfd6bbefe21eb3c8faa881d59}{00788}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01483_a5f253e3bfd6bbefe21eb3c8faa881d59}{ListNodeIntersections}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01447}{Ray<T>}}\& ray, \textcolor{keywordtype}{int} max\_intersections,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00789}00789             \textcolor{keyword}{const} I\& intersector,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00790}00790             \mbox{\hyperlink{a01439}{StackVector}}<\mbox{\hyperlink{a01475}{NodeHit<T>}}, 128>* hits) \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00791}00791 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00792}\mbox{\hyperlink{a01483_aa419b572a1f578f693dbb42881833a34}{00792}}         \textcolor{keyword}{const} std::vector<BVHNode<T> >\& \mbox{\hyperlink{a01483_aa419b572a1f578f693dbb42881833a34}{GetNodes}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01483_ae4aa82a8281d54969ec85d6fe6f23195}{nodes\_}}; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00793}\mbox{\hyperlink{a01483_a9eec6502123ac452cf6052d2daff5486}{00793}}         \textcolor{keyword}{const} std::vector<unsigned int>\& \mbox{\hyperlink{a01483_a9eec6502123ac452cf6052d2daff5486}{GetIndices}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01483_a0137342b4dbaf88f78c7bcd77a1e484b}{indices\_}}; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00794}00794 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00798}\mbox{\hyperlink{a01483_a9533de0b8a6bc98cc09b33e319a4081b}{00798}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{a01483_a9533de0b8a6bc98cc09b33e319a4081b}{BoundingBox}}(T bmin[3], T bmax[3])\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00799}00799             \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01483_ae4aa82a8281d54969ec85d6fe6f23195}{nodes\_}}.empty()) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00800}00800                 bmin[0] = bmin[1] = bmin[2] = std::numeric\_limits<T>::max();}
\DoxyCodeLine{\Hypertarget{a00227_source_l00801}00801                 bmax[0] = bmax[1] = bmax[2] = -\/std::numeric\_limits<T>::max();}
\DoxyCodeLine{\Hypertarget{a00227_source_l00802}00802             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00803}00803             \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00804}00804                 bmin[0] = \mbox{\hyperlink{a01483_ae4aa82a8281d54969ec85d6fe6f23195}{nodes\_}}[0].bmin[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00805}00805                 bmin[1] = \mbox{\hyperlink{a01483_ae4aa82a8281d54969ec85d6fe6f23195}{nodes\_}}[0].bmin[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00806}00806                 bmin[2] = \mbox{\hyperlink{a01483_ae4aa82a8281d54969ec85d6fe6f23195}{nodes\_}}[0].bmin[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00807}00807                 bmax[0] = \mbox{\hyperlink{a01483_ae4aa82a8281d54969ec85d6fe6f23195}{nodes\_}}[0].bmax[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00808}00808                 bmax[1] = \mbox{\hyperlink{a01483_ae4aa82a8281d54969ec85d6fe6f23195}{nodes\_}}[0].bmax[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00809}00809                 bmax[2] = \mbox{\hyperlink{a01483_ae4aa82a8281d54969ec85d6fe6f23195}{nodes\_}}[0].bmax[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00810}00810             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00811}00811         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00812}00812 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00813}\mbox{\hyperlink{a01483_a5ce72b4a1ba1b3c0254f76287a98e56a}{00813}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01483_a5ce72b4a1ba1b3c0254f76287a98e56a}{IsValid}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01483_ae4aa82a8281d54969ec85d6fe6f23195}{nodes\_}}.size() > 0; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00814}00814 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00815}00815     \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00816}00816 \textcolor{preprocessor}{\#if defined(NANORT\_ENABLE\_PARALLEL\_BUILD)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00817}00817         \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00818}00818             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} left\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00819}00819             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} right\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00820}00820             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} offset;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00821}00821         \} ShallowNodeInfo;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00822}00822 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00823}00823         \textcolor{comment}{// Used only during BVH construction}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00824}00824         std::vector<ShallowNodeInfo> shallow\_node\_infos\_;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00825}00825 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00827}00827         \textcolor{keyword}{template} <\textcolor{keyword}{class} P, \textcolor{keyword}{class} Pred>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00828}00828         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} BuildShallowTree(std::vector<BVHNode<T> >* out\_nodes,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00829}00829             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} left\_idx, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} right\_idx,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00830}00830             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} depth,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00831}00831             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} max\_shallow\_depth, \textcolor{keyword}{const} P\& p,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00832}00832             \textcolor{keyword}{const} Pred\& pred);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00833}00833 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00834}00834 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00836}00836         \textcolor{keyword}{template} <\textcolor{keyword}{class} P, \textcolor{keyword}{class} Pred>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00837}\mbox{\hyperlink{a01483_ae0e4bf0fab331dbacf469a3e991132e5}{00837}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01483_ae0e4bf0fab331dbacf469a3e991132e5}{BuildTree}}(\mbox{\hyperlink{a01463}{BVHBuildStatistics}}* out\_stat,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00838}00838             std::vector<\mbox{\hyperlink{a01451}{BVHNode<T>}} >* out\_nodes,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00839}00839             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} left\_idx, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} right\_idx,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00840}00840             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} depth, \textcolor{keyword}{const} P\& p, \textcolor{keyword}{const} Pred\& pred);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00841}00841 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00842}00842         \textcolor{keyword}{template} <\textcolor{keyword}{class} I>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00843}\mbox{\hyperlink{a01483_ab231cc4c34a80708f5f9c452a46006a0}{00843}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01483_ab231cc4c34a80708f5f9c452a46006a0}{TestLeafNode}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01451}{BVHNode<T>}}\& node, \textcolor{keyword}{const} \mbox{\hyperlink{a01447}{Ray<T>}}\& ray,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00844}00844             \textcolor{keyword}{const} I\& intersector) \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00845}00845 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00846}00846         \textcolor{keyword}{template} <\textcolor{keyword}{class} I>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00847}\mbox{\hyperlink{a01483_a2669f66e17a1c33848c34dde88d1ccaa}{00847}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01483_a2669f66e17a1c33848c34dde88d1ccaa}{TestLeafNodeIntersections}}(}
\DoxyCodeLine{\Hypertarget{a00227_source_l00848}00848             \textcolor{keyword}{const} \mbox{\hyperlink{a01451}{BVHNode<T>}}\& node, \textcolor{keyword}{const} \mbox{\hyperlink{a01447}{Ray<T>}}\& ray, \textcolor{keyword}{const} \textcolor{keywordtype}{int} max\_intersections,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00849}00849             \textcolor{keyword}{const} I\& intersector,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00850}00850             std::priority\_queue<\mbox{\hyperlink{a01475}{NodeHit<T>}}, std::vector<\mbox{\hyperlink{a01475}{NodeHit<T>}} >,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00851}00851             \mbox{\hyperlink{a01479}{NodeHitComparator<T>}} >* isect\_pq) \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00852}00852 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00853}00853 \textcolor{preprocessor}{\#if 0}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00854}00854         \textcolor{keyword}{template}<\textcolor{keyword}{class} I, \textcolor{keyword}{class} H, \textcolor{keyword}{class} Comp>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00855}00855         \textcolor{keywordtype}{bool} MultiHitTestLeafNode(std::priority\_queue<H, std::vector<H>, Comp>* isect\_pq,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00856}00856             \textcolor{keywordtype}{int} max\_intersections,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00857}00857             \textcolor{keyword}{const} \mbox{\hyperlink{a01451}{BVHNode<T>}}\& node, \textcolor{keyword}{const} \mbox{\hyperlink{a01447}{Ray<T>}}\& ray,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00858}00858             \textcolor{keyword}{const} I\& intersector) \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00859}00859 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00860}00860 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00861}\mbox{\hyperlink{a01483_ae4aa82a8281d54969ec85d6fe6f23195}{00861}}         std::vector<BVHNode<T> > \mbox{\hyperlink{a01483_ae4aa82a8281d54969ec85d6fe6f23195}{nodes\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00862}\mbox{\hyperlink{a01483_a0137342b4dbaf88f78c7bcd77a1e484b}{00862}}         std::vector<unsigned int> \mbox{\hyperlink{a01483_a0137342b4dbaf88f78c7bcd77a1e484b}{indices\_}};  \textcolor{comment}{// max 4G triangles.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00863}\mbox{\hyperlink{a01483_ad1a08e2f0c69477a04a836e7c7fe933d}{00863}}         std::vector<BBox<T> > \mbox{\hyperlink{a01483_ad1a08e2f0c69477a04a836e7c7fe933d}{bboxes\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00864}\mbox{\hyperlink{a01483_a5f19f074b2fe2d5ca6426a5789960432}{00864}}         \mbox{\hyperlink{a01459}{BVHBuildOptions<T>}} \mbox{\hyperlink{a01483_a5f19f074b2fe2d5ca6426a5789960432}{options\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00865}\mbox{\hyperlink{a01483_ae10926e89f91be8a3bb3fa2dd38e267b}{00865}}         \mbox{\hyperlink{a01463}{BVHBuildStatistics}} \mbox{\hyperlink{a01483_ae10926e89f91be8a3bb3fa2dd38e267b}{stats\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00866}\mbox{\hyperlink{a01483_ad725bfc4c37130636ef1d9df997b8696}{00866}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01483_ad725bfc4c37130636ef1d9df997b8696}{pad0\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00867}00867     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00868}00868 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00869}00869     \textcolor{comment}{// Predefined SAH predicator for triangle.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00870}00870     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T = \textcolor{keywordtype}{float}>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00871}\mbox{\hyperlink{a01487}{00871}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01487}{TriangleSAHPred}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00872}00872     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00873}\mbox{\hyperlink{a01487_a9650f6d351ac3df4eebf0c3101a78a0b}{00873}}         \mbox{\hyperlink{a01487_a9650f6d351ac3df4eebf0c3101a78a0b}{TriangleSAHPred}}(}
\DoxyCodeLine{\Hypertarget{a00227_source_l00874}00874             \textcolor{keyword}{const} T* vertices, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* faces,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00875}00875             \textcolor{keywordtype}{size\_t} vertex\_stride\_bytes)  \textcolor{comment}{// e.g. 12 for sizeof(float) * XYZ}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00876}00876             : \mbox{\hyperlink{a01487_aa0607edac35ea7ee2ce6536483a1d969}{axis\_}}(0),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00877}00877             \mbox{\hyperlink{a01487_a384c28581fe8e53b84e2b6a288fede94}{pos\_}}(static\_cast<T>(0.0)),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00878}00878             \mbox{\hyperlink{a01487_ad74375fe9bf1778ca16d15f756e61504}{vertices\_}}(vertices),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00879}00879             \mbox{\hyperlink{a01487_a1b40fbb2b832ee1bd929bc76ca08256a}{faces\_}}(faces),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00880}00880             \mbox{\hyperlink{a01487_a1562971080d1d2c4360a9de0bede9a28}{vertex\_stride\_bytes\_}}(vertex\_stride\_bytes) \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00881}00881 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00882}\mbox{\hyperlink{a01487_a3f78790b2623dedc78de58273fe63465}{00882}}         \mbox{\hyperlink{a01487_a3f78790b2623dedc78de58273fe63465}{TriangleSAHPred}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01487}{TriangleSAHPred<T>}}\& rhs)}
\DoxyCodeLine{\Hypertarget{a00227_source_l00883}00883             : \mbox{\hyperlink{a01487_aa0607edac35ea7ee2ce6536483a1d969}{axis\_}}(rhs.\mbox{\hyperlink{a01487_aa0607edac35ea7ee2ce6536483a1d969}{axis\_}}),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00884}00884             \mbox{\hyperlink{a01487_a384c28581fe8e53b84e2b6a288fede94}{pos\_}}(rhs.\mbox{\hyperlink{a01487_a384c28581fe8e53b84e2b6a288fede94}{pos\_}}),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00885}00885             \mbox{\hyperlink{a01487_ad74375fe9bf1778ca16d15f756e61504}{vertices\_}}(rhs.\mbox{\hyperlink{a01487_ad74375fe9bf1778ca16d15f756e61504}{vertices\_}}),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00886}00886             \mbox{\hyperlink{a01487_a1b40fbb2b832ee1bd929bc76ca08256a}{faces\_}}(rhs.\mbox{\hyperlink{a01487_a1b40fbb2b832ee1bd929bc76ca08256a}{faces\_}}),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00887}00887             \mbox{\hyperlink{a01487_a1562971080d1d2c4360a9de0bede9a28}{vertex\_stride\_bytes\_}}(rhs.\mbox{\hyperlink{a01487_a1562971080d1d2c4360a9de0bede9a28}{vertex\_stride\_bytes\_}}) \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00888}00888 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00889}\mbox{\hyperlink{a01487_aab471a1a6359638bcb78fb3c76f93fae}{00889}}         \mbox{\hyperlink{a01487}{TriangleSAHPred<T>}}\& \mbox{\hyperlink{a01487_aab471a1a6359638bcb78fb3c76f93fae}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01487}{TriangleSAHPred<T>}}\& rhs) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00890}00890             \mbox{\hyperlink{a01487_aa0607edac35ea7ee2ce6536483a1d969}{axis\_}} = rhs.\mbox{\hyperlink{a01487_aa0607edac35ea7ee2ce6536483a1d969}{axis\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00891}00891             \mbox{\hyperlink{a01487_a384c28581fe8e53b84e2b6a288fede94}{pos\_}} = rhs.\mbox{\hyperlink{a01487_a384c28581fe8e53b84e2b6a288fede94}{pos\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00892}00892             \mbox{\hyperlink{a01487_ad74375fe9bf1778ca16d15f756e61504}{vertices\_}} = rhs.\mbox{\hyperlink{a01487_ad74375fe9bf1778ca16d15f756e61504}{vertices\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00893}00893             \mbox{\hyperlink{a01487_a1b40fbb2b832ee1bd929bc76ca08256a}{faces\_}} = rhs.\mbox{\hyperlink{a01487_a1b40fbb2b832ee1bd929bc76ca08256a}{faces\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00894}00894             \mbox{\hyperlink{a01487_a1562971080d1d2c4360a9de0bede9a28}{vertex\_stride\_bytes\_}} = rhs.\mbox{\hyperlink{a01487_a1562971080d1d2c4360a9de0bede9a28}{vertex\_stride\_bytes\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00895}00895 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00896}00896             \textcolor{keywordflow}{return} (*\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{a00227_source_l00897}00897         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00898}00898 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00899}\mbox{\hyperlink{a01487_a20476d86c33567f87874a9e6e0a639ea}{00899}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{a01487_a20476d86c33567f87874a9e6e0a639ea}{Set}}(\textcolor{keywordtype}{int} axis, T pos)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00900}00900             \mbox{\hyperlink{a01487_aa0607edac35ea7ee2ce6536483a1d969}{axis\_}} = axis;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00901}00901             \mbox{\hyperlink{a01487_a384c28581fe8e53b84e2b6a288fede94}{pos\_}} = pos;}
\DoxyCodeLine{\Hypertarget{a00227_source_l00902}00902         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00903}00903 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00904}\mbox{\hyperlink{a01487_ab990c49c5a9bc9037e378e615ae96e8c}{00904}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01487_ab990c49c5a9bc9037e378e615ae96e8c}{operator()}}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00905}00905             \textcolor{keywordtype}{int} axis = \mbox{\hyperlink{a01487_aa0607edac35ea7ee2ce6536483a1d969}{axis\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00906}00906             T pos = \mbox{\hyperlink{a01487_a384c28581fe8e53b84e2b6a288fede94}{pos\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00907}00907 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00908}00908             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i0 = \mbox{\hyperlink{a01487_a1b40fbb2b832ee1bd929bc76ca08256a}{faces\_}}[3 * i + 0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00909}00909             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i1 = \mbox{\hyperlink{a01487_a1b40fbb2b832ee1bd929bc76ca08256a}{faces\_}}[3 * i + 1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00910}00910             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i2 = \mbox{\hyperlink{a01487_a1b40fbb2b832ee1bd929bc76ca08256a}{faces\_}}[3 * i + 2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00911}00911 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00912}00912             \mbox{\hyperlink{a01443}{real3<T>}} p0(get\_vertex\_addr<T>(\mbox{\hyperlink{a01487_ad74375fe9bf1778ca16d15f756e61504}{vertices\_}}, i0, \mbox{\hyperlink{a01487_a1562971080d1d2c4360a9de0bede9a28}{vertex\_stride\_bytes\_}}));}
\DoxyCodeLine{\Hypertarget{a00227_source_l00913}00913             \mbox{\hyperlink{a01443}{real3<T>}} p1(get\_vertex\_addr<T>(\mbox{\hyperlink{a01487_ad74375fe9bf1778ca16d15f756e61504}{vertices\_}}, i1, \mbox{\hyperlink{a01487_a1562971080d1d2c4360a9de0bede9a28}{vertex\_stride\_bytes\_}}));}
\DoxyCodeLine{\Hypertarget{a00227_source_l00914}00914             \mbox{\hyperlink{a01443}{real3<T>}} p2(get\_vertex\_addr<T>(\mbox{\hyperlink{a01487_ad74375fe9bf1778ca16d15f756e61504}{vertices\_}}, i2, \mbox{\hyperlink{a01487_a1562971080d1d2c4360a9de0bede9a28}{vertex\_stride\_bytes\_}}));}
\DoxyCodeLine{\Hypertarget{a00227_source_l00915}00915 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00916}00916             T center = p0[axis] + p1[axis] + p2[axis];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00917}00917 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00918}00918             \textcolor{keywordflow}{return} (center < pos* \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(3.0));}
\DoxyCodeLine{\Hypertarget{a00227_source_l00919}00919         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00920}00920 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00921}00921     \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00922}\mbox{\hyperlink{a01487_aa0607edac35ea7ee2ce6536483a1d969}{00922}}         \textcolor{keyword}{mutable} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01487_aa0607edac35ea7ee2ce6536483a1d969}{axis\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00923}\mbox{\hyperlink{a01487_a384c28581fe8e53b84e2b6a288fede94}{00923}}         \textcolor{keyword}{mutable} T \mbox{\hyperlink{a01487_a384c28581fe8e53b84e2b6a288fede94}{pos\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00924}\mbox{\hyperlink{a01487_ad74375fe9bf1778ca16d15f756e61504}{00924}}         \textcolor{keyword}{const} T* \mbox{\hyperlink{a01487_ad74375fe9bf1778ca16d15f756e61504}{vertices\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00925}\mbox{\hyperlink{a01487_a1b40fbb2b832ee1bd929bc76ca08256a}{00925}}         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* \mbox{\hyperlink{a01487_a1b40fbb2b832ee1bd929bc76ca08256a}{faces\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00926}\mbox{\hyperlink{a01487_a1562971080d1d2c4360a9de0bede9a28}{00926}}         \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{a01487_a1562971080d1d2c4360a9de0bede9a28}{vertex\_stride\_bytes\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00927}00927     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00928}00928 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00929}00929     \textcolor{comment}{// Predefined Triangle mesh geometry.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00930}00930     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T = \textcolor{keywordtype}{float}>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00931}\mbox{\hyperlink{a01491}{00931}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01491}{TriangleMesh}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00932}00932     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00933}\mbox{\hyperlink{a01491_a32cd510ea8e0276dc5439c7a1796086f}{00933}}         \mbox{\hyperlink{a01491_a32cd510ea8e0276dc5439c7a1796086f}{TriangleMesh}}(}
\DoxyCodeLine{\Hypertarget{a00227_source_l00934}00934             \textcolor{keyword}{const} T* vertices, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* faces,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00935}00935             \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} vertex\_stride\_bytes)  \textcolor{comment}{// e.g. 12 for sizeof(float) * XYZ}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00936}00936             : \mbox{\hyperlink{a01491_ad54d35e1547503e0836ec80055edb321}{vertices\_}}(vertices),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00937}00937             \mbox{\hyperlink{a01491_a9fa28231b36b157f04049ab7a322d084}{faces\_}}(faces),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00938}00938             \mbox{\hyperlink{a01491_a9e61d3353019f001c7cebb5807bf6977}{vertex\_stride\_bytes\_}}(vertex\_stride\_bytes) \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00939}00939 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00942}\mbox{\hyperlink{a01491_aba236136712b2ac9ed6a732a92649839}{00942}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{a01491_aba236136712b2ac9ed6a732a92649839}{BoundingBox}}(\mbox{\hyperlink{a01443}{real3<T>}}* bmin, \mbox{\hyperlink{a01443}{real3<T>}}* bmax,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00943}00943             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} prim\_index)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00944}00944             \textcolor{keywordtype}{unsigned} vertex = \mbox{\hyperlink{a01491_a9fa28231b36b157f04049ab7a322d084}{faces\_}}[3 * prim\_index + 0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00945}00945 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00946}00946             (*bmin)[0] = \mbox{\hyperlink{a00474_a91c0c4ec5d542629d67b60c3bf0e7848}{get\_vertex\_addr}}(\mbox{\hyperlink{a01491_ad54d35e1547503e0836ec80055edb321}{vertices\_}}, vertex, \mbox{\hyperlink{a01491_a9e61d3353019f001c7cebb5807bf6977}{vertex\_stride\_bytes\_}})[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00947}00947             (*bmin)[1] = \mbox{\hyperlink{a00474_a91c0c4ec5d542629d67b60c3bf0e7848}{get\_vertex\_addr}}(\mbox{\hyperlink{a01491_ad54d35e1547503e0836ec80055edb321}{vertices\_}}, vertex, \mbox{\hyperlink{a01491_a9e61d3353019f001c7cebb5807bf6977}{vertex\_stride\_bytes\_}})[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00948}00948             (*bmin)[2] = \mbox{\hyperlink{a00474_a91c0c4ec5d542629d67b60c3bf0e7848}{get\_vertex\_addr}}(\mbox{\hyperlink{a01491_ad54d35e1547503e0836ec80055edb321}{vertices\_}}, vertex, \mbox{\hyperlink{a01491_a9e61d3353019f001c7cebb5807bf6977}{vertex\_stride\_bytes\_}})[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00949}00949             (*bmax)[0] = \mbox{\hyperlink{a00474_a91c0c4ec5d542629d67b60c3bf0e7848}{get\_vertex\_addr}}(\mbox{\hyperlink{a01491_ad54d35e1547503e0836ec80055edb321}{vertices\_}}, vertex, \mbox{\hyperlink{a01491_a9e61d3353019f001c7cebb5807bf6977}{vertex\_stride\_bytes\_}})[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00950}00950             (*bmax)[1] = \mbox{\hyperlink{a00474_a91c0c4ec5d542629d67b60c3bf0e7848}{get\_vertex\_addr}}(\mbox{\hyperlink{a01491_ad54d35e1547503e0836ec80055edb321}{vertices\_}}, vertex, \mbox{\hyperlink{a01491_a9e61d3353019f001c7cebb5807bf6977}{vertex\_stride\_bytes\_}})[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00951}00951             (*bmax)[2] = \mbox{\hyperlink{a00474_a91c0c4ec5d542629d67b60c3bf0e7848}{get\_vertex\_addr}}(\mbox{\hyperlink{a01491_ad54d35e1547503e0836ec80055edb321}{vertices\_}}, vertex, \mbox{\hyperlink{a01491_a9e61d3353019f001c7cebb5807bf6977}{vertex\_stride\_bytes\_}})[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00952}00952 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00953}00953             \textcolor{comment}{// remaining two vertices of the primitive}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00954}00954             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 1; i < 3; i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00955}00955                 \textcolor{comment}{// xyz}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00956}00956                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 3; k++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00957}00957                     T coord = get\_vertex\_addr<T>(\mbox{\hyperlink{a01491_ad54d35e1547503e0836ec80055edb321}{vertices\_}}, \mbox{\hyperlink{a01491_a9fa28231b36b157f04049ab7a322d084}{faces\_}}[3 * prim\_index + i],}
\DoxyCodeLine{\Hypertarget{a00227_source_l00958}00958                         \mbox{\hyperlink{a01491_a9e61d3353019f001c7cebb5807bf6977}{vertex\_stride\_bytes\_}})[k];}
\DoxyCodeLine{\Hypertarget{a00227_source_l00959}00959 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00960}00960                     (*bmin)[k] = std::min((*bmin)[k], coord);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00961}00961                     (*bmax)[k] = std::max((*bmax)[k], coord);}
\DoxyCodeLine{\Hypertarget{a00227_source_l00962}00962                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00963}00963             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00964}00964         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00965}00965 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00966}\mbox{\hyperlink{a01491_ad54d35e1547503e0836ec80055edb321}{00966}}         \textcolor{keyword}{const} T* \mbox{\hyperlink{a01491_ad54d35e1547503e0836ec80055edb321}{vertices\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00967}\mbox{\hyperlink{a01491_a9fa28231b36b157f04049ab7a322d084}{00967}}         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* \mbox{\hyperlink{a01491_a9fa28231b36b157f04049ab7a322d084}{faces\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00968}\mbox{\hyperlink{a01491_a9e61d3353019f001c7cebb5807bf6977}{00968}}         \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{a01491_a9e61d3353019f001c7cebb5807bf6977}{vertex\_stride\_bytes\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00969}00969     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00970}00970 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00971}00971     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T = \textcolor{keywordtype}{float}>}
\DoxyCodeLine{\Hypertarget{a00227_source_l00972}\mbox{\hyperlink{a00474}{00972}}     \textcolor{keyword}{class }\mbox{\hyperlink{a00474_a01495}{TriangleIntersection}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00973}00973     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00974}\mbox{\hyperlink{a00474_a3deaad23e30bd59d6932533d99a9927a}{00974}}         T \mbox{\hyperlink{a00474_a3deaad23e30bd59d6932533d99a9927a}{u}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00975}\mbox{\hyperlink{a00474_a19beb63051e1c58b701fa132554816b1}{00975}}         T \mbox{\hyperlink{a00474_a19beb63051e1c58b701fa132554816b1}{v}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00976}00976 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00977}00977         \textcolor{comment}{// Required member variables.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00978}\mbox{\hyperlink{a00474_ac6905be589222ab5c6d8367bee4370aa}{00978}}         T \mbox{\hyperlink{a00474_ac6905be589222ab5c6d8367bee4370aa}{t}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00979}\mbox{\hyperlink{a00474_a1e3062943d9c131ef207cf4f92cd15b9}{00979}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a00474_a1e3062943d9c131ef207cf4f92cd15b9}{prim\_id}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00980}00980     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00981}00981 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00982}00982     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T = \textcolor{keywordtype}{float}, \textcolor{keyword}{class} H = TriangleIntersection<T> >}
\DoxyCodeLine{\Hypertarget{a00227_source_l00983}\mbox{\hyperlink{a01499}{00983}}     \textcolor{keyword}{class }\mbox{\hyperlink{a01499}{TriangleIntersector}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00984}00984     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l00985}\mbox{\hyperlink{a01499_a2181f19ddf2184cc93d1dc31103b9949}{00985}}         \mbox{\hyperlink{a01499_a2181f19ddf2184cc93d1dc31103b9949}{TriangleIntersector}}(\textcolor{keyword}{const} T* vertices, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* faces,}
\DoxyCodeLine{\Hypertarget{a00227_source_l00986}00986             \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} vertex\_stride\_bytes)  \textcolor{comment}{// e.g.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00987}00987                                                \textcolor{comment}{// vertex\_stride\_bytes}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00988}00988                                                \textcolor{comment}{// = 12 = sizeof(float)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00989}00989                                                \textcolor{comment}{// * 3}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00990}00990             : \mbox{\hyperlink{a01499_a2cb6f374b8f26629e3c01bc1d5b49281}{vertices\_}}(vertices),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00991}00991             \mbox{\hyperlink{a01499_af15783141ac090475a0ab5511f7e37ea}{faces\_}}(faces),}
\DoxyCodeLine{\Hypertarget{a00227_source_l00992}00992             \mbox{\hyperlink{a01499_a1782017f63d67ebf1e63bc56b7f4d13b}{vertex\_stride\_bytes\_}}(vertex\_stride\_bytes) \{\}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00993}00993 }
\DoxyCodeLine{\Hypertarget{a00227_source_l00994}00994         \textcolor{comment}{// For Watertight Ray/Triangle Intersection.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l00995}\mbox{\hyperlink{a01499}{00995}}         \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l00996}\mbox{\hyperlink{a01499_a2cac34b6bd01583a2ff88af0eb6f1c86}{00996}}             T \mbox{\hyperlink{a01499_a2cac34b6bd01583a2ff88af0eb6f1c86}{Sx}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00997}\mbox{\hyperlink{a01499_aa79bacc86198f6bca3cd7aafbee465d5}{00997}}             T \mbox{\hyperlink{a01499_aa79bacc86198f6bca3cd7aafbee465d5}{Sy}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00998}\mbox{\hyperlink{a01499_aec0f701c604c6521b99d57b5ff3b0c39}{00998}}             T \mbox{\hyperlink{a01499_aec0f701c604c6521b99d57b5ff3b0c39}{Sz}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l00999}\mbox{\hyperlink{a01499_a9e85b4e367c2390c4654ec819a75741d}{00999}}             \textcolor{keywordtype}{int} \mbox{\hyperlink{a01499_a9e85b4e367c2390c4654ec819a75741d}{kx}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01000}\mbox{\hyperlink{a01499_acecad1b0d9d78eb0c2e41813c5b1427c}{01000}}             \textcolor{keywordtype}{int} \mbox{\hyperlink{a01499_acecad1b0d9d78eb0c2e41813c5b1427c}{ky}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01001}\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{01001}}             \textcolor{keywordtype}{int} \mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01002}01002         \} \mbox{\hyperlink{a01499_a01503}{RayCoeff}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01003}01003 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01007}\mbox{\hyperlink{a01499_ac392e9a3133446809b902a178ea9092b}{01007}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01499_ac392e9a3133446809b902a178ea9092b}{Intersect}}(T* t\_inout, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} prim\_index)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01008}01008             \textcolor{keywordflow}{if} ((prim\_index < \mbox{\hyperlink{a01499_a6d0ea73ee3e801f2d4d14807f2d35008}{trace\_options\_}}.\mbox{\hyperlink{a01467_aa2422cb4eb30dcc6b96800987fd9c5fc}{prim\_ids\_range}}[0]) ||}
\DoxyCodeLine{\Hypertarget{a00227_source_l01009}01009                 (prim\_index >= \mbox{\hyperlink{a01499_a6d0ea73ee3e801f2d4d14807f2d35008}{trace\_options\_}}.\mbox{\hyperlink{a01467_aa2422cb4eb30dcc6b96800987fd9c5fc}{prim\_ids\_range}}[1])) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01010}01010                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01011}01011             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01012}01012 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01013}01013             \textcolor{comment}{// Self-\/intersection test.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01014}01014             \textcolor{keywordflow}{if} (prim\_index == \mbox{\hyperlink{a01499_a6d0ea73ee3e801f2d4d14807f2d35008}{trace\_options\_}}.\mbox{\hyperlink{a01467_a0ad05887cb57228e022d46e95566b3ce}{skip\_prim\_id}}) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01015}01015                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01016}01016             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01017}01017 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01018}01018             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} f0 = \mbox{\hyperlink{a01499_af15783141ac090475a0ab5511f7e37ea}{faces\_}}[3 * prim\_index + 0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01019}01019             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} f1 = \mbox{\hyperlink{a01499_af15783141ac090475a0ab5511f7e37ea}{faces\_}}[3 * prim\_index + 1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01020}01020             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} f2 = \mbox{\hyperlink{a01499_af15783141ac090475a0ab5511f7e37ea}{faces\_}}[3 * prim\_index + 2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01021}01021 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01022}01022             \textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}} p0(\mbox{\hyperlink{a00474_a91c0c4ec5d542629d67b60c3bf0e7848}{get\_vertex\_addr}}(\mbox{\hyperlink{a01499_a2cb6f374b8f26629e3c01bc1d5b49281}{vertices\_}}, f0 + 0, \mbox{\hyperlink{a01499_a1782017f63d67ebf1e63bc56b7f4d13b}{vertex\_stride\_bytes\_}}));}
\DoxyCodeLine{\Hypertarget{a00227_source_l01023}01023             \textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}} p1(\mbox{\hyperlink{a00474_a91c0c4ec5d542629d67b60c3bf0e7848}{get\_vertex\_addr}}(\mbox{\hyperlink{a01499_a2cb6f374b8f26629e3c01bc1d5b49281}{vertices\_}}, f1 + 0, \mbox{\hyperlink{a01499_a1782017f63d67ebf1e63bc56b7f4d13b}{vertex\_stride\_bytes\_}}));}
\DoxyCodeLine{\Hypertarget{a00227_source_l01024}01024             \textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}} p2(\mbox{\hyperlink{a00474_a91c0c4ec5d542629d67b60c3bf0e7848}{get\_vertex\_addr}}(\mbox{\hyperlink{a01499_a2cb6f374b8f26629e3c01bc1d5b49281}{vertices\_}}, f2 + 0, \mbox{\hyperlink{a01499_a1782017f63d67ebf1e63bc56b7f4d13b}{vertex\_stride\_bytes\_}}));}
\DoxyCodeLine{\Hypertarget{a00227_source_l01025}01025 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01026}01026             \textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}} A = p0 -\/ \mbox{\hyperlink{a01499_acc4cab87b7ed0b510dc0ddccbf2ab949}{ray\_org\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01027}01027             \textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}} B = p1 -\/ \mbox{\hyperlink{a01499_acc4cab87b7ed0b510dc0ddccbf2ab949}{ray\_org\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01028}01028             \textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}} C = p2 -\/ \mbox{\hyperlink{a01499_acc4cab87b7ed0b510dc0ddccbf2ab949}{ray\_org\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01029}01029 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01030}01030             \textcolor{keyword}{const} T Ax = A[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a9e85b4e367c2390c4654ec819a75741d}{kx}}] -\/ \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a2cac34b6bd01583a2ff88af0eb6f1c86}{Sx}} * A[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01031}01031             \textcolor{keyword}{const} T Ay = A[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_acecad1b0d9d78eb0c2e41813c5b1427c}{ky}}] -\/ \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_aa79bacc86198f6bca3cd7aafbee465d5}{Sy}} * A[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01032}01032             \textcolor{keyword}{const} T Bx = B[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a9e85b4e367c2390c4654ec819a75741d}{kx}}] -\/ \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a2cac34b6bd01583a2ff88af0eb6f1c86}{Sx}} * B[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01033}01033             \textcolor{keyword}{const} T By = B[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_acecad1b0d9d78eb0c2e41813c5b1427c}{ky}}] -\/ \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_aa79bacc86198f6bca3cd7aafbee465d5}{Sy}} * B[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01034}01034             \textcolor{keyword}{const} T Cx = C[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a9e85b4e367c2390c4654ec819a75741d}{kx}}] -\/ \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a2cac34b6bd01583a2ff88af0eb6f1c86}{Sx}} * C[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01035}01035             \textcolor{keyword}{const} T Cy = C[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_acecad1b0d9d78eb0c2e41813c5b1427c}{ky}}] -\/ \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_aa79bacc86198f6bca3cd7aafbee465d5}{Sy}} * C[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01036}01036 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01037}01037             T U = Cx * By -\/ Cy * Bx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01038}01038             T V = Ax * Cy -\/ Ay * Cx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01039}01039             T W = Bx * Ay -\/ By * Ax;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01040}01040 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01041}01041 \textcolor{preprocessor}{\#ifdef \_\_clang\_\_}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01042}01042 \textcolor{preprocessor}{\#pragma clang diagnostic push}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01043}01043 \textcolor{preprocessor}{\#pragma clang diagnostic ignored "{}-\/Wfloat-\/equal"{}}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01044}01044 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01045}01045 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01046}01046             \textcolor{comment}{// Fall back to test against edges using double precision.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01047}01047             \textcolor{keywordflow}{if} (U == \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0) || V == \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0) ||}
\DoxyCodeLine{\Hypertarget{a00227_source_l01048}01048                 W == \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0)) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01049}01049                 \textcolor{keywordtype}{double} CxBy = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(Cx) * \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(By);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01050}01050                 \textcolor{keywordtype}{double} CyBx = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(Cy) * \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(Bx);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01051}01051                 U = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(CxBy -\/ CyBx);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01052}01052 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01053}01053                 \textcolor{keywordtype}{double} AxCy = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(Ax) * \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(Cy);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01054}01054                 \textcolor{keywordtype}{double} AyCx = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(Ay) * \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(Cx);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01055}01055                 V = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(AxCy -\/ AyCx);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01056}01056 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01057}01057                 \textcolor{keywordtype}{double} BxAy = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(Bx) * \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(Ay);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01058}01058                 \textcolor{keywordtype}{double} ByAx = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(By) * \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(Ax);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01059}01059                 W = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(BxAy -\/ ByAx);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01060}01060             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01061}01061 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01062}01062             \textcolor{keywordflow}{if} (U < \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0) || V < static\_cast<T>(0.0) ||}
\DoxyCodeLine{\Hypertarget{a00227_source_l01063}01063                 W < static\_cast<T>(0.0)) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01064}01064                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01499_a6d0ea73ee3e801f2d4d14807f2d35008}{trace\_options\_}}.\mbox{\hyperlink{a01467_adb2d2c476511d304304c4e763a818fc2}{cull\_back\_face}} ||}
\DoxyCodeLine{\Hypertarget{a00227_source_l01065}01065                     (U > \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0) || V > \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0) ||}
\DoxyCodeLine{\Hypertarget{a00227_source_l01066}01066                         W > \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0))) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01067}01067                     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01068}01068                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01069}01069             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01070}01070 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01071}01071             T det = U + V + W;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01072}01072             \textcolor{keywordflow}{if} (det == \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0)) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01073}01073 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01074}01074 \textcolor{preprocessor}{\#ifdef \_\_clang\_\_}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01075}01075 \textcolor{preprocessor}{\#pragma clang diagnostic pop}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01076}01076 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01077}01077 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01078}01078             \textcolor{keyword}{const} T Az = \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_aec0f701c604c6521b99d57b5ff3b0c39}{Sz}} * A[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01079}01079             \textcolor{keyword}{const} T Bz = \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_aec0f701c604c6521b99d57b5ff3b0c39}{Sz}} * B[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01080}01080             \textcolor{keyword}{const} T Cz = \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_aec0f701c604c6521b99d57b5ff3b0c39}{Sz}} * C[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01081}01081             \textcolor{keyword}{const} T D = U * Az + V * Bz + W * Cz;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01082}01082 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01083}01083             \textcolor{keyword}{const} T rcpDet = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1.0) / det;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01084}01084             T tt = D * rcpDet;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01085}01085 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01086}01086             \textcolor{keywordflow}{if} (tt > (*t\_inout)) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01087}01087                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01088}01088             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01089}01089 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01090}01090             \textcolor{keywordflow}{if} (tt < \mbox{\hyperlink{a01499_adf2c8cac44aea278d3bb840b65cf72ad}{t\_min\_}}) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01091}01091                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01092}01092             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01093}01093 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01094}01094             (*t\_inout) = tt;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01095}01095             \textcolor{comment}{// Use Mller-\/Trumbore style barycentric coordinates}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01096}01096             \textcolor{comment}{// U + V + W = 1.0 and interp(p) = U * p0 + V * p1 + W * p2}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01097}01097             \textcolor{comment}{// We want interp(p) = (1 -\/ u -\/ v) * p0 + u * v1 + v * p2;}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01098}01098             \textcolor{comment}{// => u = V, v = W.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01099}01099             \mbox{\hyperlink{a01499_acad6ff219fd226b6fdf8735cfa35cbbb}{u\_}} = V * rcpDet;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01100}01100             \mbox{\hyperlink{a01499_a1330de9010bc5c0129fafe90d94375c4}{v\_}} = W * rcpDet;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01101}01101 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01102}01102             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01103}01103         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01104}01104 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01106}\mbox{\hyperlink{a01499_a5eda5bed00b03898ad719cde8653d3ea}{01106}}         T \mbox{\hyperlink{a01499_a5eda5bed00b03898ad719cde8653d3ea}{GetT}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01499_a50523ac73f73b22be639163ef9dacc80}{t\_}}; \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01107}01107 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01109}\mbox{\hyperlink{a01499_a6b108535e10b320d287c853eb2e3142e}{01109}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{a01499_a6b108535e10b320d287c853eb2e3142e}{Update}}(T t, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} prim\_idx)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01110}01110             \mbox{\hyperlink{a01499_a50523ac73f73b22be639163ef9dacc80}{t\_}} = t;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01111}01111             \mbox{\hyperlink{a01499_a382f51475802db6e426e7ca1dcd49f19}{prim\_id\_}} = prim\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01112}01112         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01113}01113 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01116}\mbox{\hyperlink{a01499_a10ab05ab1f92e4c1cda2da4f6de5fc59}{01116}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{a01499_a10ab05ab1f92e4c1cda2da4f6de5fc59}{PrepareTraversal}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01447}{Ray<T>}}\& ray,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01117}01117             \textcolor{keyword}{const} \mbox{\hyperlink{a01467}{BVHTraceOptions}}\& trace\_options)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01118}01118             \mbox{\hyperlink{a01499_acc4cab87b7ed0b510dc0ddccbf2ab949}{ray\_org\_}}[0] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01119}01119             \mbox{\hyperlink{a01499_acc4cab87b7ed0b510dc0ddccbf2ab949}{ray\_org\_}}[1] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01120}01120             \mbox{\hyperlink{a01499_acc4cab87b7ed0b510dc0ddccbf2ab949}{ray\_org\_}}[2] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01121}01121 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01122}01122             \textcolor{comment}{// Calculate dimension where the ray direction is maximal.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01123}01123             \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}} = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01124}01124             T absDir = std::fabs(ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[0]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01125}01125             \textcolor{keywordflow}{if} (absDir < std::fabs(ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[1])) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01126}01126                 \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}} = 1;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01127}01127                 absDir = std::fabs(ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[1]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01128}01128             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01129}01129             \textcolor{keywordflow}{if} (absDir < std::fabs(ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[2])) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01130}01130                 \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}} = 2;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01131}01131                 absDir = std::fabs(ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[2]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01132}01132             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01133}01133 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01134}01134             \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a9e85b4e367c2390c4654ec819a75741d}{kx}} = \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}} + 1;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01135}01135             \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a9e85b4e367c2390c4654ec819a75741d}{kx}} == 3) \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a9e85b4e367c2390c4654ec819a75741d}{kx}} = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01136}01136             \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_acecad1b0d9d78eb0c2e41813c5b1427c}{ky}} = \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a9e85b4e367c2390c4654ec819a75741d}{kx}} + 1;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01137}01137             \textcolor{keywordflow}{if} (\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_acecad1b0d9d78eb0c2e41813c5b1427c}{ky}} == 3) \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_acecad1b0d9d78eb0c2e41813c5b1427c}{ky}} = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01138}01138 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01139}01139             \textcolor{comment}{// Swap kx and ky dimension to preserve winding direction of triangles.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01140}01140             \textcolor{keywordflow}{if} (ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}}] < \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0))}
\DoxyCodeLine{\Hypertarget{a00227_source_l01141}01141                 std::swap(\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a9e85b4e367c2390c4654ec819a75741d}{kx}}, \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_acecad1b0d9d78eb0c2e41813c5b1427c}{ky}});}
\DoxyCodeLine{\Hypertarget{a00227_source_l01142}01142 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01143}01143             \textcolor{comment}{// Calculate shear constants.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01144}01144             \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a2cac34b6bd01583a2ff88af0eb6f1c86}{Sx}} = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a9e85b4e367c2390c4654ec819a75741d}{kx}}] / ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01145}01145             \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_aa79bacc86198f6bca3cd7aafbee465d5}{Sy}} = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_acecad1b0d9d78eb0c2e41813c5b1427c}{ky}}] / ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01146}01146             \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_aec0f701c604c6521b99d57b5ff3b0c39}{Sz}} = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1.0) / ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}}.\mbox{\hyperlink{a01499_a7b93948ffe60a4f465b487b8e505707e}{kz}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01147}01147 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01148}01148             \mbox{\hyperlink{a01499_a6d0ea73ee3e801f2d4d14807f2d35008}{trace\_options\_}} = trace\_options;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01149}01149 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01150}01150             \mbox{\hyperlink{a01499_adf2c8cac44aea278d3bb840b65cf72ad}{t\_min\_}} = ray.\mbox{\hyperlink{a01447_a0e35bd37e6eb93f8233d903725d75de4}{min\_t}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01151}01151 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01152}01152             \mbox{\hyperlink{a01499_acad6ff219fd226b6fdf8735cfa35cbbb}{u\_}} = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01153}01153             \mbox{\hyperlink{a01499_a1330de9010bc5c0129fafe90d94375c4}{v\_}} = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01154}01154         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01155}01155 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01158}\mbox{\hyperlink{a01499_a543bcb67cbb100f2cb49a0b224d75dfe}{01158}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{a01499_a543bcb67cbb100f2cb49a0b224d75dfe}{PostTraversal}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01447}{Ray<T>}}\& ray, \textcolor{keywordtype}{bool} hit, H* isect)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01159}01159             \textcolor{keywordflow}{if} (hit \&\& isect) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01160}01160                 (*isect).t = \mbox{\hyperlink{a01499_a50523ac73f73b22be639163ef9dacc80}{t\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01161}01161                 (*isect).u = \mbox{\hyperlink{a01499_acad6ff219fd226b6fdf8735cfa35cbbb}{u\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01162}01162                 (*isect).v = \mbox{\hyperlink{a01499_a1330de9010bc5c0129fafe90d94375c4}{v\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01163}01163                 (*isect).prim\_id = \mbox{\hyperlink{a01499_a382f51475802db6e426e7ca1dcd49f19}{prim\_id\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01164}01164             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01165}01165             (void)ray;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01166}01166         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01167}01167 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01168}01168     \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{a00227_source_l01169}\mbox{\hyperlink{a01499_a2cb6f374b8f26629e3c01bc1d5b49281}{01169}}         \textcolor{keyword}{const} T* \mbox{\hyperlink{a01499_a2cb6f374b8f26629e3c01bc1d5b49281}{vertices\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01170}\mbox{\hyperlink{a01499_af15783141ac090475a0ab5511f7e37ea}{01170}}         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* \mbox{\hyperlink{a01499_af15783141ac090475a0ab5511f7e37ea}{faces\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01171}\mbox{\hyperlink{a01499_a1782017f63d67ebf1e63bc56b7f4d13b}{01171}}         \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{a01499_a1782017f63d67ebf1e63bc56b7f4d13b}{vertex\_stride\_bytes\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01172}01172 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01173}\mbox{\hyperlink{a01499_acc4cab87b7ed0b510dc0ddccbf2ab949}{01173}}         \textcolor{keyword}{mutable} \mbox{\hyperlink{a01443}{real3<T>}} \mbox{\hyperlink{a01499_acc4cab87b7ed0b510dc0ddccbf2ab949}{ray\_org\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01174}\mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{01174}}         \textcolor{keyword}{mutable} \mbox{\hyperlink{a01499_a01503}{RayCoeff}} \mbox{\hyperlink{a01499_ae57ba6626c926b2a9479dd3d013425b7}{ray\_coeff\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01175}\mbox{\hyperlink{a01499_a6d0ea73ee3e801f2d4d14807f2d35008}{01175}}         \textcolor{keyword}{mutable} \mbox{\hyperlink{a01467}{BVHTraceOptions}} \mbox{\hyperlink{a01499_a6d0ea73ee3e801f2d4d14807f2d35008}{trace\_options\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01176}\mbox{\hyperlink{a01499_adf2c8cac44aea278d3bb840b65cf72ad}{01176}}         \textcolor{keyword}{mutable} T \mbox{\hyperlink{a01499_adf2c8cac44aea278d3bb840b65cf72ad}{t\_min\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01177}01177 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01178}\mbox{\hyperlink{a01499_a50523ac73f73b22be639163ef9dacc80}{01178}}         \textcolor{keyword}{mutable} T \mbox{\hyperlink{a01499_a50523ac73f73b22be639163ef9dacc80}{t\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01179}\mbox{\hyperlink{a01499_acad6ff219fd226b6fdf8735cfa35cbbb}{01179}}         \textcolor{keyword}{mutable} T \mbox{\hyperlink{a01499_acad6ff219fd226b6fdf8735cfa35cbbb}{u\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01180}\mbox{\hyperlink{a01499_a1330de9010bc5c0129fafe90d94375c4}{01180}}         \textcolor{keyword}{mutable} T \mbox{\hyperlink{a01499_a1330de9010bc5c0129fafe90d94375c4}{v\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01181}\mbox{\hyperlink{a01499_a382f51475802db6e426e7ca1dcd49f19}{01181}}         \textcolor{keyword}{mutable} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01499_a382f51475802db6e426e7ca1dcd49f19}{prim\_id\_}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01182}01182     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01183}01183 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01184}01184     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01185}01185     \textcolor{comment}{// Robust BVH Ray Traversal : http://jcgt.org/published/0002/02/02/paper.pdf}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01186}01186     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01187}01187 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01188}01188     \textcolor{comment}{// NaN-\/safe min and max function.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01189}01189     \textcolor{keyword}{template} <\textcolor{keyword}{class} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01190}\mbox{\hyperlink{a00474_a319aa74b4c12ff9ad2a2ea634d0d4397}{01190}}     \textcolor{keyword}{const} T\& \mbox{\hyperlink{a00474_a319aa74b4c12ff9ad2a2ea634d0d4397}{safemin}}(\textcolor{keyword}{const} T\& a, \textcolor{keyword}{const} T\& b) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01191}01191         \textcolor{keywordflow}{return} (a < b) ? a : b;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01192}01192     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01193}01193     \textcolor{keyword}{template} <\textcolor{keyword}{class} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01194}\mbox{\hyperlink{a00474_a3253537ad2f0cdbca3f1b418007a1736}{01194}}     \textcolor{keyword}{const} T\& \mbox{\hyperlink{a00474_a3253537ad2f0cdbca3f1b418007a1736}{safemax}}(\textcolor{keyword}{const} T\& a, \textcolor{keyword}{const} T\& b) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01195}01195         \textcolor{keywordflow}{return} (a > b) ? a : b;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01196}01196     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01197}01197 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01198}01198     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01199}01199     \textcolor{comment}{// SAH functions}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01200}01200     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01201}\mbox{\hyperlink{a01507}{01201}}     \textcolor{keyword}{struct }\mbox{\hyperlink{a01507}{BinBuffer}} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01202}\mbox{\hyperlink{a01507_a7228554208709315e90ffe6c0f602570}{01202}}         \textcolor{keyword}{explicit} \mbox{\hyperlink{a01507_a7228554208709315e90ffe6c0f602570}{BinBuffer}}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} size) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01203}01203             \mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{bin\_size}} = size;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01204}01204             \mbox{\hyperlink{a01507_a89f49eeb82a62af3efe76b2a9f7676bf}{bin}}.resize(2 * 3 * size);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01205}01205             \mbox{\hyperlink{a01507_a96069e46f2edbefc54ef89e5f1fc4996}{clear}}();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01206}01206         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01207}01207 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01208}\mbox{\hyperlink{a01507_a96069e46f2edbefc54ef89e5f1fc4996}{01208}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{a01507_a96069e46f2edbefc54ef89e5f1fc4996}{clear}}() \{ memset(\&\mbox{\hyperlink{a01507_a89f49eeb82a62af3efe76b2a9f7676bf}{bin}}[0], 0, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}) * 2 * 3 * \mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{bin\_size}}); \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01209}01209 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01210}\mbox{\hyperlink{a01507_a89f49eeb82a62af3efe76b2a9f7676bf}{01210}}         std::vector<size\_t> \mbox{\hyperlink{a01507_a89f49eeb82a62af3efe76b2a9f7676bf}{bin}};  \textcolor{comment}{// (min, max) * xyz * binsize}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01211}\mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{01211}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{bin\_size}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01212}\mbox{\hyperlink{a01507_a88b63cb2d5eb0ad5aaaea638f5e784ed}{01212}}         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01507_a88b63cb2d5eb0ad5aaaea638f5e784ed}{pad0}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01213}01213     \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01214}01214 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01215}01215     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01216}\mbox{\hyperlink{a00474_a1f672faac125854c89c907614545fe60}{01216}}     \textcolor{keyword}{inline} T \mbox{\hyperlink{a00474_a1f672faac125854c89c907614545fe60}{CalculateSurfaceArea}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}}\& min, \textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}}\& max) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01217}01217         \mbox{\hyperlink{a01443}{real3<T>}} box = max -\/ min;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01218}01218         \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(2.0) *}
\DoxyCodeLine{\Hypertarget{a00227_source_l01219}01219             (box[0] * box[1] + box[1] * box[2] + box[2] * box[0]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01220}01220     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01221}01221 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01222}01222     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01223}\mbox{\hyperlink{a00474_a464fa0f048bdb306e2a84523579ab34b}{01223}}     \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{a00474_a464fa0f048bdb306e2a84523579ab34b}{GetBoundingBoxOfTriangle}}(\mbox{\hyperlink{a01443}{real3<T>}}* bmin, \mbox{\hyperlink{a01443}{real3<T>}}* bmax,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01224}01224         \textcolor{keyword}{const} T* vertices,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01225}01225         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* faces,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01226}01226         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} index) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01227}01227         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} f0 = faces[3 * index + 0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01228}01228         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} f1 = faces[3 * index + 1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01229}01229         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} f2 = faces[3 * index + 2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01230}01230 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01231}01231         \mbox{\hyperlink{a01443}{real3<T>}} p[3];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01232}01232 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01233}01233         p[0] = \mbox{\hyperlink{a01443}{real3<T>}}(\&vertices[3 * f0]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01234}01234         p[1] = \mbox{\hyperlink{a01443}{real3<T>}}(\&vertices[3 * f1]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01235}01235         p[2] = \mbox{\hyperlink{a01443}{real3<T>}}(\&vertices[3 * f2]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01236}01236 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01237}01237         (*bmin) = p[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01238}01238         (*bmax) = p[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01239}01239 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01240}01240         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i < 3; i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01241}01241             (*bmin)[0] = std::min((*bmin)[0], p[i][0]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01242}01242             (*bmin)[1] = std::min((*bmin)[1], p[i][1]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01243}01243             (*bmin)[2] = std::min((*bmin)[2], p[i][2]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01244}01244 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01245}01245             (*bmax)[0] = std::max((*bmax)[0], p[i][0]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01246}01246             (*bmax)[1] = std::max((*bmax)[1], p[i][1]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01247}01247             (*bmax)[2] = std::max((*bmax)[2], p[i][2]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01248}01248         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01249}01249     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01250}01250 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01251}01251     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T, \textcolor{keyword}{class} P>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01252}\mbox{\hyperlink{a00474_a67ae269fe2215d261b995f1da13320f7}{01252}}     \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{a00474_a67ae269fe2215d261b995f1da13320f7}{ContributeBinBuffer}}(\mbox{\hyperlink{a01507}{BinBuffer}}* bins,  \textcolor{comment}{// [out]}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01253}01253         \textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}}\& scene\_min,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01254}01254         \textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}}\& scene\_max,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01255}01255         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* indices, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} left\_idx,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01256}01256         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} right\_idx, \textcolor{keyword}{const} P\& p) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01257}01257         T bin\_size = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(bins-\/>\mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{bin\_size}});}
\DoxyCodeLine{\Hypertarget{a00227_source_l01258}01258 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01259}01259         \textcolor{comment}{// Calculate extent}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01260}01260         \mbox{\hyperlink{a01443}{real3<T>}} scene\_size, scene\_inv\_size;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01261}01261         scene\_size = scene\_max -\/ scene\_min;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01262}01262 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01263}01263         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 3; ++i) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01264}01264             assert(scene\_size[i] >= \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0));}
\DoxyCodeLine{\Hypertarget{a00227_source_l01265}01265 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01266}01266             \textcolor{keywordflow}{if} (scene\_size[i] > \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0)) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01267}01267                 scene\_inv\_size[i] = bin\_size / scene\_size[i];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01268}01268             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01269}01269             \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01270}01270                 scene\_inv\_size[i] = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01271}01271             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01272}01272         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01273}01273 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01274}01274         \textcolor{comment}{// Clear bin data}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01275}01275         std::fill(bins-\/>\mbox{\hyperlink{a01507_a89f49eeb82a62af3efe76b2a9f7676bf}{bin}}.begin(), bins-\/>\mbox{\hyperlink{a01507_a89f49eeb82a62af3efe76b2a9f7676bf}{bin}}.end(), 0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01276}01276         \textcolor{comment}{// memset(\&bins-\/>bin[0], 0, sizeof(2 * 3 * bins-\/>bin\_size));}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01277}01277 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01278}01278         \textcolor{keywordtype}{size\_t} idx\_bmin[3];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01279}01279         \textcolor{keywordtype}{size\_t} idx\_bmax[3];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01280}01280 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01281}01281         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = left\_idx; i < right\_idx; i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01282}01282             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01283}01283             \textcolor{comment}{// Quantize the position into [0, BIN\_SIZE)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01284}01284             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01285}01285             \textcolor{comment}{// q[i] = (int)(p[i] -\/ scene\_bmin) / scene\_size}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01286}01286             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01287}01287             \mbox{\hyperlink{a01443}{real3<T>}} bmin;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01288}01288             \mbox{\hyperlink{a01443}{real3<T>}} bmax;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01289}01289 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01290}01290             p.BoundingBox(\&bmin, \&bmax, indices[i]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01291}01291             \textcolor{comment}{// GetBoundingBoxOfTriangle(\&bmin, \&bmax, vertices, faces, indices[i]);}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01292}01292 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01293}01293             \mbox{\hyperlink{a01443}{real3<T>}} quantized\_bmin = (bmin -\/ scene\_min) * scene\_inv\_size;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01294}01294             \mbox{\hyperlink{a01443}{real3<T>}} quantized\_bmax = (bmax -\/ scene\_min) * scene\_inv\_size;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01295}01295 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01296}01296             \textcolor{comment}{// idx is now in [0, BIN\_SIZE)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01297}01297             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01298}01298                 \textcolor{keywordtype}{int} q0 = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(quantized\_bmin[j]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01299}01299                 \textcolor{keywordflow}{if} (q0 < 0) q0 = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01300}01300                 \textcolor{keywordtype}{int} q1 = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(quantized\_bmax[j]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01301}01301                 \textcolor{keywordflow}{if} (q1 < 0) q1 = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01302}01302 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01303}01303                 idx\_bmin[j] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(q0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01304}01304                 idx\_bmax[j] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(q1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01305}01305 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01306}01306                 \textcolor{keywordflow}{if} (idx\_bmin[j] >= bin\_size)}
\DoxyCodeLine{\Hypertarget{a00227_source_l01307}01307                     idx\_bmin[j] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(bin\_size) -\/ 1;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01308}01308 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01309}01309                 \textcolor{keywordflow}{if} (idx\_bmax[j] >= bin\_size)}
\DoxyCodeLine{\Hypertarget{a00227_source_l01310}01310                     idx\_bmax[j] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(bin\_size) -\/ 1;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01311}01311 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01312}01312                 \textcolor{comment}{// Increment bin counter}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01313}01313                 bins-\/>\mbox{\hyperlink{a01507_a89f49eeb82a62af3efe76b2a9f7676bf}{bin}}[0 * (bins-\/>\mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{bin\_size}} * 3) +}
\DoxyCodeLine{\Hypertarget{a00227_source_l01314}01314                     \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(j) * bins-\/>\mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{bin\_size}} + idx\_bmin[j]] += 1;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01315}01315                 bins-\/>\mbox{\hyperlink{a01507_a89f49eeb82a62af3efe76b2a9f7676bf}{bin}}[1 * (bins-\/>\mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{bin\_size}} * 3) +}
\DoxyCodeLine{\Hypertarget{a00227_source_l01316}01316                     \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(j) * bins-\/>\mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{bin\_size}} + idx\_bmax[j]] += 1;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01317}01317             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01318}01318         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01319}01319     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01320}01320 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01321}01321     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01322}\mbox{\hyperlink{a00474_a2224f7a101ce863a9332f059dfef9dd1}{01322}}     \textcolor{keyword}{inline} T \mbox{\hyperlink{a00474_a2224f7a101ce863a9332f059dfef9dd1}{SAH}}(\textcolor{keywordtype}{size\_t} ns1, T leftArea, \textcolor{keywordtype}{size\_t} ns2, T rightArea, T invS, T Taabb,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01323}01323         T Ttri) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01324}01324         T sah;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01325}01325 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01326}01326         sah = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(2.0) * Taabb +}
\DoxyCodeLine{\Hypertarget{a00227_source_l01327}01327             (leftArea * invS) * \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(ns1) * Ttri +}
\DoxyCodeLine{\Hypertarget{a00227_source_l01328}01328             (rightArea * invS) * \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(ns2) * Ttri;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01329}01329 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01330}01330         \textcolor{keywordflow}{return} sah;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01331}01331     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01332}01332 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01333}01333     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01334}\mbox{\hyperlink{a00474_ac281b6ed7e50b406666a6e67e9547b7e}{01334}}     \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a00474_ac281b6ed7e50b406666a6e67e9547b7e}{FindCutFromBinBuffer}}(T* cut\_pos,        \textcolor{comment}{// [out] xyz}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01335}01335         \textcolor{keywordtype}{int}* minCostAxis,  \textcolor{comment}{// [out]}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01336}01336         \textcolor{keyword}{const} \mbox{\hyperlink{a01507}{BinBuffer}}* bins, \textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}}\& bmin,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01337}01337         \textcolor{keyword}{const} \mbox{\hyperlink{a01443}{real3<T>}}\& bmax, \textcolor{keywordtype}{size\_t} num\_primitives,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01338}01338         T costTaabb) \{      \textcolor{comment}{// should be in [0.0, 1.0]}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01339}01339         \textcolor{keyword}{const} T kEPS = std::numeric\_limits<T>::epsilon();  \textcolor{comment}{// * epsScale;}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01340}01340 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01341}01341         \textcolor{keywordtype}{size\_t} left, right;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01342}01342         \mbox{\hyperlink{a01443}{real3<T>}} bsize, bstep;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01343}01343         \mbox{\hyperlink{a01443}{real3<T>}} bminLeft, bmaxLeft;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01344}01344         \mbox{\hyperlink{a01443}{real3<T>}} bminRight, bmaxRight;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01345}01345         T saLeft, saRight, saTotal;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01346}01346         T pos;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01347}01347         T minCost[3];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01348}01348 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01349}01349         T costTtri = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1.0) -\/ costTaabb;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01350}01350 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01351}01351         (*minCostAxis) = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01352}01352 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01353}01353         bsize = bmax -\/ bmin;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01354}01354         bstep = bsize * (\textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1.0) / bins-\/>\mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{bin\_size}});}
\DoxyCodeLine{\Hypertarget{a00227_source_l01355}01355         saTotal = \mbox{\hyperlink{a00474_a1f672faac125854c89c907614545fe60}{CalculateSurfaceArea}}(bmin, bmax);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01356}01356 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01357}01357         T invSaTotal = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01358}01358         \textcolor{keywordflow}{if} (saTotal > kEPS) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01359}01359             invSaTotal = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1.0) / saTotal;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01360}01360         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01361}01361 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01362}01362         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01363}01363             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01364}01364             \textcolor{comment}{// Compute SAH cost for the right side of each cell of the bbox.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01365}01365             \textcolor{comment}{// Exclude both extreme sides of the bbox.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01366}01366             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01367}01367             \textcolor{comment}{//  i:      0    1    2    3}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01368}01368             \textcolor{comment}{//     +-\/-\/-\/-\/+-\/-\/-\/-\/+-\/-\/-\/-\/+-\/-\/-\/-\/+-\/-\/-\/-\/+}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01369}01369             \textcolor{comment}{//     |    |    |    |    |    |}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01370}01370             \textcolor{comment}{//     +-\/-\/-\/-\/+-\/-\/-\/-\/+-\/-\/-\/-\/+-\/-\/-\/-\/+-\/-\/-\/-\/+}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01371}01371             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01372}01372 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01373}01373             T minCostPos = bmin[j] + \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1.0) * bstep[j];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01374}01374             minCost[j] = std::numeric\_limits<T>::max();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01375}01375 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01376}01376             left = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01377}01377             right = num\_primitives;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01378}01378             bminLeft = bminRight = bmin;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01379}01379             bmaxLeft = bmaxRight = bmax;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01380}01380 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01381}01381             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < static\_cast<int>(bins-\/>\mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{bin\_size}}) -\/ 1; ++i) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01382}01382                 left += bins-\/>\mbox{\hyperlink{a01507_a89f49eeb82a62af3efe76b2a9f7676bf}{bin}}[0 * (3 * bins-\/>\mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{bin\_size}}) +}
\DoxyCodeLine{\Hypertarget{a00227_source_l01383}01383                     \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(j) * bins-\/>\mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{bin\_size}} +}
\DoxyCodeLine{\Hypertarget{a00227_source_l01384}01384                     \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(i)];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01385}01385                 right -\/= bins-\/>\mbox{\hyperlink{a01507_a89f49eeb82a62af3efe76b2a9f7676bf}{bin}}[1 * (3 * bins-\/>\mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{bin\_size}}) +}
\DoxyCodeLine{\Hypertarget{a00227_source_l01386}01386                     \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(j) * bins-\/>\mbox{\hyperlink{a01507_a1066a0cd59a96b00ba19d4d17ce1757c}{bin\_size}} +}
\DoxyCodeLine{\Hypertarget{a00227_source_l01387}01387                     \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(i)];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01388}01388 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01389}01389                 assert(left <= num\_primitives);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01390}01390                 assert(right <= num\_primitives);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01391}01391 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01392}01392                 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01393}01393                 \textcolor{comment}{// Split pos bmin + (i + 1) * (bsize / BIN\_SIZE)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01394}01394                 \textcolor{comment}{// +1 for i since we want a position on right side of the cell.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01395}01395                 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01396}01396 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01397}01397                 pos = bmin[j] + (i + \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1.0)) * bstep[j];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01398}01398                 bmaxLeft[j] = pos;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01399}01399                 bminRight[j] = pos;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01400}01400 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01401}01401                 saLeft = \mbox{\hyperlink{a00474_a1f672faac125854c89c907614545fe60}{CalculateSurfaceArea}}(bminLeft, bmaxLeft);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01402}01402                 saRight = \mbox{\hyperlink{a00474_a1f672faac125854c89c907614545fe60}{CalculateSurfaceArea}}(bminRight, bmaxRight);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01403}01403 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01404}01404                 T cost =}
\DoxyCodeLine{\Hypertarget{a00227_source_l01405}01405                     \mbox{\hyperlink{a00474_a2224f7a101ce863a9332f059dfef9dd1}{SAH}}(left, saLeft, right, saRight, invSaTotal, costTaabb, costTtri);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01406}01406 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01407}01407                 \textcolor{keywordflow}{if} (cost < minCost[j]) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01408}01408                     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01409}01409                     \textcolor{comment}{// Update the min cost}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01410}01410                     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01411}01411                     minCost[j] = cost;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01412}01412                     minCostPos = pos;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01413}01413                     \textcolor{comment}{// minCostAxis = j;}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01414}01414                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01415}01415             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01416}01416 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01417}01417             cut\_pos[j] = minCostPos;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01418}01418         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01419}01419 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01420}01420         \textcolor{comment}{// cut\_axis = minCostAxis;}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01421}01421         \textcolor{comment}{// cut\_pos = minCostPos;}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01422}01422 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01423}01423         \textcolor{comment}{// Find min cost axis}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01424}01424         T cost = minCost[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01425}01425         (*minCostAxis) = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01426}01426 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01427}01427         \textcolor{keywordflow}{if} (cost > minCost[1]) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01428}01428             (*minCostAxis) = 1;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01429}01429             cost = minCost[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01430}01430         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01431}01431         \textcolor{keywordflow}{if} (cost > minCost[2]) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01432}01432             (*minCostAxis) = 2;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01433}01433             cost = minCost[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01434}01434         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01435}01435 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01436}01436         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01437}01437     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01438}01438 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01439}01439 \textcolor{preprocessor}{\#ifdef \_OPENMP}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01440}01440     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T, \textcolor{keyword}{class} P>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01441}01441     \textcolor{keywordtype}{void} ComputeBoundingBoxOMP(real3<T>* bmin, real3<T>* bmax,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01442}01442         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* indices, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} left\_index,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01443}01443         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} right\_index, \textcolor{keyword}{const} P\& p) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01444}01444             \{ p.BoundingBox(bmin, bmax, indices[left\_index]); \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01445}01445 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01446}01446             T local\_bmin[3] = \{ (*bmin)[0], (*bmin)[1], (*bmin)[2] \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01447}01447             T local\_bmax[3] = \{ (*bmax)[0], (*bmax)[1], (*bmax)[2] \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01448}01448 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01449}01449             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} n = right\_index -\/ left\_index;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01450}01450 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01451}01451 \textcolor{preprocessor}{\#pragma omp parallel firstprivate(local\_bmin, local\_bmax) if (n > (1024 * 128))}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01452}01452             \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01453}01453 \textcolor{preprocessor}{\#pragma omp parallel for}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01454}01454                 \textcolor{comment}{// for each face}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01455}01455                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = \textcolor{keywordtype}{int}(left\_index); i < int(right\_index); i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01456}01456                     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} idx = indices[i];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01457}01457 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01458}01458                     real3<T> bbox\_min, bbox\_max;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01459}01459 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01460}01460                     p.BoundingBox(\&bbox\_min, \&bbox\_max, idx);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01461}01461 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01462}01462                     \textcolor{comment}{// xyz}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01463}01463                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 3; k++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01464}01464                         (*bmin)[k] = std::min((*bmin)[k], bbox\_min[k]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01465}01465                         (*bmax)[k] = std::max((*bmax)[k], bbox\_max[k]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01466}01466                     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01467}01467                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01468}01468 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01469}01469 \textcolor{preprocessor}{\#pragma omp critical}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01470}01470                 \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01471}01471                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 3; k++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01472}01472                         (*bmin)[k] = std::min((*bmin)[k], local\_bmin[k]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01473}01473                         (*bmax)[k] = std::max((*bmax)[k], local\_bmax[k]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01474}01474                     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01475}01475                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01476}01476             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01477}01477     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01478}01478 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01479}01479 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01480}01480 \textcolor{preprocessor}{\#ifdef NANORT\_USE\_CPP11\_FEATURE}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01481}01481     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T, \textcolor{keyword}{class} P>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01482}01482     \textcolor{keyword}{inline} \textcolor{keywordtype}{void} ComputeBoundingBoxThreaded(real3<T>* bmin, real3<T>* bmax,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01483}01483         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* indices,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01484}01484         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} left\_index,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01485}01485         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} right\_index, \textcolor{keyword}{const} P\& p) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01486}01486         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} n = right\_index -\/ left\_index;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01487}01487 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01488}01488         \textcolor{keywordtype}{size\_t} num\_threads = std::min(}
\DoxyCodeLine{\Hypertarget{a00227_source_l01489}01489             \textcolor{keywordtype}{size\_t}(kNANORT\_MAX\_THREADS),}
\DoxyCodeLine{\Hypertarget{a00227_source_l01490}01490             std::max(\textcolor{keywordtype}{size\_t}(1), \textcolor{keywordtype}{size\_t}(std::thread::hardware\_concurrency())));}
\DoxyCodeLine{\Hypertarget{a00227_source_l01491}01491 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01492}01492         \textcolor{keywordflow}{if} (n < num\_threads) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01493}01493             num\_threads = n;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01494}01494         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01495}01495 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01496}01496         std::vector<std::thread> workers;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01497}01497 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01498}01498         \textcolor{keywordtype}{size\_t} ndiv = n / num\_threads;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01499}01499 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01500}01500         std::vector<T> local\_bmins(3 * num\_threads);  \textcolor{comment}{// 3 = xyz}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01501}01501         std::vector<T> local\_bmaxs(3 * num\_threads);  \textcolor{comment}{// 3 = xyz}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01502}01502 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01503}01503         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} t = 0; t < num\_threads; t++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01504}01504             workers.emplace\_back(std::thread([\&, t]() \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01505}01505                 \textcolor{keywordtype}{size\_t} si = left\_index + t * ndiv;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01506}01506                 \textcolor{keywordtype}{size\_t} ei = (t == (num\_threads -\/ 1)) ? size\_t(right\_index) : \mbox{\hyperlink{a00461}{std}}::min(left\_index + (t + 1) * ndiv, size\_t(right\_index));}
\DoxyCodeLine{\Hypertarget{a00227_source_l01507}01507 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01508}01508                 local\_bmins[3 * t + 0] = std::numeric\_limits<T>::infinity();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01509}01509                 local\_bmins[3 * t + 1] = std::numeric\_limits<T>::infinity();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01510}01510                 local\_bmins[3 * t + 2] = std::numeric\_limits<T>::infinity();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01511}01511                 local\_bmaxs[3 * t + 0] = -\/std::numeric\_limits<T>::infinity();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01512}01512                 local\_bmaxs[3 * t + 1] = -\/std::numeric\_limits<T>::infinity();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01513}01513                 local\_bmaxs[3 * t + 2] = -\/std::numeric\_limits<T>::infinity();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01514}01514 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01515}01515                 \textcolor{comment}{// for each face}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01516}01516                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = si; i < ei; i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01517}01517                     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} idx = indices[i];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01518}01518 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01519}01519                     real3<T> bbox\_min, bbox\_max;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01520}01520                     p.BoundingBox(\&bbox\_min, \&bbox\_max, idx);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01521}01521 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01522}01522                     \textcolor{comment}{// xyz}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01523}01523                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} k = 0; k < 3; k++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01524}01524                         local\_bmins[3 * t + k] =}
\DoxyCodeLine{\Hypertarget{a00227_source_l01525}01525                             std::min(local\_bmins[3 * t + k], bbox\_min[\textcolor{keywordtype}{int}(k)]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01526}01526                         local\_bmaxs[3 * t + k] =}
\DoxyCodeLine{\Hypertarget{a00227_source_l01527}01527                             std::max(local\_bmaxs[3 * t + k], bbox\_max[\textcolor{keywordtype}{int}(k)]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01528}01528                     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01529}01529                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01530}01530                 \}));}
\DoxyCodeLine{\Hypertarget{a00227_source_l01531}01531         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01532}01532 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01533}01533         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& t : workers) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01534}01534             t.join();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01535}01535         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01536}01536 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01537}01537         \textcolor{comment}{// merge bbox}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01538}01538         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} k = 0; k < 3; k++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01539}01539             (*bmin)[int(k)] = local\_bmins[k];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01540}01540             (*bmax)[int(k)] = local\_bmaxs[k];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01541}01541         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01542}01542 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01543}01543         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} t = 1; t < num\_threads; t++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01544}01544             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} k = 0; k < 3; k++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01545}01545                 (*bmin)[int(k)] = std::min((*bmin)[\textcolor{keywordtype}{int}(k)], local\_bmins[3 * t + k]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01546}01546                 (*bmax)[int(k)] = std::max((*bmax)[\textcolor{keywordtype}{int}(k)], local\_bmaxs[3 * t + k]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01547}01547             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01548}01548         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01549}01549     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01550}01550 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01551}01551 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01552}01552     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T, \textcolor{keyword}{class} P>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01553}\mbox{\hyperlink{a00474_a06549eb8469b9a2004cc5332ca0d011e}{01553}}     \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{a00474_a06549eb8469b9a2004cc5332ca0d011e}{ComputeBoundingBox}}(\mbox{\hyperlink{a01443}{real3<T>}}* bmin, \mbox{\hyperlink{a01443}{real3<T>}}* bmax,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01554}01554         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* indices,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01555}01555         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} left\_index,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01556}01556         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} right\_index, \textcolor{keyword}{const} P\& p) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01557}01557         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} idx = indices[left\_index];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01558}01558         p.BoundingBox(bmin, bmax, idx);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01559}01559 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01560}01560         \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01561}01561             \textcolor{comment}{// for each primitive}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01562}01562             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = left\_index + 1; i < right\_index; i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01563}01563                 idx = indices[i];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01564}01564                 \mbox{\hyperlink{a01443}{real3<T>}} bbox\_min, bbox\_max;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01565}01565                 p.BoundingBox(\&bbox\_min, \&bbox\_max, idx);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01566}01566 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01567}01567                 \textcolor{comment}{// xyz}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01568}01568                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 3; k++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01569}01569                     (*bmin)[k] = std::min((*bmin)[k], bbox\_min[k]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01570}01570                     (*bmax)[k] = std::max((*bmax)[k], bbox\_max[k]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01571}01571                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01572}01572             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01573}01573         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01574}01574     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01575}01575 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01576}01576     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01577}\mbox{\hyperlink{a00474_a60ac3f02ccb852decfdc6f7f02d7184f}{01577}}     \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{a00474_a60ac3f02ccb852decfdc6f7f02d7184f}{GetBoundingBox}}(\mbox{\hyperlink{a01443}{real3<T>}}* bmin, \mbox{\hyperlink{a01443}{real3<T>}}* bmax,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01578}01578         \textcolor{keyword}{const} std::vector<\mbox{\hyperlink{a01471}{BBox<T>}} >\& bboxes,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01579}01579         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* indices, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} left\_index,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01580}01580         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} right\_index) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01581}01581         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = left\_index;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01582}01582         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} idx = indices[i];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01583}01583 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01584}01584         (*bmin)[0] = bboxes[idx].bmin[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01585}01585         (*bmin)[1] = bboxes[idx].bmin[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01586}01586         (*bmin)[2] = bboxes[idx].bmin[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01587}01587         (*bmax)[0] = bboxes[idx].bmax[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01588}01588         (*bmax)[1] = bboxes[idx].bmax[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01589}01589         (*bmax)[2] = bboxes[idx].bmax[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01590}01590 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01591}01591         \textcolor{comment}{// for each face}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01592}01592         \textcolor{keywordflow}{for} (i = left\_index + 1; i < right\_index; i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01593}01593             idx = indices[i];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01594}01594 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01595}01595             \textcolor{comment}{// xyz}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01596}01596             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 3; k++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01597}01597                 (*bmin)[k] = std::min((*bmin)[k], bboxes[idx].bmin[k]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01598}01598                 (*bmax)[k] = std::max((*bmax)[k], bboxes[idx].bmax[k]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01599}01599             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01600}01600         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01601}01601     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01602}01602 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01603}01603     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01604}01604     \textcolor{comment}{// -\/-\/}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01605}01605     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01606}01606 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01607}01607 \textcolor{preprocessor}{\#if defined(NANORT\_ENABLE\_PARALLEL\_BUILD)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01608}01608     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01609}01609     \textcolor{keyword}{template} <\textcolor{keyword}{class} P, \textcolor{keyword}{class} Pred>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01610}01610     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} BVHAccel<T>::BuildShallowTree(std::vector<BVHNode<T> >* out\_nodes,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01611}01611         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} left\_idx,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01612}01612         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} right\_idx,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01613}01613         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} depth,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01614}01614         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} max\_shallow\_depth,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01615}01615         \textcolor{keyword}{const} P\& p, \textcolor{keyword}{const} Pred\& pred) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01616}01616         assert(left\_idx <= right\_idx);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01617}01617 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01618}01618         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} offset = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(out\_nodes-\/>size());}
\DoxyCodeLine{\Hypertarget{a00227_source_l01619}01619 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01620}01620         \textcolor{keywordflow}{if} (stats\_.max\_tree\_depth < depth) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01621}01621             stats\_.max\_tree\_depth = depth;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01622}01622         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01623}01623 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01624}01624         real3<T> bmin, bmax;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01625}01625 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01626}01626 \textcolor{preprocessor}{\#if defined(NANORT\_USE\_CPP11\_FEATURE) \&\& defined(NANORT\_ENABLE\_PARALLEL\_BUILD)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01627}01627         ComputeBoundingBoxThreaded(\&bmin, \&bmax, \&indices\_.at(0), left\_idx, right\_idx,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01628}01628             p);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01629}01629 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01630}01630         \mbox{\hyperlink{a00474_a06549eb8469b9a2004cc5332ca0d011e}{ComputeBoundingBox}}(\&bmin, \&bmax, \&indices\_.at(0), left\_idx, right\_idx, p);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01631}01631 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01632}01632 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01633}01633         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} n = right\_idx -\/ left\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01634}01634         \textcolor{keywordflow}{if} ((n <= options\_.min\_leaf\_primitives) ||}
\DoxyCodeLine{\Hypertarget{a00227_source_l01635}01635             (depth >= options\_.max\_tree\_depth)) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01636}01636             \textcolor{comment}{// Create leaf node.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01637}01637             BVHNode<T> leaf;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01638}01638 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01639}01639             leaf.bmin[0] = bmin[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01640}01640             leaf.bmin[1] = bmin[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01641}01641             leaf.bmin[2] = bmin[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01642}01642 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01643}01643             leaf.bmax[0] = bmax[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01644}01644             leaf.bmax[1] = bmax[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01645}01645             leaf.bmax[2] = bmax[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01646}01646 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01647}01647             assert(left\_idx < std::numeric\_limits<unsigned int>::max());}
\DoxyCodeLine{\Hypertarget{a00227_source_l01648}01648 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01649}01649             leaf.flag = 1;  \textcolor{comment}{// leaf}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01650}01650             leaf.data[0] = n;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01651}01651             leaf.data[1] = left\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01652}01652 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01653}01653             out\_nodes-\/>push\_back(leaf);  \textcolor{comment}{// atomic update}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01654}01654 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01655}01655             stats\_.num\_leaf\_nodes++;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01656}01656 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01657}01657             \textcolor{keywordflow}{return} offset;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01658}01658         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01659}01659 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01660}01660         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01661}01661         \textcolor{comment}{// Create branch node.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01662}01662         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01663}01663         \textcolor{keywordflow}{if} (depth >= max\_shallow\_depth) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01664}01664             \textcolor{comment}{// Delay to build tree}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01665}01665             ShallowNodeInfo info;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01666}01666             info.left\_idx = left\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01667}01667             info.right\_idx = right\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01668}01668             info.offset = offset;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01669}01669             shallow\_node\_infos\_.push\_back(info);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01670}01670 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01671}01671             \textcolor{comment}{// Add dummy node.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01672}01672             BVHNode<T> node;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01673}01673             node.axis = -\/1;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01674}01674             node.flag = -\/1;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01675}01675             out\_nodes-\/>push\_back(node);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01676}01676 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01677}01677             \textcolor{keywordflow}{return} offset;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01678}01678 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01679}01679         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01680}01680         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01681}01681             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01682}01682             \textcolor{comment}{// TODO(LTE): multi-\/threaded SAH computation, or use simple object median or}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01683}01683             \textcolor{comment}{// spacial median for shallow tree to speeding up the parallel build.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01684}01684             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01685}01685 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01686}01686             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01687}01687             \textcolor{comment}{// Compute SAH and find best split axis and position}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01688}01688             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01689}01689             \textcolor{keywordtype}{int} min\_cut\_axis = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01690}01690             T cut\_pos[3] = \{ 0.0, 0.0, 0.0 \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01691}01691 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01692}01692             BinBuffer bins(options\_.bin\_size);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01693}01693             \mbox{\hyperlink{a00474_a67ae269fe2215d261b995f1da13320f7}{ContributeBinBuffer}}(\&bins, bmin, bmax, \&indices\_.at(0), left\_idx, right\_idx,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01694}01694                 p);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01695}01695             \mbox{\hyperlink{a00474_ac281b6ed7e50b406666a6e67e9547b7e}{FindCutFromBinBuffer}}(cut\_pos, \&min\_cut\_axis, \&bins, bmin, bmax, n,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01696}01696                 options\_.cost\_t\_aabb);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01697}01697 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01698}01698             \textcolor{comment}{// Try all 3 axis until good cut position avaiable.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01699}01699             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} mid\_idx = left\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01700}01700             \textcolor{keywordtype}{int} cut\_axis = min\_cut\_axis;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01701}01701 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01702}01702             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} axis\_try = 0; axis\_try < 3; axis\_try++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01703}01703                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* begin = \&indices\_[left\_idx];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01704}01704                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* end =}
\DoxyCodeLine{\Hypertarget{a00227_source_l01705}01705                     \&indices\_[right\_idx -\/ 1] + 1;  \textcolor{comment}{// mimics end() iterator}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01706}01706                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* mid = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01707}01707 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01708}01708                 \textcolor{comment}{// try min\_cut\_axis first.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01709}01709                 cut\_axis = (min\_cut\_axis + axis\_try) \% 3;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01710}01710 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01711}01711                 pred.Set(cut\_axis, cut\_pos[cut\_axis]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01712}01712                 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01713}01713                 \textcolor{comment}{// Split at (cut\_axis, cut\_pos)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01714}01714                 \textcolor{comment}{// indices\_ will be modified.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01715}01715                 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01716}01716                 mid = std::partition(begin, end, pred);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01717}01717 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01718}01718                 mid\_idx = left\_idx + \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}((mid -\/ begin));}
\DoxyCodeLine{\Hypertarget{a00227_source_l01719}01719 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01720}01720                 \textcolor{keywordflow}{if} ((mid\_idx == left\_idx) || (mid\_idx == right\_idx)) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01721}01721                     \textcolor{comment}{// Can't split well.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01722}01722                     \textcolor{comment}{// Switch to object median (which may create unoptimized tree, but}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01723}01723                     \textcolor{comment}{// stable)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01724}01724                     mid\_idx = left\_idx + (n >> 1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01725}01725 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01726}01726                     \textcolor{comment}{// Try another axis if there's an axis to try.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01727}01727 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01728}01728                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01729}01729                 \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01730}01730                     \textcolor{comment}{// Found good cut. exit loop.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01731}01731                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01732}01732                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01733}01733             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01734}01734 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01735}01735             BVHNode<T> node;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01736}01736             node.axis = cut\_axis;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01737}01737             node.flag = 0;  \textcolor{comment}{// 0 = branch}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01738}01738 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01739}01739             out\_nodes-\/>push\_back(node);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01740}01740 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01741}01741             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} left\_child\_index = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01742}01742             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} right\_child\_index = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01743}01743 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01744}01744             left\_child\_index = BuildShallowTree(out\_nodes, left\_idx, mid\_idx, depth + 1,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01745}01745                 max\_shallow\_depth, p, pred);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01746}01746 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01747}01747             right\_child\_index = BuildShallowTree(out\_nodes, mid\_idx, right\_idx,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01748}01748                 depth + 1, max\_shallow\_depth, p, pred);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01749}01749 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01750}01750             \textcolor{comment}{//std::cout << "{}shallow["{} << offset << "{}] l and r = "{} << left\_child\_index << "{}, "{} << right\_child\_index << std::endl;}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01751}01751             (*out\_nodes)[offset].data[0] = left\_child\_index;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01752}01752             (*out\_nodes)[offset].data[1] = right\_child\_index;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01753}01753 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01754}01754             (*out\_nodes)[offset].bmin[0] = bmin[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01755}01755             (*out\_nodes)[offset].bmin[1] = bmin[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01756}01756             (*out\_nodes)[offset].bmin[2] = bmin[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01757}01757 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01758}01758             (*out\_nodes)[offset].bmax[0] = bmax[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01759}01759             (*out\_nodes)[offset].bmax[1] = bmax[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01760}01760             (*out\_nodes)[offset].bmax[2] = bmax[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01761}01761         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01762}01762 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01763}01763         stats\_.num\_branch\_nodes++;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01764}01764 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01765}01765         \textcolor{keywordflow}{return} offset;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01766}01766     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01767}01767 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01768}01768 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01769}01769     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01770}01770     \textcolor{keyword}{template} <\textcolor{keyword}{class} P, \textcolor{keyword}{class} Pred>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01771}\mbox{\hyperlink{a01483_ae0e4bf0fab331dbacf469a3e991132e5}{01771}}     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01483_ae0e4bf0fab331dbacf469a3e991132e5}{BVHAccel<T>::BuildTree}}(\mbox{\hyperlink{a01463}{BVHBuildStatistics}}* out\_stat,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01772}01772         std::vector<\mbox{\hyperlink{a01451}{BVHNode<T>}} >* out\_nodes,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01773}01773         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} left\_idx,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01774}01774         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} right\_idx, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} depth,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01775}01775         \textcolor{keyword}{const} P\& p, \textcolor{keyword}{const} Pred\& pred) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01776}01776         assert(left\_idx <= right\_idx);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01777}01777 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01778}01778         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} offset = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(out\_nodes-\/>size());}
\DoxyCodeLine{\Hypertarget{a00227_source_l01779}01779 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01780}01780         \textcolor{keywordflow}{if} (out\_stat-\/>\mbox{\hyperlink{a01463_a7ffd6278400de90a262d5bb83589c1c1}{max\_tree\_depth}} < depth) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01781}01781             out\_stat-\/>\mbox{\hyperlink{a01463_a7ffd6278400de90a262d5bb83589c1c1}{max\_tree\_depth}} = depth;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01782}01782         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01783}01783 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01784}01784         \mbox{\hyperlink{a01443}{real3<T>}} bmin, bmax;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01785}01785         \textcolor{keywordflow}{if} (!bboxes\_.empty()) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01786}01786             \mbox{\hyperlink{a00474_a60ac3f02ccb852decfdc6f7f02d7184f}{GetBoundingBox}}(\&bmin, \&bmax, bboxes\_, \&indices\_.at(0), left\_idx, right\_idx);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01787}01787         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01788}01788         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01789}01789             \mbox{\hyperlink{a00474_a06549eb8469b9a2004cc5332ca0d011e}{ComputeBoundingBox}}(\&bmin, \&bmax, \&indices\_.at(0), left\_idx, right\_idx, p);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01790}01790         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01791}01791 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01792}01792         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} n = right\_idx -\/ left\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01793}01793         \textcolor{keywordflow}{if} ((n <= options\_.min\_leaf\_primitives) ||}
\DoxyCodeLine{\Hypertarget{a00227_source_l01794}01794             (depth >= options\_.max\_tree\_depth)) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01795}01795             \textcolor{comment}{// Create leaf node.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01796}01796             \mbox{\hyperlink{a01451}{BVHNode<T>}} leaf;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01797}01797 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01798}01798             leaf.\mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[0] = bmin[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01799}01799             leaf.\mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[1] = bmin[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01800}01800             leaf.\mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}}[2] = bmin[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01801}01801 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01802}01802             leaf.\mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[0] = bmax[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01803}01803             leaf.\mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[1] = bmax[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01804}01804             leaf.\mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}[2] = bmax[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01805}01805 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01806}01806             assert(left\_idx < std::numeric\_limits<unsigned int>::max());}
\DoxyCodeLine{\Hypertarget{a00227_source_l01807}01807 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01808}01808             leaf.\mbox{\hyperlink{a01451_a21a298034fec1fe031c54bb3a6a6fa5e}{flag}} = 1;  \textcolor{comment}{// leaf}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01809}01809             leaf.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[0] = n;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01810}01810             leaf.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[1] = left\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01811}01811 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01812}01812             out\_nodes-\/>push\_back(leaf);  \textcolor{comment}{// atomic update}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01813}01813 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01814}01814             out\_stat-\/>\mbox{\hyperlink{a01463_a42b219665f02f3eaa89c008d0215336d}{num\_leaf\_nodes}}++;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01815}01815 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01816}01816             \textcolor{keywordflow}{return} offset;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01817}01817         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01818}01818 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01819}01819         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01820}01820         \textcolor{comment}{// Create branch node.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01821}01821         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01822}01822 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01823}01823         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01824}01824         \textcolor{comment}{// Compute SAH and find best split axis and position}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01825}01825         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01826}01826         \textcolor{keywordtype}{int} min\_cut\_axis = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01827}01827         T cut\_pos[3] = \{ 0.0, 0.0, 0.0 \};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01828}01828 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01829}01829         \mbox{\hyperlink{a01507}{BinBuffer}} bins(options\_.bin\_size);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01830}01830         \mbox{\hyperlink{a00474_a67ae269fe2215d261b995f1da13320f7}{ContributeBinBuffer}}(\&bins, bmin, bmax, \&indices\_.at(0), left\_idx, right\_idx,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01831}01831             p);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01832}01832         \mbox{\hyperlink{a00474_ac281b6ed7e50b406666a6e67e9547b7e}{FindCutFromBinBuffer}}(cut\_pos, \&min\_cut\_axis, \&bins, bmin, bmax, n,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01833}01833             options\_.cost\_t\_aabb);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01834}01834 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01835}01835         \textcolor{comment}{// Try all 3 axis until good cut position avaiable.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01836}01836         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} mid\_idx = left\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01837}01837         \textcolor{keywordtype}{int} cut\_axis = min\_cut\_axis;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01838}01838 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01839}01839         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} axis\_try = 0; axis\_try < 3; axis\_try++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01840}01840             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* begin = \&indices\_[left\_idx];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01841}01841             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* end = \&indices\_[right\_idx -\/ 1] + 1;  \textcolor{comment}{// mimics end() iterator.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01842}01842             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}* mid = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01843}01843 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01844}01844             \textcolor{comment}{// try min\_cut\_axis first.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01845}01845             cut\_axis = (min\_cut\_axis + axis\_try) \% 3;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01846}01846 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01847}01847             pred.Set(cut\_axis, cut\_pos[cut\_axis]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01848}01848 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01849}01849             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01850}01850             \textcolor{comment}{// Split at (cut\_axis, cut\_pos)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01851}01851             \textcolor{comment}{// indices\_ will be modified.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01852}01852             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01853}01853             mid = std::partition(begin, end, pred);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01854}01854 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01855}01855             mid\_idx = left\_idx + \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}((mid -\/ begin));}
\DoxyCodeLine{\Hypertarget{a00227_source_l01856}01856 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01857}01857             \textcolor{keywordflow}{if} ((mid\_idx == left\_idx) || (mid\_idx == right\_idx)) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01858}01858                 \textcolor{comment}{// Can't split well.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01859}01859                 \textcolor{comment}{// Switch to object median(which may create unoptimized tree, but}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01860}01860                 \textcolor{comment}{// stable)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01861}01861                 mid\_idx = left\_idx + (n >> 1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01862}01862 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01863}01863                 \textcolor{comment}{// Try another axis to find better cut.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01864}01864 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01865}01865             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01866}01866             \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01867}01867                 \textcolor{comment}{// Found good cut. exit loop.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01868}01868                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01869}01869             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01870}01870         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01871}01871 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01872}01872         \mbox{\hyperlink{a01451}{BVHNode<T>}} node;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01873}01873         node.\mbox{\hyperlink{a01451_a6988b1df6a0fc7523ea0ed099cd0495c}{axis}} = cut\_axis;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01874}01874         node.\mbox{\hyperlink{a01451_a21a298034fec1fe031c54bb3a6a6fa5e}{flag}} = 0;  \textcolor{comment}{// 0 = branch}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01875}01875 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01876}01876         out\_nodes-\/>push\_back(node);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01877}01877 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01878}01878         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} left\_child\_index = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01879}01879         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} right\_child\_index = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01880}01880 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01881}01881         left\_child\_index =}
\DoxyCodeLine{\Hypertarget{a00227_source_l01882}01882             BuildTree(out\_stat, out\_nodes, left\_idx, mid\_idx, depth + 1, p, pred);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01883}01883 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01884}01884         right\_child\_index =}
\DoxyCodeLine{\Hypertarget{a00227_source_l01885}01885             BuildTree(out\_stat, out\_nodes, mid\_idx, right\_idx, depth + 1, p, pred);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01886}01886 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01887}01887         \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01888}01888             (*out\_nodes)[offset].data[0] = left\_child\_index;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01889}01889             (*out\_nodes)[offset].data[1] = right\_child\_index;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01890}01890 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01891}01891             (*out\_nodes)[offset].bmin[0] = bmin[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01892}01892             (*out\_nodes)[offset].bmin[1] = bmin[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01893}01893             (*out\_nodes)[offset].bmin[2] = bmin[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01894}01894 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01895}01895             (*out\_nodes)[offset].bmax[0] = bmax[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01896}01896             (*out\_nodes)[offset].bmax[1] = bmax[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01897}01897             (*out\_nodes)[offset].bmax[2] = bmax[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01898}01898         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01899}01899 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01900}01900         out\_stat-\/>\mbox{\hyperlink{a01463_ae95201c13555ea6ccb454f86ace83f5f}{num\_branch\_nodes}}++;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01901}01901 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01902}01902         \textcolor{keywordflow}{return} offset;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01903}01903     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01904}01904 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01905}01905     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01906}01906     \textcolor{keyword}{template} <\textcolor{keyword}{class} Prim, \textcolor{keyword}{class} Pred>}
\DoxyCodeLine{\Hypertarget{a00227_source_l01907}\mbox{\hyperlink{a01483_a96521982d08e0ccd728798410dabeed5}{01907}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01483_a96521982d08e0ccd728798410dabeed5}{BVHAccel<T>::Build}}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_primitives, \textcolor{keyword}{const} Prim\& p,}
\DoxyCodeLine{\Hypertarget{a00227_source_l01908}01908         \textcolor{keyword}{const} Pred\& pred, \textcolor{keyword}{const} \mbox{\hyperlink{a01459}{BVHBuildOptions<T>}}\& options) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01909}01909         options\_ = options;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01910}01910         stats\_ = \mbox{\hyperlink{a01463}{BVHBuildStatistics}}();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01911}01911 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01912}01912         nodes\_.clear();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01913}01913         bboxes\_.clear();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01914}01914 \textcolor{preprocessor}{\#if defined(NANORT\_ENABLE\_PARALLEL\_BUILD)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01915}01915         shallow\_node\_infos\_.clear();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01916}01916 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01917}01917 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01918}01918         assert(options\_.bin\_size > 1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01919}01919 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01920}01920         \textcolor{keywordflow}{if} (num\_primitives == 0) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01921}01921             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l01922}01922         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01923}01923 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01924}01924         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} n = num\_primitives;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01925}01925 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01926}01926         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01927}01927         \textcolor{comment}{// 1. Create triangle indices(this will be permutated in BuildTree)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01928}01928         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01929}01929         indices\_.resize(n);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01930}01930 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01931}01931 \textcolor{preprocessor}{\#if defined(NANORT\_USE\_CPP11\_FEATURE)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01932}01932         \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01933}01933             \textcolor{keywordtype}{size\_t} num\_threads = std::min(}
\DoxyCodeLine{\Hypertarget{a00227_source_l01934}01934                 \textcolor{keywordtype}{size\_t}(kNANORT\_MAX\_THREADS),}
\DoxyCodeLine{\Hypertarget{a00227_source_l01935}01935                 std::max(\textcolor{keywordtype}{size\_t}(1), \textcolor{keywordtype}{size\_t}(std::thread::hardware\_concurrency())));}
\DoxyCodeLine{\Hypertarget{a00227_source_l01936}01936 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01937}01937             \textcolor{keywordflow}{if} (n < num\_threads) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01938}01938                 num\_threads = n;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01939}01939             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01940}01940 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01941}01941             std::vector<std::thread> workers;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01942}01942 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01943}01943             \textcolor{keywordtype}{size\_t} ndiv = n / num\_threads;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01944}01944 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01945}01945             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} t = 0; t < num\_threads; t++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01946}01946                 workers.emplace\_back(std::thread([\&, t]() \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01947}01947                     \textcolor{keywordtype}{size\_t} si = t * ndiv;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01948}01948                     \textcolor{keywordtype}{size\_t} ei = (t == (num\_threads -\/ 1)) ? n : std::min((t + 1) * ndiv, \textcolor{keywordtype}{size\_t}(n));}
\DoxyCodeLine{\Hypertarget{a00227_source_l01949}01949 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01950}01950                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} k = si; k < ei; k++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01951}01951                         indices\_[k] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(k);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01952}01952                     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01953}01953                     \}));}
\DoxyCodeLine{\Hypertarget{a00227_source_l01954}01954             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01955}01955 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01956}01956             \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& t : workers) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01957}01957                 t.join();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01958}01958             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01959}01959         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01960}01960 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01961}01961 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01962}01962 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01963}01963 \textcolor{preprocessor}{\#ifdef \_OPENMP}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01964}01964 \textcolor{preprocessor}{\#pragma omp parallel for}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01965}01965 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01966}01966         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < static\_cast<int>(n); i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01967}01967             indices\_[\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(i)] = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(i);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01968}01968         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01969}01969 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// !NANORT\_USE\_CPP11\_FEATURE}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01970}01970 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01971}01971         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01972}01972         \textcolor{comment}{// 2. Compute bounding box (optional).}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01973}01973         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01974}01974         \mbox{\hyperlink{a01443}{real3<T>}} bmin, bmax;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01975}01975 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01976}01976         \textcolor{keywordflow}{if} (options.\mbox{\hyperlink{a01459_a99d7328a59abcb9aeaa23cede349e251}{cache\_bbox}}) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01977}01977             bmin[0] = bmin[1] = bmin[2] = std::numeric\_limits<T>::max();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01978}01978             bmax[0] = bmax[1] = bmax[2] = -\/std::numeric\_limits<T>::max();}
\DoxyCodeLine{\Hypertarget{a00227_source_l01979}01979 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01980}01980             bboxes\_.resize(n);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01981}01981 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01982}01982             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < n; i++) \{  \textcolor{comment}{// for each primitive}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01983}01983                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} idx = indices\_[i];}
\DoxyCodeLine{\Hypertarget{a00227_source_l01984}01984 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01985}01985                 \mbox{\hyperlink{a01471}{BBox<T>}} bbox;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01986}01986                 p.BoundingBox(\&(bbox.\mbox{\hyperlink{a01471_aa045e09d02bdee79137a15d04f46471e}{bmin}}), \&(bbox.\mbox{\hyperlink{a01471_a1ab4f62812a56eebc185a97afd30ebdd}{bmax}}), \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(i));}
\DoxyCodeLine{\Hypertarget{a00227_source_l01987}01987                 bboxes\_[idx] = bbox;}
\DoxyCodeLine{\Hypertarget{a00227_source_l01988}01988 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01989}01989                 \textcolor{comment}{// xyz}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01990}01990                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 3; k++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01991}01991                     bmin[k] = std::min(bmin[k], bbox.\mbox{\hyperlink{a01471_aa045e09d02bdee79137a15d04f46471e}{bmin}}[k]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01992}01992                     bmax[k] = std::max(bmax[k], bbox.\mbox{\hyperlink{a01471_a1ab4f62812a56eebc185a97afd30ebdd}{bmax}}[k]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l01993}01993                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01994}01994             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01995}01995 }
\DoxyCodeLine{\Hypertarget{a00227_source_l01996}01996         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01997}01997         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l01998}01998 \textcolor{preprocessor}{\#if defined(NANORT\_USE\_CPP11\_FEATURE)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l01999}01999             ComputeBoundingBoxThreaded(\&bmin, \&bmax, \&indices\_.at(0), 0, n, p);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02000}02000 \textcolor{preprocessor}{\#elif defined(\_OPENMP)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02001}02001             ComputeBoundingBoxOMP(\&bmin, \&bmax, \&indices\_.at(0), 0, n, p);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02002}02002 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02003}02003             \mbox{\hyperlink{a00474_a06549eb8469b9a2004cc5332ca0d011e}{ComputeBoundingBox}}(\&bmin, \&bmax, \&indices\_.at(0), 0, n, p);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02004}02004 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02005}02005         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02006}02006 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02007}02007         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02008}02008         \textcolor{comment}{// 3. Build tree}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02009}02009         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02010}02010 \textcolor{preprocessor}{\#if defined(NANORT\_ENABLE\_PARALLEL\_BUILD)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02011}02011 \textcolor{preprocessor}{\#if defined(NANORT\_USE\_CPP11\_FEATURE)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02012}02012 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02013}02013   \textcolor{comment}{// Do parallel build for large enough datasets.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02014}02014         \textcolor{keywordflow}{if} (n > options.\mbox{\hyperlink{a01459_a75d2abe7b240f074fb6369468261d793}{min\_primitives\_for\_parallel\_build}}) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02015}02015             BuildShallowTree(\&nodes\_, 0, n, \textcolor{comment}{/* root depth */} 0, options.\mbox{\hyperlink{a01459_abc7ea884176924446d76f1e17c9f46c0}{shallow\_depth}},}
\DoxyCodeLine{\Hypertarget{a00227_source_l02016}02016                 p, pred);  \textcolor{comment}{// [0, n)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02017}02017 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02018}02018             assert(shallow\_node\_infos\_.size() > 0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02019}02019 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02020}02020             \textcolor{comment}{// Build deeper tree in parallel}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02021}02021             std::vector<std::vector<BVHNode<T> > > local\_nodes(}
\DoxyCodeLine{\Hypertarget{a00227_source_l02022}02022                 shallow\_node\_infos\_.size());}
\DoxyCodeLine{\Hypertarget{a00227_source_l02023}02023             std::vector<BVHBuildStatistics> local\_stats(shallow\_node\_infos\_.size());}
\DoxyCodeLine{\Hypertarget{a00227_source_l02024}02024 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02025}02025             \textcolor{keywordtype}{size\_t} num\_threads = std::min(}
\DoxyCodeLine{\Hypertarget{a00227_source_l02026}02026                 \textcolor{keywordtype}{size\_t}(kNANORT\_MAX\_THREADS),}
\DoxyCodeLine{\Hypertarget{a00227_source_l02027}02027                 std::max(\textcolor{keywordtype}{size\_t}(1), \textcolor{keywordtype}{size\_t}(std::thread::hardware\_concurrency())));}
\DoxyCodeLine{\Hypertarget{a00227_source_l02028}02028             \textcolor{keywordflow}{if} (shallow\_node\_infos\_.size() < num\_threads) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02029}02029                 num\_threads = shallow\_node\_infos\_.size();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02030}02030             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02031}02031 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02032}02032             std::vector<std::thread> workers;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02033}02033             std::atomic<uint32\_t> i(0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02034}02034 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02035}02035             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} t = 0; t < num\_threads; t++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02036}02036                 workers.emplace\_back(std::thread([\&]() \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02037}02037                     uint32\_t idx = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02038}02038                     \textcolor{keywordflow}{while} ((idx = (i++)) < shallow\_node\_infos\_.size()) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02039}02039                         \textcolor{comment}{// Create thread-\/local copy of Pred since some mutable variables are}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02040}02040                         \textcolor{comment}{// modified during SAH computation.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02041}02041                         const Pred local\_pred = pred;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02042}02042                         unsigned int left\_idx = shallow\_node\_infos\_[size\_t(idx)].left\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02043}02043                         unsigned int right\_idx = shallow\_node\_infos\_[size\_t(idx)].right\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02044}02044                         BuildTree(\&(local\_stats[size\_t(idx)]), \&(local\_nodes[size\_t(idx)]),}
\DoxyCodeLine{\Hypertarget{a00227_source_l02045}02045                             left\_idx, right\_idx, options.shallow\_depth, p, local\_pred);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02046}02046                     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02047}02047                     \}));}
\DoxyCodeLine{\Hypertarget{a00227_source_l02048}02048             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02049}02049 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02050}02050             \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& t : workers) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02051}02051                 t.join();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02052}02052             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02053}02053 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02054}02054             \textcolor{comment}{// Join local nodes}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02055}02055             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} ii = 0; ii < local\_nodes.size(); ii++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02056}02056                 assert(!local\_nodes[ii].empty());}
\DoxyCodeLine{\Hypertarget{a00227_source_l02057}02057                 \textcolor{keywordtype}{size\_t} offset = nodes\_.size();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02058}02058 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02059}02059                 \textcolor{comment}{// Add offset to child index (for branch node).}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02060}02060                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < local\_nodes[ii].size(); j++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02061}02061                     \textcolor{keywordflow}{if} (local\_nodes[ii][j].flag == 0) \{  \textcolor{comment}{// branch}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02062}02062                         local\_nodes[ii][j].data[0] += offset -\/ 1;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02063}02063                         local\_nodes[ii][j].data[1] += offset -\/ 1;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02064}02064                     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02065}02065                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02066}02066 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02067}02067                 \textcolor{comment}{// replace}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02068}02068                 nodes\_[shallow\_node\_infos\_[ii].offset] = local\_nodes[ii][0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02069}02069 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02070}02070                 \textcolor{comment}{// Skip root element of the local node.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02071}02071                 nodes\_.insert(nodes\_.end(), local\_nodes[ii].begin() + 1,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02072}02072                     local\_nodes[ii].end());}
\DoxyCodeLine{\Hypertarget{a00227_source_l02073}02073             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02074}02074 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02075}02075             \textcolor{comment}{// Join statistics}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02076}02076             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} ii = 0; ii < local\_nodes.size(); ii++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02077}02077                 stats\_.max\_tree\_depth =}
\DoxyCodeLine{\Hypertarget{a00227_source_l02078}02078                     std::max(stats\_.max\_tree\_depth, local\_stats[ii].max\_tree\_depth);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02079}02079                 stats\_.num\_leaf\_nodes += local\_stats[ii].num\_leaf\_nodes;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02080}02080                 stats\_.num\_branch\_nodes += local\_stats[ii].num\_branch\_nodes;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02081}02081             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02082}02082 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02083}02083         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02084}02084         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02085}02085             \textcolor{comment}{// Single thread.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02086}02086             BuildTree(\&stats\_, \&nodes\_, 0, n,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02087}02087                 \textcolor{comment}{/* root depth */} 0, p, pred);  \textcolor{comment}{// [0, n)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02088}02088         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02089}02089 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02090}02090 \textcolor{preprocessor}{\#elif defined(\_OPENMP)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02091}02091 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02092}02092   \textcolor{comment}{// Do parallel build for large enough datasets.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02093}02093         \textcolor{keywordflow}{if} (n > options.\mbox{\hyperlink{a01459_a75d2abe7b240f074fb6369468261d793}{min\_primitives\_for\_parallel\_build}}) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02094}02094             BuildShallowTree(\&nodes\_, 0, n, \textcolor{comment}{/* root depth */} 0, options.\mbox{\hyperlink{a01459_abc7ea884176924446d76f1e17c9f46c0}{shallow\_depth}},}
\DoxyCodeLine{\Hypertarget{a00227_source_l02095}02095                 p, pred);  \textcolor{comment}{// [0, n)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02096}02096 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02097}02097             assert(shallow\_node\_infos\_.size() > 0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02098}02098 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02099}02099             \textcolor{comment}{// Build deeper tree in parallel}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02100}02100             std::vector<std::vector<BVHNode<T> > > local\_nodes(}
\DoxyCodeLine{\Hypertarget{a00227_source_l02101}02101                 shallow\_node\_infos\_.size());}
\DoxyCodeLine{\Hypertarget{a00227_source_l02102}02102             std::vector<BVHBuildStatistics> local\_stats(shallow\_node\_infos\_.size());}
\DoxyCodeLine{\Hypertarget{a00227_source_l02103}02103 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02104}02104 \textcolor{preprocessor}{\#pragma omp parallel for}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02105}02105             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < static\_cast<int>(shallow\_node\_infos\_.size()); i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02106}02106                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} left\_idx = shallow\_node\_infos\_[size\_t(i)].left\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02107}02107                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} right\_idx = shallow\_node\_infos\_[size\_t(i)].right\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02108}02108                 \textcolor{keyword}{const} Pred local\_pred = pred;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02109}02109                 BuildTree(\&(local\_stats[\textcolor{keywordtype}{size\_t}(i)]), \&(local\_nodes[\textcolor{keywordtype}{size\_t}(i)]), left\_idx,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02110}02110                     right\_idx, options.\mbox{\hyperlink{a01459_abc7ea884176924446d76f1e17c9f46c0}{shallow\_depth}}, p, local\_pred);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02111}02111             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02112}02112 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02113}02113             \textcolor{comment}{// Join local nodes}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02114}02114             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < local\_nodes.size(); i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02115}02115                 assert(!local\_nodes[\textcolor{keywordtype}{size\_t}(i)].empty());}
\DoxyCodeLine{\Hypertarget{a00227_source_l02116}02116                 \textcolor{keywordtype}{size\_t} offset = nodes\_.size();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02117}02117 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02118}02118                 \textcolor{comment}{// Add offset to child index (for branch node).}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02119}02119                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < local\_nodes[i].size(); j++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02120}02120                     \textcolor{keywordflow}{if} (local\_nodes[i][j].flag == 0) \{  \textcolor{comment}{// branch}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02121}02121                         local\_nodes[i][j].data[0] += offset -\/ 1;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02122}02122                         local\_nodes[i][j].data[1] += offset -\/ 1;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02123}02123                     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02124}02124                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02125}02125 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02126}02126                 \textcolor{comment}{// replace}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02127}02127                 nodes\_[shallow\_node\_infos\_[i].offset] = local\_nodes[i][0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02128}02128 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02129}02129                 \textcolor{comment}{// Skip root element of the local node.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02130}02130                 nodes\_.insert(nodes\_.end(), local\_nodes[i].begin() + 1,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02131}02131                     local\_nodes[i].end());}
\DoxyCodeLine{\Hypertarget{a00227_source_l02132}02132             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02133}02133 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02134}02134             \textcolor{comment}{// Join statistics}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02135}02135             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < local\_nodes.size(); i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02136}02136                 stats\_.max\_tree\_depth =}
\DoxyCodeLine{\Hypertarget{a00227_source_l02137}02137                     std::max(stats\_.max\_tree\_depth, local\_stats[i].max\_tree\_depth);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02138}02138                 stats\_.num\_leaf\_nodes += local\_stats[i].num\_leaf\_nodes;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02139}02139                 stats\_.num\_branch\_nodes += local\_stats[i].num\_branch\_nodes;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02140}02140             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02141}02141 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02142}02142         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02143}02143         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02144}02144             \textcolor{comment}{// Single thread}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02145}02145             BuildTree(\&stats\_, \&nodes\_, 0, n,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02146}02146                 \textcolor{comment}{/* root depth */} 0, p, pred);  \textcolor{comment}{// [0, n)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02147}02147         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02148}02148 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02149}02149 \textcolor{preprocessor}{\#else  }\textcolor{comment}{// !NANORT\_ENABLE\_PARALLEL\_BUILD}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02150}02150         \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02151}02151             BuildTree(\&stats\_, \&nodes\_, 0, n,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02152}02152                 \textcolor{comment}{/* root depth */} 0, p, pred);  \textcolor{comment}{// [0, n)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02153}02153         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02154}02154 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02155}02155 \textcolor{preprocessor}{\#else  }\textcolor{comment}{// !\_OPENMP}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02156}02156 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02157}02157   \textcolor{comment}{// Single thread BVH build}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02158}02158         \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02159}02159             BuildTree(\&stats\_, \&nodes\_, 0, n,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02160}02160                 \textcolor{comment}{/* root depth */} 0, p, pred);  \textcolor{comment}{// [0, n)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02161}02161         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02162}02162 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02163}02163 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02164}02164         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02165}02165     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02166}02166 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02167}02167     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02168}\mbox{\hyperlink{a01483_a1b5f5fb5f85cf6a91987c14aa70ab456}{02168}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{a01483_a1b5f5fb5f85cf6a91987c14aa70ab456}{BVHAccel<T>::Debug}}() \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02169}02169         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < indices\_.size(); i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02170}02170             printf(\textcolor{stringliteral}{"{}index[\%d] = \%d\(\backslash\)n"{}}, \textcolor{keywordtype}{int}(i), \textcolor{keywordtype}{int}(indices\_[i]));}
\DoxyCodeLine{\Hypertarget{a00227_source_l02171}02171         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02172}02172 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02173}02173         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < nodes\_.size(); i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02174}02174             printf(\textcolor{stringliteral}{"{}node[\%d] : bmin \%f, \%f, \%f, bmax \%f, \%f, \%f\(\backslash\)n"{}}, \textcolor{keywordtype}{int}(i),}
\DoxyCodeLine{\Hypertarget{a00227_source_l02175}02175                 nodes\_[i].bmin[0], nodes\_[i].bmin[1], nodes\_[i].bmin[1],}
\DoxyCodeLine{\Hypertarget{a00227_source_l02176}02176                 nodes\_[i].bmax[0], nodes\_[i].bmax[1], nodes\_[i].bmax[1]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02177}02177         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02178}02178     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02179}02179 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02180}02180 \textcolor{preprocessor}{\#if defined(NANORT\_ENABLE\_SERIALIZATION)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02181}02181     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02182}02182     \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01483}{BVHAccel<T>::Dump}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* filename)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02183}02183         FILE* fp = fopen(filename, \textcolor{stringliteral}{"{}wb"{}});}
\DoxyCodeLine{\Hypertarget{a00227_source_l02184}02184         \textcolor{keywordflow}{if} (!fp) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02185}02185             \textcolor{comment}{// fprintf(stderr, "{}[BVHAccel] Cannot write a file: \%s\(\backslash\)n"{}, filename);}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02186}02186             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02187}02187         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02188}02188 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02189}02189         \textcolor{keywordtype}{size\_t} numNodes = nodes\_.size();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02190}02190         assert(nodes\_.size() > 0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02191}02191 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02192}02192         \textcolor{keywordtype}{size\_t} numIndices = indices\_.size();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02193}02193 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02194}02194         \textcolor{keywordtype}{size\_t} r = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02195}02195         r = fwrite(\&numNodes, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}), 1, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02196}02196         assert(r == 1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02197}02197 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02198}02198         r = fwrite(\&nodes\_.at(0), \textcolor{keyword}{sizeof}(BVHNode<T>), numNodes, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02199}02199         assert(r == numNodes);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02200}02200 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02201}02201         r = fwrite(\&numIndices, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}), 1, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02202}02202         assert(r == 1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02203}02203 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02204}02204         r = fwrite(\&indices\_.at(0), \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}), numIndices, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02205}02205         assert(r == numIndices);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02206}02206 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02207}02207         fclose(fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02208}02208 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02209}02209         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02210}02210     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02211}02211 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02212}02212     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02213}02213     \textcolor{keywordtype}{bool} BVHAccel<T>::Dump(FILE* fp)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02214}02214         \textcolor{keywordtype}{size\_t} numNodes = nodes\_.size();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02215}02215         assert(nodes\_.size() > 0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02216}02216 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02217}02217         \textcolor{keywordtype}{size\_t} numIndices = indices\_.size();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02218}02218 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02219}02219         \textcolor{keywordtype}{size\_t} r = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02220}02220         r = fwrite(\&numNodes, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}), 1, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02221}02221         assert(r == 1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02222}02222 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02223}02223         r = fwrite(\&nodes\_.at(0), \textcolor{keyword}{sizeof}(BVHNode<T>), numNodes, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02224}02224         assert(r == numNodes);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02225}02225 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02226}02226         r = fwrite(\&numIndices, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}), 1, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02227}02227         assert(r == 1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02228}02228 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02229}02229         r = fwrite(\&indices\_.at(0), \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}), numIndices, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02230}02230         assert(r == numIndices);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02231}02231 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02232}02232         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02233}02233     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02234}02234 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02235}02235     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02236}02236     \textcolor{keywordtype}{bool} BVHAccel<T>::Load(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* filename) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02237}02237         FILE* fp = fopen(filename, \textcolor{stringliteral}{"{}rb"{}});}
\DoxyCodeLine{\Hypertarget{a00227_source_l02238}02238         \textcolor{keywordflow}{if} (!fp) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02239}02239             \textcolor{comment}{// fprintf(stderr, "{}Cannot open file: \%s\(\backslash\)n"{}, filename);}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02240}02240             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02241}02241         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02242}02242 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02243}02243         \textcolor{keywordtype}{size\_t} numNodes;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02244}02244         \textcolor{keywordtype}{size\_t} numIndices;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02245}02245 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02246}02246         \textcolor{keywordtype}{size\_t} r = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02247}02247         r = fread(\&numNodes, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}), 1, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02248}02248         assert(r == 1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02249}02249         assert(numNodes > 0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02250}02250 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02251}02251         nodes\_.resize(numNodes);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02252}02252         r = fread(\&nodes\_.at(0), \textcolor{keyword}{sizeof}(BVHNode<T>), numNodes, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02253}02253         assert(r == numNodes);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02254}02254 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02255}02255         r = fread(\&numIndices, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}), 1, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02256}02256         assert(r == 1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02257}02257 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02258}02258         indices\_.resize(numIndices);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02259}02259 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02260}02260         r = fread(\&indices\_.at(0), \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}), numIndices, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02261}02261         assert(r == numIndices);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02262}02262 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02263}02263         fclose(fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02264}02264 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02265}02265         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02266}02266     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02267}02267 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02268}02268     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02269}02269     \textcolor{keywordtype}{bool} BVHAccel<T>::Load(FILE* fp) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02270}02270         \textcolor{keywordtype}{size\_t} numNodes;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02271}02271         \textcolor{keywordtype}{size\_t} numIndices;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02272}02272 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02273}02273         \textcolor{keywordtype}{size\_t} r = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02274}02274         r = fread(\&numNodes, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}), 1, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02275}02275         assert(r == 1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02276}02276         assert(numNodes > 0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02277}02277 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02278}02278         nodes\_.resize(numNodes);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02279}02279         r = fread(\&nodes\_.at(0), \textcolor{keyword}{sizeof}(BVHNode<T>), numNodes, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02280}02280         assert(r == numNodes);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02281}02281 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02282}02282         r = fread(\&numIndices, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}), 1, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02283}02283         assert(r == 1);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02284}02284 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02285}02285         indices\_.resize(numIndices);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02286}02286 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02287}02287         r = fread(\&indices\_.at(0), \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}), numIndices, fp);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02288}02288         assert(r == numIndices);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02289}02289 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02290}02290         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02291}02291     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02292}02292 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02293}02293 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02294}02294     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02295}\mbox{\hyperlink{a00474_aa5a9a561d084639fafc84873ab8f3d51}{02295}}     \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a00474_aa5a9a561d084639fafc84873ab8f3d51}{IntersectRayAABB}}(T* tminOut,  \textcolor{comment}{// [out]}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02296}02296         T* tmaxOut,  \textcolor{comment}{// [out]}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02297}02297         T min\_t, T max\_t, \textcolor{keyword}{const} T bmin[3], \textcolor{keyword}{const} T bmax[3],}
\DoxyCodeLine{\Hypertarget{a00227_source_l02298}02298         \mbox{\hyperlink{a01443}{real3<T>}} ray\_org, \mbox{\hyperlink{a01443}{real3<T>}} ray\_inv\_dir,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02299}02299         \textcolor{keywordtype}{int} ray\_dir\_sign[3]);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02300}02300     \textcolor{keyword}{template} <>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02301}\mbox{\hyperlink{a00474_abb906c21cbf94086beb735d63383a20e}{02301}}     \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a00474_abb906c21cbf94086beb735d63383a20e}{IntersectRayAABB<float>}}(\textcolor{keywordtype}{float}* tminOut,  \textcolor{comment}{// [out]}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02302}02302         \textcolor{keywordtype}{float}* tmaxOut,  \textcolor{comment}{// [out]}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02303}02303         \textcolor{keywordtype}{float} min\_t, \textcolor{keywordtype}{float} max\_t,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02304}02304         \textcolor{keyword}{const} \textcolor{keywordtype}{float} bmin[3], \textcolor{keyword}{const} \textcolor{keywordtype}{float} bmax[3],}
\DoxyCodeLine{\Hypertarget{a00227_source_l02305}02305         \mbox{\hyperlink{a01443}{real3<float>}} ray\_org,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02306}02306         \mbox{\hyperlink{a01443}{real3<float>}} ray\_inv\_dir,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02307}02307         \textcolor{keywordtype}{int} ray\_dir\_sign[3]) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02308}02308         \textcolor{keywordtype}{float} tmin, tmax;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02309}02309 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02310}02310         \textcolor{keyword}{const} \textcolor{keywordtype}{float} min\_x = ray\_dir\_sign[0] ? bmax[0] : bmin[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02311}02311         \textcolor{keyword}{const} \textcolor{keywordtype}{float} min\_y = ray\_dir\_sign[1] ? bmax[1] : bmin[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02312}02312         \textcolor{keyword}{const} \textcolor{keywordtype}{float} min\_z = ray\_dir\_sign[2] ? bmax[2] : bmin[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02313}02313         \textcolor{keyword}{const} \textcolor{keywordtype}{float} max\_x = ray\_dir\_sign[0] ? bmin[0] : bmax[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02314}02314         \textcolor{keyword}{const} \textcolor{keywordtype}{float} max\_y = ray\_dir\_sign[1] ? bmin[1] : bmax[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02315}02315         \textcolor{keyword}{const} \textcolor{keywordtype}{float} max\_z = ray\_dir\_sign[2] ? bmin[2] : bmax[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02316}02316 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02317}02317         \textcolor{comment}{// X}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02318}02318         \textcolor{keyword}{const} \textcolor{keywordtype}{float} tmin\_x = (min\_x -\/ ray\_org[0]) * ray\_inv\_dir[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02319}02319         \textcolor{comment}{// MaxMult robust BVH traversal(up to 4 ulp).}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02320}02320         \textcolor{comment}{// 1.0000000000000004 for double precision.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02321}02321         \textcolor{keyword}{const} \textcolor{keywordtype}{float} tmax\_x = (max\_x -\/ ray\_org[0]) * ray\_inv\_dir[0] * 1.00000024f;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02322}02322 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02323}02323         \textcolor{comment}{// Y}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02324}02324         \textcolor{keyword}{const} \textcolor{keywordtype}{float} tmin\_y = (min\_y -\/ ray\_org[1]) * ray\_inv\_dir[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02325}02325         \textcolor{keyword}{const} \textcolor{keywordtype}{float} tmax\_y = (max\_y -\/ ray\_org[1]) * ray\_inv\_dir[1] * 1.00000024f;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02326}02326 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02327}02327         \textcolor{comment}{// Z}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02328}02328         \textcolor{keyword}{const} \textcolor{keywordtype}{float} tmin\_z = (min\_z -\/ ray\_org[2]) * ray\_inv\_dir[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02329}02329         \textcolor{keyword}{const} \textcolor{keywordtype}{float} tmax\_z = (max\_z -\/ ray\_org[2]) * ray\_inv\_dir[2] * 1.00000024f;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02330}02330 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02331}02331         tmin = \mbox{\hyperlink{a00474_a3253537ad2f0cdbca3f1b418007a1736}{safemax}}(tmin\_z, \mbox{\hyperlink{a00474_a3253537ad2f0cdbca3f1b418007a1736}{safemax}}(tmin\_y, \mbox{\hyperlink{a00474_a3253537ad2f0cdbca3f1b418007a1736}{safemax}}(tmin\_x, min\_t)));}
\DoxyCodeLine{\Hypertarget{a00227_source_l02332}02332         tmax = \mbox{\hyperlink{a00474_a319aa74b4c12ff9ad2a2ea634d0d4397}{safemin}}(tmax\_z, \mbox{\hyperlink{a00474_a319aa74b4c12ff9ad2a2ea634d0d4397}{safemin}}(tmax\_y, \mbox{\hyperlink{a00474_a319aa74b4c12ff9ad2a2ea634d0d4397}{safemin}}(tmax\_x, max\_t)));}
\DoxyCodeLine{\Hypertarget{a00227_source_l02333}02333 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02334}02334         \textcolor{keywordflow}{if} (tmin <= tmax) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02335}02335             (*tminOut) = tmin;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02336}02336             (*tmaxOut) = tmax;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02337}02337 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02338}02338             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02339}02339         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02340}02340         \textcolor{keywordflow}{return} \textcolor{keyword}{false};  \textcolor{comment}{// no hit}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02341}02341     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02342}02342 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02343}02343     \textcolor{keyword}{template} <>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02344}\mbox{\hyperlink{a00474_aa2274a88d11a6a83ac928c1d59be8748}{02344}}     \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a00474_aa2274a88d11a6a83ac928c1d59be8748}{IntersectRayAABB<double>}}(\textcolor{keywordtype}{double}* tminOut,  \textcolor{comment}{// [out]}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02345}02345         \textcolor{keywordtype}{double}* tmaxOut,  \textcolor{comment}{// [out]}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02346}02346         \textcolor{keywordtype}{double} min\_t, \textcolor{keywordtype}{double} max\_t,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02347}02347         \textcolor{keyword}{const} \textcolor{keywordtype}{double} bmin[3], \textcolor{keyword}{const} \textcolor{keywordtype}{double} bmax[3],}
\DoxyCodeLine{\Hypertarget{a00227_source_l02348}02348         \mbox{\hyperlink{a01443}{real3<double>}} ray\_org,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02349}02349         \mbox{\hyperlink{a01443}{real3<double>}} ray\_inv\_dir,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02350}02350         \textcolor{keywordtype}{int} ray\_dir\_sign[3]) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02351}02351         \textcolor{keywordtype}{double} tmin, tmax;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02352}02352 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02353}02353         \textcolor{keyword}{const} \textcolor{keywordtype}{double} min\_x = ray\_dir\_sign[0] ? bmax[0] : bmin[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02354}02354         \textcolor{keyword}{const} \textcolor{keywordtype}{double} min\_y = ray\_dir\_sign[1] ? bmax[1] : bmin[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02355}02355         \textcolor{keyword}{const} \textcolor{keywordtype}{double} min\_z = ray\_dir\_sign[2] ? bmax[2] : bmin[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02356}02356         \textcolor{keyword}{const} \textcolor{keywordtype}{double} max\_x = ray\_dir\_sign[0] ? bmin[0] : bmax[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02357}02357         \textcolor{keyword}{const} \textcolor{keywordtype}{double} max\_y = ray\_dir\_sign[1] ? bmin[1] : bmax[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02358}02358         \textcolor{keyword}{const} \textcolor{keywordtype}{double} max\_z = ray\_dir\_sign[2] ? bmin[2] : bmax[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02359}02359 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02360}02360         \textcolor{comment}{// X}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02361}02361         \textcolor{keyword}{const} \textcolor{keywordtype}{double} tmin\_x = (min\_x -\/ ray\_org[0]) * ray\_inv\_dir[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02362}02362         \textcolor{comment}{// MaxMult robust BVH traversal(up to 4 ulp).}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02363}02363         \textcolor{keyword}{const} \textcolor{keywordtype}{double} tmax\_x =}
\DoxyCodeLine{\Hypertarget{a00227_source_l02364}02364             (max\_x -\/ ray\_org[0]) * ray\_inv\_dir[0] * 1.0000000000000004;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02365}02365 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02366}02366         \textcolor{comment}{// Y}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02367}02367         \textcolor{keyword}{const} \textcolor{keywordtype}{double} tmin\_y = (min\_y -\/ ray\_org[1]) * ray\_inv\_dir[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02368}02368         \textcolor{keyword}{const} \textcolor{keywordtype}{double} tmax\_y =}
\DoxyCodeLine{\Hypertarget{a00227_source_l02369}02369             (max\_y -\/ ray\_org[1]) * ray\_inv\_dir[1] * 1.0000000000000004;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02370}02370 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02371}02371         \textcolor{comment}{// Z}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02372}02372         \textcolor{keyword}{const} \textcolor{keywordtype}{double} tmin\_z = (min\_z -\/ ray\_org[2]) * ray\_inv\_dir[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02373}02373         \textcolor{keyword}{const} \textcolor{keywordtype}{double} tmax\_z =}
\DoxyCodeLine{\Hypertarget{a00227_source_l02374}02374             (max\_z -\/ ray\_org[2]) * ray\_inv\_dir[2] * 1.0000000000000004;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02375}02375 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02376}02376         tmin = \mbox{\hyperlink{a00474_a3253537ad2f0cdbca3f1b418007a1736}{safemax}}(tmin\_z, \mbox{\hyperlink{a00474_a3253537ad2f0cdbca3f1b418007a1736}{safemax}}(tmin\_y, \mbox{\hyperlink{a00474_a3253537ad2f0cdbca3f1b418007a1736}{safemax}}(tmin\_x, min\_t)));}
\DoxyCodeLine{\Hypertarget{a00227_source_l02377}02377         tmax = \mbox{\hyperlink{a00474_a319aa74b4c12ff9ad2a2ea634d0d4397}{safemin}}(tmax\_z, \mbox{\hyperlink{a00474_a319aa74b4c12ff9ad2a2ea634d0d4397}{safemin}}(tmax\_y, \mbox{\hyperlink{a00474_a319aa74b4c12ff9ad2a2ea634d0d4397}{safemin}}(tmax\_x, max\_t)));}
\DoxyCodeLine{\Hypertarget{a00227_source_l02378}02378 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02379}02379         \textcolor{keywordflow}{if} (tmin <= tmax) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02380}02380             (*tminOut) = tmin;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02381}02381             (*tmaxOut) = tmax;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02382}02382 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02383}02383             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02384}02384         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02385}02385         \textcolor{keywordflow}{return} \textcolor{keyword}{false};  \textcolor{comment}{// no hit}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02386}02386     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02387}02387 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02388}02388     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02389}02389     \textcolor{keyword}{template} <\textcolor{keyword}{class} I>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02390}\mbox{\hyperlink{a01483_ab231cc4c34a80708f5f9c452a46006a0}{02390}}     \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01483_ab231cc4c34a80708f5f9c452a46006a0}{BVHAccel<T>::TestLeafNode}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01451}{BVHNode<T>}}\& node, \textcolor{keyword}{const} \mbox{\hyperlink{a01447}{Ray<T>}}\& ray,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02391}02391         \textcolor{keyword}{const} I\& intersector)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02392}02392         \textcolor{keywordtype}{bool} hit = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02393}02393 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02394}02394         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_primitives = node.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02395}02395         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} offset = node.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02396}02396 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02397}02397         T t = intersector.GetT();  \textcolor{comment}{// current hit distance}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02398}02398 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02399}02399         \mbox{\hyperlink{a01443}{real3<T>}} ray\_org;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02400}02400         ray\_org[0] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02401}02401         ray\_org[1] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02402}02402         ray\_org[2] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02403}02403 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02404}02404         \mbox{\hyperlink{a01443}{real3<T>}} ray\_dir;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02405}02405         ray\_dir[0] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02406}02406         ray\_dir[1] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02407}02407         ray\_dir[2] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02408}02408 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02409}02409         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < num\_primitives; i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02410}02410             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} prim\_idx = indices\_[i + offset];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02411}02411 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02412}02412             T local\_t = t;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02413}02413             \textcolor{keywordflow}{if} (intersector.Intersect(\&local\_t, prim\_idx)) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02414}02414                 \textcolor{comment}{// Update isect state}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02415}02415                 t = local\_t;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02416}02416 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02417}02417                 intersector.Update(t, prim\_idx);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02418}02418                 hit = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02419}02419             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02420}02420         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02421}02421 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02422}02422         \textcolor{keywordflow}{return} hit;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02423}02423     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02424}02424 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02425}02425 \textcolor{preprocessor}{\#if 0  }\textcolor{comment}{// TODO(LTE): Implement}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02426}02426     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T> \textcolor{keyword}{template}<\textcolor{keyword}{class} I, \textcolor{keyword}{class} H, \textcolor{keyword}{class} Comp>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02427}02427     \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01483}{BVHAccel<T>::MultiHitTestLeafNode}}(}
\DoxyCodeLine{\Hypertarget{a00227_source_l02428}02428         std::priority\_queue<H, std::vector<H>, Comp>* isect\_pq,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02429}02429         \textcolor{keywordtype}{int} max\_intersections,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02430}02430         \textcolor{keyword}{const} \mbox{\hyperlink{a01451}{BVHNode<T>}}\& node,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02431}02431         \textcolor{keyword}{const} \mbox{\hyperlink{a01447}{Ray<T>}}\& ray,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02432}02432         \textcolor{keyword}{const} I\& intersector)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02433}02433         \textcolor{keywordtype}{bool} hit = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02434}02434 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02435}02435         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_primitives = node.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02436}02436         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} offset = node.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02437}02437 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02438}02438         T t = std::numeric\_limits<T>::max();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02439}02439         \textcolor{keywordflow}{if} (isect\_pq-\/>size() >= \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(max\_intersections)) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02440}02440             t = isect\_pq-\/>top().t;  \textcolor{comment}{// current furthest hit distance}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02441}02441         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02442}02442 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02443}02443         real3<T> ray\_org;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02444}02444         ray\_org[0] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02445}02445         ray\_org[1] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02446}02446         ray\_org[2] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02447}02447 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02448}02448         real3<T> ray\_dir;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02449}02449         ray\_dir[0] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02450}02450         ray\_dir[1] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02451}02451         ray\_dir[2] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02452}02452 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02453}02453         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < num\_primitives; i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02454}02454             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} prim\_idx = indices\_[i + offset];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02455}02455 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02456}02456             T local\_t = t, u = 0.0f, v = 0.0f;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02457}02457 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02458}02458             \textcolor{keywordflow}{if} (intersector.Intersect(\&local\_t, \&u, \&v, prim\_idx))}
\DoxyCodeLine{\Hypertarget{a00227_source_l02459}02459             \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02460}02460                 \textcolor{comment}{// Update isect state}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02461}02461                 \textcolor{keywordflow}{if} ((local\_t > ray.\mbox{\hyperlink{a01447_a0e35bd37e6eb93f8233d903725d75de4}{min\_t}}))}
\DoxyCodeLine{\Hypertarget{a00227_source_l02462}02462                 \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02463}02463                     \textcolor{keywordflow}{if} (isect\_pq-\/>size() < \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(max\_intersections))}
\DoxyCodeLine{\Hypertarget{a00227_source_l02464}02464                     \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02465}02465                         H isect;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02466}02466                         t = local\_t;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02467}02467                         isect.t = t;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02468}02468                         isect.u = u;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02469}02469                         isect.v = v;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02470}02470                         isect.prim\_id = prim\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02471}02471                         isect\_pq-\/>push(isect);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02472}02472 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02473}02473                         \textcolor{comment}{// Update t to furthest distance.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02474}02474                         t = ray.\mbox{\hyperlink{a01447_ae36571adc2758974ef58912c4896c5e6}{max\_t}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02475}02475 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02476}02476                         hit = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02477}02477                     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02478}02478                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (local\_t < isect\_pq-\/>top().t)}
\DoxyCodeLine{\Hypertarget{a00227_source_l02479}02479                     \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02480}02480                         \textcolor{comment}{// delete furthest intersection and add new intersection.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02481}02481                         isect\_pq-\/>pop();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02482}02482 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02483}02483                         H hit;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02484}02484                         hit.t = local\_t;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02485}02485                         hit.u = u;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02486}02486                         hit.v = v;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02487}02487                         hit.prim\_id = prim\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02488}02488                         isect\_pq-\/>push(hit);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02489}02489 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02490}02490                         \textcolor{comment}{// Update furthest hit distance}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02491}02491                         t = isect\_pq-\/>top().t;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02492}02492 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02493}02493                         hit = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02494}02494                     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02495}02495                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02496}02496             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02497}02497         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02498}02498 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02499}02499         \textcolor{keywordflow}{return} hit;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02500}02500     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02501}02501 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02502}02502 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02503}02503     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02504}02504     \textcolor{keyword}{template} <\textcolor{keyword}{class} I, \textcolor{keyword}{class} H>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02505}\mbox{\hyperlink{a01483_a4d07d0fc035d860dd1bfbeaa90c14a11}{02505}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01483_a4d07d0fc035d860dd1bfbeaa90c14a11}{BVHAccel<T>::Traverse}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01447}{Ray<T>}}\& ray, \textcolor{keyword}{const} I\& intersector, H* isect,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02506}02506         \textcolor{keyword}{const} \mbox{\hyperlink{a01467}{BVHTraceOptions}}\& options)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02507}02507         \textcolor{keyword}{const} \textcolor{keywordtype}{int} kMaxStackDepth = 512;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02508}02508         (void)kMaxStackDepth;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02509}02509 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02510}02510         T hit\_t = ray.\mbox{\hyperlink{a01447_ae36571adc2758974ef58912c4896c5e6}{max\_t}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02511}02511 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02512}02512         \textcolor{keywordtype}{int} node\_stack\_index = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02513}02513         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} node\_stack[512];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02514}02514         node\_stack[0] = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02515}02515 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02516}02516         \textcolor{comment}{// Init isect info as no hit}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02517}02517         intersector.Update(hit\_t, \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(-\/1));}
\DoxyCodeLine{\Hypertarget{a00227_source_l02518}02518 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02519}02519         intersector.PrepareTraversal(ray, options);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02520}02520 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02521}02521         \textcolor{keywordtype}{int} dir\_sign[3];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02522}02522         dir\_sign[0] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[0] < \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0) ? 1 : 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02523}02523         dir\_sign[1] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[1] < \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0) ? 1 : 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02524}02524         dir\_sign[2] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[2] < \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0) ? 1 : 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02525}02525 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02526}02526         \mbox{\hyperlink{a01443}{real3<T>}} ray\_inv\_dir;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02527}02527         \mbox{\hyperlink{a01443}{real3<T>}} ray\_dir;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02528}02528         ray\_dir[0] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02529}02529         ray\_dir[1] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02530}02530         ray\_dir[2] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02531}02531 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02532}02532         ray\_inv\_dir = \mbox{\hyperlink{a00474_aa6d08ee0bfbbaa13319f31e5412111bc}{vsafe\_inverse}}(ray\_dir);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02533}02533 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02534}02534         \mbox{\hyperlink{a01443}{real3<T>}} ray\_org;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02535}02535         ray\_org[0] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02536}02536         ray\_org[1] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02537}02537         ray\_org[2] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02538}02538 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02539}02539         T min\_t = std::numeric\_limits<T>::max();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02540}02540         T max\_t = -\/std::numeric\_limits<T>::max();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02541}02541 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02542}02542         \textcolor{keywordflow}{while} (node\_stack\_index >= 0) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02543}02543             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} index = node\_stack[node\_stack\_index];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02544}02544             \textcolor{keyword}{const} \mbox{\hyperlink{a01451}{BVHNode<T>}}\& node = nodes\_[index];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02545}02545 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02546}02546             node\_stack\_index-\/-\/;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02547}02547 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02548}02548             \textcolor{keywordtype}{bool} hit = \mbox{\hyperlink{a00474_aa5a9a561d084639fafc84873ab8f3d51}{IntersectRayAABB}}(\&min\_t, \&max\_t, ray.\mbox{\hyperlink{a01447_a0e35bd37e6eb93f8233d903725d75de4}{min\_t}}, hit\_t, node.\mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}},}
\DoxyCodeLine{\Hypertarget{a00227_source_l02549}02549                 node.\mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}, ray\_org, ray\_inv\_dir, dir\_sign);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02550}02550 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02551}02551             \textcolor{keywordflow}{if} (hit) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02552}02552                 \textcolor{comment}{// Branch node}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02553}02553                 \textcolor{keywordflow}{if} (node.\mbox{\hyperlink{a01451_a21a298034fec1fe031c54bb3a6a6fa5e}{flag}} == 0) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02554}02554                     \textcolor{keywordtype}{int} order\_near = dir\_sign[node.\mbox{\hyperlink{a01451_a6988b1df6a0fc7523ea0ed099cd0495c}{axis}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02555}02555                     \textcolor{keywordtype}{int} order\_far = 1 -\/ order\_near;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02556}02556 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02557}02557                     \textcolor{comment}{// Traverse near first.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02558}02558                     node\_stack[++node\_stack\_index] = node.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[order\_far];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02559}02559                     node\_stack[++node\_stack\_index] = node.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[order\_near];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02560}02560                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02561}02561                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (TestLeafNode(node, ray, intersector)) \{  \textcolor{comment}{// Leaf node}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02562}02562                     hit\_t = intersector.GetT();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02563}02563                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02564}02564             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02565}02565         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02566}02566 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02567}02567         assert(node\_stack\_index < \mbox{\hyperlink{a00227_a02232012dcf3dea116113dd4fec7f95d}{kNANORT\_MAX\_STACK\_DEPTH}});}
\DoxyCodeLine{\Hypertarget{a00227_source_l02568}02568 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02569}02569         \textcolor{keywordtype}{bool} hit = (intersector.GetT() < ray.\mbox{\hyperlink{a01447_ae36571adc2758974ef58912c4896c5e6}{max\_t}});}
\DoxyCodeLine{\Hypertarget{a00227_source_l02570}02570         intersector.PostTraversal(ray, hit, isect);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02571}02571 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02572}02572         \textcolor{keywordflow}{return} hit;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02573}02573     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02574}02574 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02575}02575     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02576}02576     \textcolor{keyword}{template} <\textcolor{keyword}{class} I>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02577}\mbox{\hyperlink{a01483_a2669f66e17a1c33848c34dde88d1ccaa}{02577}}     \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01483_a2669f66e17a1c33848c34dde88d1ccaa}{BVHAccel<T>::TestLeafNodeIntersections}}(}
\DoxyCodeLine{\Hypertarget{a00227_source_l02578}02578         \textcolor{keyword}{const} \mbox{\hyperlink{a01451}{BVHNode<T>}}\& node, \textcolor{keyword}{const} \mbox{\hyperlink{a01447}{Ray<T>}}\& ray, \textcolor{keyword}{const} \textcolor{keywordtype}{int} max\_intersections,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02579}02579         \textcolor{keyword}{const} I\& intersector,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02580}02580         std::priority\_queue<\mbox{\hyperlink{a01475}{NodeHit<T>}}, std::vector<\mbox{\hyperlink{a01475}{NodeHit<T>}} >,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02581}02581         \mbox{\hyperlink{a01479}{NodeHitComparator<T>}} >* isect\_pq)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02582}02582         \textcolor{keywordtype}{bool} hit = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02583}02583 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02584}02584         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_primitives = node.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02585}02585         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} offset = node.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02586}02586 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02587}02587         \mbox{\hyperlink{a01443}{real3<T>}} ray\_org;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02588}02588         ray\_org[0] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02589}02589         ray\_org[1] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02590}02590         ray\_org[2] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02591}02591 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02592}02592         \mbox{\hyperlink{a01443}{real3<T>}} ray\_dir;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02593}02593         ray\_dir[0] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02594}02594         ray\_dir[1] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02595}02595         ray\_dir[2] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02596}02596 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02597}02597         intersector.PrepareTraversal(ray);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02598}02598 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02599}02599         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < num\_primitives; i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02600}02600             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} prim\_idx = indices\_[i + offset];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02601}02601 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02602}02602             T min\_t, max\_t;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02603}02603 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02604}02604             \textcolor{keywordflow}{if} (intersector.Intersect(\&min\_t, \&max\_t, prim\_idx)) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02605}02605                 \textcolor{comment}{// Always add to isect lists.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02606}02606                 \mbox{\hyperlink{a01475}{NodeHit<T>}} isect;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02607}02607                 isect.\mbox{\hyperlink{a01475_aa90100ff87025e7758063bfa091afb7a}{t\_min}} = min\_t;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02608}02608                 isect.\mbox{\hyperlink{a01475_a298cb4f48a58dc6ab54e167d4c6d4063}{t\_max}} = max\_t;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02609}02609                 isect.\mbox{\hyperlink{a01475_a28b7322499ae0aee999388858c42622d}{node\_id}} = prim\_idx;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02610}02610 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02611}02611                 \textcolor{keywordflow}{if} (isect\_pq-\/>size() < \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(max\_intersections)) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02612}02612                     isect\_pq-\/>push(isect);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02613}02613                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02614}02614                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (min\_t < isect\_pq-\/>top().t\_min) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02615}02615                     \textcolor{comment}{// delete the furthest intersection and add a new intersection.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02616}02616                     isect\_pq-\/>pop();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02617}02617 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02618}02618                     isect\_pq-\/>push(isect);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02619}02619                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02620}02620             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02621}02621         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02622}02622 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02623}02623         \textcolor{keywordflow}{return} hit;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02624}02624     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02625}02625 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02626}02626     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02627}02627     \textcolor{keyword}{template} <\textcolor{keyword}{class} I>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02628}\mbox{\hyperlink{a01483_a5f253e3bfd6bbefe21eb3c8faa881d59}{02628}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01483_a5f253e3bfd6bbefe21eb3c8faa881d59}{BVHAccel<T>::ListNodeIntersections}}(}
\DoxyCodeLine{\Hypertarget{a00227_source_l02629}02629         \textcolor{keyword}{const} \mbox{\hyperlink{a01447}{Ray<T>}}\& ray, \textcolor{keywordtype}{int} max\_intersections, \textcolor{keyword}{const} I\& intersector,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02630}02630         \mbox{\hyperlink{a01439}{StackVector}}<\mbox{\hyperlink{a01475}{NodeHit<T>}}, 128>* hits)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02631}02631         \textcolor{keyword}{const} \textcolor{keywordtype}{int} kMaxStackDepth = 512;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02632}02632 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02633}02633         T hit\_t = ray.\mbox{\hyperlink{a01447_ae36571adc2758974ef58912c4896c5e6}{max\_t}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02634}02634 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02635}02635         \textcolor{keywordtype}{int} node\_stack\_index = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02636}02636         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} node\_stack[512];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02637}02637         node\_stack[0] = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02638}02638 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02639}02639         \textcolor{comment}{// Stores furthest intersection at top}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02640}02640         std::priority\_queue<NodeHit<T>, std::vector<NodeHit<T> >,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02641}02641             \mbox{\hyperlink{a01479}{NodeHitComparator<T>}} >}
\DoxyCodeLine{\Hypertarget{a00227_source_l02642}02642             isect\_pq;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02643}02643 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02644}02644         (*hits)-\/>clear();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02645}02645 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02646}02646         \textcolor{keywordtype}{int} dir\_sign[3];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02647}02647         dir\_sign[0] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[0] < \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0) ? 1 : 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02648}02648         dir\_sign[1] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[1] < \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0) ? 1 : 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02649}02649         dir\_sign[2] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[2] < \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0) ? 1 : 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02650}02650 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02651}02651         \mbox{\hyperlink{a01443}{real3<T>}} ray\_inv\_dir;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02652}02652         \mbox{\hyperlink{a01443}{real3<T>}} ray\_dir;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02653}02653 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02654}02654         ray\_dir[0] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02655}02655         ray\_dir[1] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02656}02656         ray\_dir[2] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02657}02657 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02658}02658         ray\_inv\_dir = \mbox{\hyperlink{a00474_aa6d08ee0bfbbaa13319f31e5412111bc}{vsafe\_inverse}}(ray\_dir);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02659}02659 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02660}02660         \mbox{\hyperlink{a01443}{real3<T>}} ray\_org;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02661}02661         ray\_org[0] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02662}02662         ray\_org[1] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02663}02663         ray\_org[2] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02664}02664 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02665}02665         T min\_t, max\_t;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02666}02666 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02667}02667         \textcolor{keywordflow}{while} (node\_stack\_index >= 0) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02668}02668             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} index = node\_stack[node\_stack\_index];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02669}02669             \textcolor{keyword}{const} \mbox{\hyperlink{a01451}{BVHNode<T>}}\& node = nodes\_[\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(index)];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02670}02670 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02671}02671             node\_stack\_index-\/-\/;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02672}02672 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02673}02673             \textcolor{keywordtype}{bool} hit = \mbox{\hyperlink{a00474_aa5a9a561d084639fafc84873ab8f3d51}{IntersectRayAABB}}(\&min\_t, \&max\_t, ray.\mbox{\hyperlink{a01447_a0e35bd37e6eb93f8233d903725d75de4}{min\_t}}, hit\_t, node.\mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}},}
\DoxyCodeLine{\Hypertarget{a00227_source_l02674}02674                 node.\mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}, ray\_org, ray\_inv\_dir, dir\_sign);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02675}02675 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02676}02676             \textcolor{keywordflow}{if} (hit) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02677}02677                 \textcolor{comment}{// Branch node}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02678}02678                 \textcolor{keywordflow}{if} (node.\mbox{\hyperlink{a01451_a21a298034fec1fe031c54bb3a6a6fa5e}{flag}} == 0) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02679}02679                     \textcolor{keywordtype}{int} order\_near = dir\_sign[node.\mbox{\hyperlink{a01451_a6988b1df6a0fc7523ea0ed099cd0495c}{axis}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02680}02680                     \textcolor{keywordtype}{int} order\_far = 1 -\/ order\_near;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02681}02681 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02682}02682                     \textcolor{comment}{// Traverse near first.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02683}02683                     node\_stack[++node\_stack\_index] = node.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[order\_far];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02684}02684                     node\_stack[++node\_stack\_index] = node.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[order\_near];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02685}02685                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02686}02686                 \textcolor{keywordflow}{else} \{  \textcolor{comment}{// Leaf node}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02687}02687                     TestLeafNodeIntersections(node, ray, max\_intersections, intersector,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02688}02688                         \&isect\_pq);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02689}02689                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02690}02690             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02691}02691         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02692}02692 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02693}02693         assert(node\_stack\_index < kMaxStackDepth);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02694}02694         (void)kMaxStackDepth;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02695}02695 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02696}02696         \textcolor{keywordflow}{if} (!isect\_pq.empty()) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02697}02697             \textcolor{comment}{// Store intesection in reverse order (make it frontmost order)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02698}02698             \textcolor{keywordtype}{size\_t} n = isect\_pq.size();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02699}02699             (*hits)-\/>resize(n);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02700}02700 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02701}02701             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < n; i++) \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02702}02702                 \textcolor{keyword}{const} \mbox{\hyperlink{a01475}{NodeHit<T>}}\& isect = isect\_pq.top();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02703}02703                 (*hits)[n -\/ i -\/ 1] = isect;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02704}02704                 isect\_pq.pop();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02705}02705             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02706}02706 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02707}02707             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02708}02708         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02709}02709 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02710}02710         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02711}02711     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02712}02712 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02713}02713 \textcolor{preprocessor}{\#if 0  }\textcolor{comment}{// TODO(LTE): Implement}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02714}02714     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T> \textcolor{keyword}{template}<\textcolor{keyword}{class} I, \textcolor{keyword}{class} H, \textcolor{keyword}{class} Comp>}
\DoxyCodeLine{\Hypertarget{a00227_source_l02715}02715     \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01483}{BVHAccel<T>::MultiHitTraverse}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01447}{Ray<T>}}\& ray,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02716}02716         \textcolor{keywordtype}{int} max\_intersections,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02717}02717         \textcolor{keyword}{const} I\& intersector,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02718}02718         \mbox{\hyperlink{a01439}{StackVector<H, 128>}}* hits,}
\DoxyCodeLine{\Hypertarget{a00227_source_l02719}02719         \textcolor{keyword}{const} \mbox{\hyperlink{a01467}{BVHTraceOptions}}\& options)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02720}02720         \textcolor{keyword}{const} \textcolor{keywordtype}{int} kMaxStackDepth = 512;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02721}02721 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02722}02722         T hit\_t = ray.\mbox{\hyperlink{a01447_ae36571adc2758974ef58912c4896c5e6}{max\_t}};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02723}02723 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02724}02724         \textcolor{keywordtype}{int} node\_stack\_index = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02725}02725         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} node\_stack[512];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02726}02726         node\_stack[0] = 0;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02727}02727 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02728}02728         \textcolor{comment}{// Stores furthest intersection at top}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02729}02729         std::priority\_queue<H, std::vector<H>, Comp>  isect\_pq;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02730}02730 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02731}02731         (*hits)-\/>clear();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02732}02732 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02733}02733         \textcolor{comment}{// Init isect info as no hit}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02734}02734         intersector.Update(hit\_t, \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(-\/1));}
\DoxyCodeLine{\Hypertarget{a00227_source_l02735}02735 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02736}02736         intersector.PrepareTraversal(ray, options);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02737}02737 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02738}02738         \textcolor{keywordtype}{int} dir\_sign[3];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02739}02739         dir\_sign[0] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[0] < \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0) ? \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1) : \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02740}02740         dir\_sign[1] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[1] < \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0) ? \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1) : \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02741}02741         dir\_sign[2] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[2] < \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0.0) ? \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1) : \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02742}02742 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02743}02743         \mbox{\hyperlink{a01443}{real3<T>}} ray\_inv\_dir;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02744}02744         \mbox{\hyperlink{a01443}{real3<T>}} ray\_dir;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02745}02745 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02746}02746         ray\_dir[0] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02747}02747         ray\_dir[1] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02748}02748         ray\_dir[2] = ray.\mbox{\hyperlink{a01447_a5538d88576be3ac0175145685ac320c2}{dir}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02749}02749 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02750}02750         ray\_inv\_dir = \mbox{\hyperlink{a00474_aa6d08ee0bfbbaa13319f31e5412111bc}{vsafe\_inverse}}(ray\_dir);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02751}02751 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02752}02752         \mbox{\hyperlink{a01443}{real3<T>}} ray\_org;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02753}02753         ray\_org[0] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[0];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02754}02754         ray\_org[1] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[1];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02755}02755         ray\_org[2] = ray.\mbox{\hyperlink{a01447_aea9fcda185648fe74d64f8e6bcad01ec}{org}}[2];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02756}02756 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02757}02757         T min\_t, max\_t;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02758}02758 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02759}02759         \textcolor{keywordflow}{while} (node\_stack\_index >= 0)}
\DoxyCodeLine{\Hypertarget{a00227_source_l02760}02760         \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02761}02761             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} index = node\_stack[node\_stack\_index];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02762}02762             \textcolor{keyword}{const} \mbox{\hyperlink{a01451}{BVHNode<T>}}\& node = nodes\_[\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(index)];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02763}02763 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02764}02764             node\_stack\_index-\/-\/;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02765}02765 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02766}02766             \textcolor{keywordtype}{bool} hit = \mbox{\hyperlink{a00474_aa5a9a561d084639fafc84873ab8f3d51}{IntersectRayAABB}}(\&min\_t, \&max\_t, ray.\mbox{\hyperlink{a01447_a0e35bd37e6eb93f8233d903725d75de4}{min\_t}}, hit\_t, node.\mbox{\hyperlink{a01451_aedf8d457346c647c9eaeafc163fb7592}{bmin}},}
\DoxyCodeLine{\Hypertarget{a00227_source_l02767}02767                 node.\mbox{\hyperlink{a01451_af2fef5c1935e999a409fe8173741f7d9}{bmax}}, ray\_org, ray\_inv\_dir, dir\_sign);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02768}02768 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02769}02769             \textcolor{comment}{// branch node}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02770}02770             \textcolor{keywordflow}{if} (hit)}
\DoxyCodeLine{\Hypertarget{a00227_source_l02771}02771             \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02772}02772                 \textcolor{keywordflow}{if} (node.\mbox{\hyperlink{a01451_a21a298034fec1fe031c54bb3a6a6fa5e}{flag}} == 0)}
\DoxyCodeLine{\Hypertarget{a00227_source_l02773}02773                 \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02774}02774                     \textcolor{keywordtype}{int} order\_near = dir\_sign[node.\mbox{\hyperlink{a01451_a6988b1df6a0fc7523ea0ed099cd0495c}{axis}}];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02775}02775                     \textcolor{keywordtype}{int} order\_far = 1 -\/ order\_near;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02776}02776 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02777}02777                     \textcolor{comment}{// Traverse near first.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02778}02778                     node\_stack[++node\_stack\_index] = node.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[order\_far];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02779}02779                     node\_stack[++node\_stack\_index] = node.\mbox{\hyperlink{a01451_ac307a0b8a7a2eb48b13d28a93b6603e5}{data}}[order\_near];}
\DoxyCodeLine{\Hypertarget{a00227_source_l02780}02780                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02781}02781                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02782}02782                 \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02783}02783                     \textcolor{keywordflow}{if} (MultiHitTestLeafNode(\&isect\_pq, max\_intersections, node, ray, intersector))}
\DoxyCodeLine{\Hypertarget{a00227_source_l02784}02784                     \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02785}02785                         \textcolor{comment}{// Only update `hit\_t` when queue is full.}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02786}02786                         \textcolor{keywordflow}{if} (isect\_pq.size() >= \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(max\_intersections))}
\DoxyCodeLine{\Hypertarget{a00227_source_l02787}02787                         \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02788}02788                             hit\_t = isect\_pq.top().t;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02789}02789                         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02790}02790                     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02791}02791                 \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02792}02792             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02793}02793         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02794}02794 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02795}02795         assert(node\_stack\_index < kMaxStackDepth);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02796}02796         (void)kMaxStackDepth;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02797}02797 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02798}02798         \textcolor{keywordflow}{if} (!isect\_pq.empty())}
\DoxyCodeLine{\Hypertarget{a00227_source_l02799}02799         \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02800}02800             \textcolor{comment}{// Store intesection in reverse order (make it frontmost order)}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02801}02801             \textcolor{keywordtype}{size\_t} n = isect\_pq.size();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02802}02802             (*hits)-\/>resize(n);}
\DoxyCodeLine{\Hypertarget{a00227_source_l02803}02803 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02804}02804             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < n; i++)}
\DoxyCodeLine{\Hypertarget{a00227_source_l02805}02805             \{}
\DoxyCodeLine{\Hypertarget{a00227_source_l02806}02806                 \textcolor{keyword}{const} H\& isect = isect\_pq.top();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02807}02807                 (*hits)[n -\/ i -\/ 1] = isect;}
\DoxyCodeLine{\Hypertarget{a00227_source_l02808}02808                 isect\_pq.pop();}
\DoxyCodeLine{\Hypertarget{a00227_source_l02809}02809             \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02810}02810 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02811}02811             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02812}02812         \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02813}02813 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02814}02814         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00227_source_l02815}02815     \}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02816}02816 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02817}02817 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02818}02818 \textcolor{preprocessor}{\#ifdef \_\_clang\_\_}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02819}02819 \textcolor{preprocessor}{\#pragma clang diagnostic pop}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02820}02820 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02821}02821 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02822}02822 \}  \textcolor{comment}{// namespace nanort}}
\DoxyCodeLine{\Hypertarget{a00227_source_l02823}02823 }
\DoxyCodeLine{\Hypertarget{a00227_source_l02824}02824 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// NANORT\_H\_}}

\end{DoxyCode}
