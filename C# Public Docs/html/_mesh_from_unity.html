<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DHART: Reading a Mesh From Unity</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome-css.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DHART
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_mesh_from_unity.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Reading a Mesh From Unity </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md28">Intro</a></li>
<li class="level1"><a href="#autotoc_md29">Scene Setup</a><ul><li class="level2"><a href="#autotoc_md30">Creating the Plane</a></li>
<li class="level2"><a href="#autotoc_md31">Resetting the Plane&#39;s Position</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md32">Writing the Script</a><ul><li class="level2"><a href="#autotoc_md33">Setup for Adding References Through The Unity Inspector</a></li>
<li class="level2"><a href="#autotoc_md34">Getting a Reference to the Mesh Held by a Specific GameObject</a><ul><li class="level3"><a href="#autotoc_md35">Background on GameObjects and Components</a></li>
<li class="level3"><a href="#autotoc_md36">In Practice</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md37">Getting the Vertices and Triangles</a></li>
<li class="level2"><a href="#autotoc_md38">Transforming the Mesh From Y-Up to Z-Up</a></li>
<li class="level2"><a href="#autotoc_md39">Choose code From Previous Tutorial to Verify Results</a><ul><li class="level3"><a href="#autotoc_md40">Graph Generator</a></li>
<li class="level3"><a href="#autotoc_md41">Ray Tracer</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md42">Testing the Script</a><ul><li class="level2"><a href="#autotoc_md43">Adding References to Properties Through the Unity Inspector</a></li>
<li class="level2"><a href="#autotoc_md44">Comparing Output</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md45">Conclusion</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_src_Csharp_docs_markdown_4_reading_mesh_from_unity"></a> Previous Tutorial: <a class="el" href="_generating_a_graph.html">The Graph Generator</a></p>
<h1><a class="anchor" id="autotoc_md28"></a>
Intro</h1>
<p >In this tutorial we'll be using the project created in the first tutorial: <a class="el" href="_unity_project_setup.html">Project Setup</a>, and we'll be using concepts and code covered in the previous guides.</p>
<p >In this guide we will cover:</p>
<ul>
<li>Assigning a game object to a script so it can be referenced by code.</li>
<li>Accessing the components of a Game Object</li>
<li>Transforming MeshInfo instances to Z-Up</li>
</ul>
<h1><a class="anchor" id="autotoc_md29"></a>
Scene Setup</h1>
<p >Up until this point, we haven't needed to interact with the Unity scene, aside from attaching a script to the Main Camera object that is placed by default. For us to demonstrate reading geometry from the scene, we will use the Unity editor to create a plane in the scene that's similar to the plane we previously created in code, but half the size.</p>
<div class="image">
<img src="start_point.png" alt=""/>
<div class="caption">
Blank Scene</div></div>
    <p >To begin, open the Unity project from <a class="el" href="_unity_project_setup.html">Unity Project Setup</a>.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
Creating the Plane</h2>
<div class="image">
<img src="create_plane.png" alt=""/>
<div class="caption">
Plane Created</div></div>
    <p ><em>Figure</em> <b>4.1</b>: <em>Creating a plane using the menu bar</em></p>
<p >Using the menubar at the top of the screen select GameObject &gt; 3D Object &gt; Plane.</p>
<p >Once clicked, a new 10x10 plane will be created at the center of the scene window's view. The plane we created in code was centered on the origin, but this plane isn't since it was created where the scene editor's camera was looking. We must reset this plane to the origin before moving any further.</p>
<h2><a class="anchor" id="autotoc_md31"></a>
Resetting the Plane's Position</h2>
<div class="image">
<img src="look_at_transforms.png" alt=""/>
<div class="caption">
Transform Visible</div></div>
    <p ><em>Figure</em> <b>4.2</b>: <em>Highlighted: The plane's x,y,z position</em></p>
<p >Left Click on the newly created plane and look at <b>Transform</b> header in the Inspector located at the right sidebar.</p>
<div class="image">
<img src="reset_position.png" alt=""/>
<div class="caption">
Reset Position</div></div>
    <p ><em>Figure</em> <b>4.3</b>: <em>Resetting the plane's position</em></p>
<p >Under <b>Transform</b> you can see the plane's position, rotation and scale within the scene. To set the plane's position to the origin, left on the three dots to the right of the transform header, and select <em>Reset Position</em>.</p>
<div class="image">
<img src="resetted_plane.png" alt=""/>
<div class="caption">
Plane After Reset Position</div></div>
    <p ><em>Figure</em> <b>4.4</b>: <em>The plane centered at the scene origin</em></p>
<p >After clicking that button, your plane should be moved to the origin like in Figure 4.4. Note that the X, Y, and Z of the plane's position in the Inspector are all set to 0. Ensure that the rest of the variables in the transform header match that of Figure 4.4. Now that we have the plane ready to go, we can begin working on the script to get its vertices and triangles.</p>
<h1><a class="anchor" id="autotoc_md32"></a>
Writing the Script</h1>
<p ><img src="visual_studio_human_factors_reference.png" alt="" class="inline" title="Blank Visual Studio Page"/>     <em>Figure</em> <b>4.5</b> <em>An Empty Script</em></p>
<p >Double click on HFExampleScript that we created in the first tutorial to open up Visual Studio if it isn't open already. You should see a blank page like the above. If you're coming from a previous tutorial, <em>please clear it so it matches this</em>.</p>
<p >Just like the previous tutorials, we're going to declare which namespaces this script will use in the using section. For now we only need one using declaration. Add this to the top of your script like in the previous tutorials.</p>
<div class="fragment"><div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i_1_1_geometry.html">DHARTAPI.Geometry</a>;</div>
<div class="ttc" id="anamespace_d_h_a_r_t_a_p_i_1_1_geometry_html"><div class="ttname"><a href="namespace_d_h_a_r_t_a_p_i_1_1_geometry.html">DHARTAPI.Geometry</a></div><div class="ttdoc">Manipulate and load geometry from disk.</div><div class="ttdef"><b>Definition:</b> CommonRotations.cs:4</div></div>
</div><!-- fragment --><p >Later you will be using different sections depending on whether you're generating a graph or casting a ray.</p>
<h2><a class="anchor" id="autotoc_md33"></a>
Setup for Adding References Through The Unity Inspector</h2>
<div class="image">
<img src="plane_in_scene.PNG" alt=""/>
<div class="caption">
PlaneReference</div></div>
    <p ><em>Figure</em> <b>4.6</b>: <em>Script with a GameObject property</em></p>
<p >There are many ways to reference a GameObject in the scene from a script, but for this example we'll be setting up our script so we can select a mesh in the scene from the Unity Inspector. Add a GameObject property to the script like shown on line 7 of figure 4.6.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> GameObject PlaneInScene;</div>
</div><!-- fragment --><p >Later we'll use the Unity Inspector to assign the plane in the scene to this property.</p>
<h2><a class="anchor" id="autotoc_md34"></a>
Getting a Reference to the Mesh Held by a Specific GameObject</h2>
<p >Before we can extract the triangles and vertices from one an instance of a Unity Mesh, we first need to get a reference to the Mesh itself. Doing this requires some understanding of Unity GameObjects and their components.</p>
<h3><a class="anchor" id="autotoc_md35"></a>
Background on GameObjects and Components</h3>
<div class="image">
<img src="plane_inspector.PNG" alt=""/>
<div class="caption">
PlaneReference</div></div>
    <p ><em>Figure</em> <b>4.7</b>: <em>Components of the Plane shown in the Unity Inspector</em></p>
<p >Minimize Visual Studio then switch back to Unity for a moment. Left click on the plane we created previously, then look at the Inspector on the right sidebar. It should look similar to Figure 4.7. Here you can view all information about the plane, such as its position, the material it uses, which mesh it's referencing, etc. You'll notice the inspector is split into several sections: Transform, Meshfilter, Mesh Collider, and MeshRenderer. Each of these sections is a separate <b>Component</b> and the object we see in the scene is just a container for those components called a <a href="https://docs.unity3d.com/Manual/class-GameObject.html"><b>GameObject</b></a>.</p>
<p >As stated in the Unity Documentation:</p>
<blockquote class="doxtable">
<p >&zwj;<em>GameObjects are the fundamental objects in Unity that represent characters, props and scenery. They do not accomplish much in themselves, but they act as containers for Components, which implement the real functionality.</em> </p>
</blockquote>
<p>What this means for us is that the plane we see in the scene is not a Mesh, but a GameObject that contains a <a href="https://docs.unity3d.com/ScriptReference/MeshFilter.html">MeshFilter</a> that contains a Mesh. You can think of it like GameObject &gt; Mesh Filter &gt; Mesh. To obtain the Mesh itself, we must get it from the MeshFilter component of the Plane GameObject.</p>
<h3><a class="anchor" id="autotoc_md36"></a>
In Practice</h3>
<p >A game object's components can be retrieved using the <a href="https://docs.unity3d.com/ScriptReference/GameObject.GetComponent.html">GetComponent</a> method. Go back to the Visual Studio window. In our script we will store a reference to the plane's mesh filter in a variable named <code>PlaneFilter</code> at the beginning of the script's <code>Start()</code> function like so:</p>
<div class="fragment"><div class="line">MeshFilter PlaneFilter = PlaneInScene.GetComponent&lt;MeshFilter&gt;();</div>
</div><!-- fragment --><p >Then we can access the actual mesh carried by <code>PlaneFilter</code> by calling its .mesh property:</p>
<div class="fragment"><div class="line">Mesh PlaneMesh = PlaneFilter.mesh;</div>
</div><!-- fragment --><p >Now we have the plane as a mesh and are ready to get the required info from it for <a class="el" href="namespace_d_h_a_r_t_a_p_i.html" title="Automated analysis of the built environent">DHARTAPI</a>.</p>
<h2><a class="anchor" id="autotoc_md37"></a>
Getting the Vertices and Triangles</h2>
<p >As previously stated, a mesh is comprised of an index and vertex array. To use this mesh in <a class="el" href="namespace_d_h_a_r_t_a_p_i.html" title="Automated analysis of the built environent">DHARTAPI</a>, we need to construct a MeshInfo object using these arrays. Fortunately, Unity provides a straightforward way to access the triangle indices of a mesh in a format that we can use for <a class="el" href="namespace_d_h_a_r_t_a_p_i.html" title="Automated analysis of the built environent">DHARTAPI</a>, but unfortunately the vertices only come in an array of Vector3, instead of the array of floats that we need. We will need to write a method to convert this array of Vector3 into an array of floats before we can use it in <a class="el" href="namespace_d_h_a_r_t_a_p_i.html" title="Automated analysis of the built environent">DHARTAPI</a>.</p>
<p >To simplify the process of converting the vertices to a suitable format, we will add a separate method called <em>Vector3ArrayToFloatArray</em> that will transform the array of Vector3 into an array of float ready for Human Factors.</p>
<p >On line 9, just above the Start() function, add the following method:</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">float</span>[] Vector3ArrayToFloatArray(Vector3[] vertices)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">float</span>[] return_array = <span class="keyword">new</span> <span class="keywordtype">float</span>[vertices.Length * 3];</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; vertices.Length; i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> os = i * 3;</div>
<div class="line">        return_array[os] = vertices[i].x;</div>
<div class="line">        return_array[os + 1] = vertices[i].y;</div>
<div class="line">        return_array[os + 2] = vertices[i].z;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> return_array;</div>
<div class="line">}</div>
</div><!-- fragment --><div class="image">
<img src="flatten_vertex_array.PNG" alt=""/>
<div class="caption">
Convert Vector3 Array</div></div>
    <p ><em>Figure</em> <b>4.8</b>: <em>Location for Vector3ArrayToFloatArray</em></p>
<p >Now we can call this method with the mesh's vertices as input to get an array usable with <a class="el" href="namespace_d_h_a_r_t_a_p_i.html" title="Automated analysis of the built environent">DHARTAPI</a>. Retrieve the indices and vertices from the mesh by calling its <code>.triangles</code> and <code>.vertices</code> properties, making sure to convert the array of vertices array from an array of Vector3 to an array of floats.</p>
<div class="fragment"><div class="line"><span class="comment">// Get Triangle Indexes and Vertices from the Mesh</span></div>
<div class="line"><span class="keywordtype">int</span>[] plane_indices = PlaneMesh.triangles;</div>
<div class="line"><span class="keywordtype">float</span>[] plane_vertices = Vector3ArrayToFloatArray(PlaneMesh.vertices);</div>
</div><!-- fragment --><p >After that, the process of constructing an instance of MeshInfo is identical to the previous tutorials:</p>
<div class="fragment"><div class="line"><span class="comment">// Send to DHARTAPI</span></div>
<div class="line"><a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html">MeshInfo</a> PlaneMeshInfo = <span class="keyword">new</span> <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html">MeshInfo</a>(plane_indices, plane_vertices);</div>
<div class="ttc" id="aclass_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info_html"><div class="ttname"><a href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html">DHARTAPI.Geometry.MeshInfo</a></div><div class="ttdoc">A collection of vertices and indices representing geometry.</div><div class="ttdef"><b>Definition:</b> MeshInfo.cs:50</div></div>
</div><!-- fragment --><p >Before we can continue to using this mesh it's important to cover a significant difference between this mesh and the mesh we've been creating in our code.</p>
<h2><a class="anchor" id="autotoc_md38"></a>
Transforming the Mesh From Y-Up to Z-Up</h2>
<p ><img src="unity_coordinate_system.png" alt="" class="inline" title="UnityCoords"/>     <img src="rhino_coordinates.PNG" alt="" class="inline" title="RhinoCoords"/>    </p>
<p ><em>Figure</em> <b>4.9</b>: <em>Left: Unity's coordinate system. Right: <a class="el" href="namespace_d_h_a_r_t_a_p_i.html" title="Automated analysis of the built environent">DHARTAPI</a>'s Coordinate system</em></p>
<p >The Graph Generator expects geometry to be stored as if the Z-Axis were up as shown in the picture on the right. In Unity however, the Y-Axis is up, as shown in the left picture, meaning that we'll get inaccurate results if we use the mesh as is. To solve this, <em>MeshInfo</em> has a method <em>RotateMesh</em> that allows it to rotate itself after is has been constructed. Another class in the Geometry namespace titled <em>CommonRotations</em> contains the rotation necessary to perform this conversion.</p>
<p >Enter the following code to rotate the plane to the correct orientation:</p>
<div class="fragment"><div class="line"><span class="comment">//Rotate to Z-Up</span></div>
<div class="line">PlaneMeshInfo.<a class="code hl_function" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html#a4a7a2b8ad360f0aa81660b3e97863fa9">RotateMesh</a>(<a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_common_rotations.html">CommonRotations</a>.<a class="code hl_variable" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_common_rotations.html#a2265fdbc4a849150f58a73f06d5be92a">Yup_To_Zup</a>);</div>
<div class="ttc" id="aclass_d_h_a_r_t_a_p_i_1_1_geometry_1_1_common_rotations_html"><div class="ttname"><a href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_common_rotations.html">DHARTAPI.Geometry.CommonRotations</a></div><div class="ttdoc">A collection of rotations that are frequently useful in DHARTAPI.</div><div class="ttdef"><b>Definition:</b> CommonRotations.cs:7</div></div>
<div class="ttc" id="aclass_d_h_a_r_t_a_p_i_1_1_geometry_1_1_common_rotations_html_a2265fdbc4a849150f58a73f06d5be92a"><div class="ttname"><a href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_common_rotations.html#a2265fdbc4a849150f58a73f06d5be92a">DHARTAPI.Geometry.CommonRotations.Yup_To_Zup</a></div><div class="ttdeci">static Vector3D Yup_To_Zup</div><div class="ttdoc">Will rotate a mesh from Y-Up to Z-Up.</div><div class="ttdef"><b>Definition:</b> CommonRotations.cs:16</div></div>
<div class="ttc" id="aclass_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info_html_a4a7a2b8ad360f0aa81660b3e97863fa9"><div class="ttname"><a href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html#a4a7a2b8ad360f0aa81660b3e97863fa9">DHARTAPI.Geometry.MeshInfo.RotateMesh</a></div><div class="ttdeci">void RotateMesh(float xrot, float yrot, float zrot)</div><div class="ttdoc">Rotate this mesh by the desired magnitude.</div><div class="ttdef"><b>Definition:</b> MeshInfo.cs:165</div></div>
</div><!-- fragment --><p >Now that the plane is in the correct orientation, we are ready to move on to verifying that we loaded the mesh successfully.</p>
<h2><a class="anchor" id="autotoc_md39"></a>
Choose code From Previous Tutorial to Verify Results</h2>
<p >Up until this point, your code should match the code below.</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>System.Collections;</div>
<div class="line"><span class="keyword">using </span>System.Collections.Generic;</div>
<div class="line"><span class="keyword">using </span>UnityEngine;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i_1_1_geometry.html">DHARTAPI.Geometry</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>HFExampleScript : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> GameObject PlaneInScene;</div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">float</span>[] Vector3ArrayToFloatArray(Vector3[] vertices)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">float</span>[] return_array = <span class="keyword">new</span> <span class="keywordtype">float</span>[vertices.Length * 3];</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; vertices.Length; i++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">int</span> os = i * 3;</div>
<div class="line">            return_array[os] = vertices[i].x;</div>
<div class="line">            return_array[os + 1] = vertices[i].y;</div>
<div class="line">            return_array[os + 2] = vertices[i].z;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> return_array;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Start is called before the first frame update</span></div>
<div class="line">    <span class="keywordtype">void</span> Start()</div>
<div class="line">    {</div>
<div class="line">        MeshFilter PlaneFilter = PlaneInScene.GetComponent&lt;MeshFilter&gt;();</div>
<div class="line">        Mesh PlaneMesh = PlaneFilter.mesh;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Get Triangle Indexes and Vertices from the Mesh</span></div>
<div class="line">        <span class="keywordtype">int</span>[] plane_indices = PlaneMesh.triangles;</div>
<div class="line">        <span class="keywordtype">float</span>[] plane_vertices = Vector3ArrayToFloatArray(PlaneMesh.vertices);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Send to DHARTAPI</span></div>
<div class="line">        <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html">MeshInfo</a> PlaneMeshInfo = <span class="keyword">new</span> <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html">MeshInfo</a>(plane_indices, plane_vertices);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">//Rotate to Z-Up</span></div>
<div class="line">        PlaneMeshInfo.<a class="code hl_function" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html#a4a7a2b8ad360f0aa81660b3e97863fa9">RotateMesh</a>(<a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_common_rotations.html">CommonRotations</a>.<a class="code hl_variable" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_common_rotations.html#a2265fdbc4a849150f58a73f06d5be92a">Yup_To_Zup</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Update is called once per frame</span></div>
<div class="line">    <span class="keywordtype">void</span> Update()</div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><div class="image">
<img src="end_of_getting_mesh.png" alt=""/>
<div class="caption">
Screenshot of the entire code until this point</div></div>
    <p >To see if we're successfully reading the mesh from the scene, <em>pick either the graph generator or the raytracer tutorial to use for testing</em>. Substitute <code>PlaneMeshInfo</code> everywhere the code from the previous tutorials use <code>Plane</code>. The code you take from the other sections should be added directly after the line containing <code>PlaneMeshInfo.RotateMesh()</code>.</p>
<p >The lines you should copy for each tutorial are:</p>
<h3><a class="anchor" id="autotoc_md40"></a>
Graph Generator</h3>
<p >Add the following using statments:</p>
<div class="fragment"><div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i.html">DHARTAPI</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i_1_1_ray_tracing.html">DHARTAPI.RayTracing</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i_1_1_geometry.html">DHARTAPI.Geometry</a>;</div>
<div class="ttc" id="anamespace_d_h_a_r_t_a_p_i_1_1_ray_tracing_html"><div class="ttname"><a href="namespace_d_h_a_r_t_a_p_i_1_1_ray_tracing.html">DHARTAPI.RayTracing</a></div><div class="ttdoc">Cast rays to determine if and where they intersect geometry.</div><div class="ttdef"><b>Definition:</b> EmbreeBVH.cs:7</div></div>
<div class="ttc" id="anamespace_d_h_a_r_t_a_p_i_html"><div class="ttname"><a href="namespace_d_h_a_r_t_a_p_i.html">DHARTAPI</a></div><div class="ttdoc">Automated analysis of the built environent</div><div class="ttdef"><b>Definition:</b> CommonTypes.cs:9</div></div>
</div><!-- fragment --><p >Copy and paste lines Lines 30 - 42 from the Graph Generator tutorial:</p>
<div class="fragment"><div class="line"><span class="comment">// Generate a BVH for the RayTracer</span></div>
<div class="line"><a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_b_v_h.html">EmbreeBVH</a> bvh = <span class="keyword">new</span> <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_b_v_h.html">EmbreeBVH</a>(PlaneMeshInfo);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set Options for the Graph Generator</span></div>
<div class="line"><a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a> start_point = <span class="keyword">new</span> <a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a>(0, 0, 1);</div>
<div class="line"><a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a> spacing = <span class="keyword">new</span> <a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a>(1, 1, 1);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Generate the Graph</span></div>
<div class="line">Graph G = GraphGenerator.GenerateGraph(bvh, start_point, spacing);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get a list of nodes from the graph and print them.</span></div>
<div class="line">NodeList nodes = G.getNodes();</div>
<div class="line">Debug.Log(nodes);</div>
<div class="ttc" id="aclass_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_b_v_h_html"><div class="ttname"><a href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_b_v_h.html">DHARTAPI.RayTracing.EmbreeBVH</a></div><div class="ttdoc">A Bounding Volume Hierarchy for the EmbreeRaytracer.</div><div class="ttdef"><b>Definition:</b> EmbreeBVH.cs:31</div></div>
<div class="ttc" id="astruct_d_h_a_r_t_a_p_i_1_1_vector3_d_html"><div class="ttname"><a href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">DHARTAPI.Vector3D</a></div><div class="ttdoc">A three dimensional vector with built in utility functions.</div><div class="ttdef"><b>Definition:</b> CommonTypes.cs:40</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md41"></a>
Ray Tracer</h3>
<p >Add the following using statments:</p>
<div class="fragment"><div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i.html">DHARTAPI</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i_1_1_spatial_structures.html">DHARTAPI.SpatialStructures</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i_1_1_graph_generator.html">DHARTAPI.GraphGenerator</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i_1_1_ray_tracing.html">DHARTAPI.RayTracing</a>;</div>
<div class="ttc" id="anamespace_d_h_a_r_t_a_p_i_1_1_graph_generator_html"><div class="ttname"><a href="namespace_d_h_a_r_t_a_p_i_1_1_graph_generator.html">DHARTAPI.GraphGenerator</a></div><div class="ttdoc">Generate a graph of accessible space from a given start point.</div><div class="ttdef"><b>Definition:</b> GraphGenerator.cs:36</div></div>
<div class="ttc" id="anamespace_d_h_a_r_t_a_p_i_1_1_spatial_structures_html"><div class="ttname"><a href="namespace_d_h_a_r_t_a_p_i_1_1_spatial_structures.html">DHARTAPI.SpatialStructures</a></div><div class="ttdoc">Standard fundamental data structures for representing space used throughout DHARTAPI.</div><div class="ttdef"><b>Definition:</b> Graph.cs:20</div></div>
</div><!-- fragment --><p >Copy and paste lines 28 - 43 from the raytracer tutorial:</p>
<div class="fragment"><div class="line"><span class="comment">// Generate a BVH from the MeshInfo instance</span></div>
<div class="line"><a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_b_v_h.html">EmbreeBVH</a> bvh = <span class="keyword">new</span> <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_b_v_h.html">EmbreeBVH</a>(PlaneMeshInfo);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define origin and direction</span></div>
<div class="line"><a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a> origin = <span class="keyword">new</span> <a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a>(1, 0, 1);</div>
<div class="line"><a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a> direction = <span class="keyword">new</span> <a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a>(0, 0, -1);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Cast the ray, store the hitpoint</span></div>
<div class="line"><a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a> intersection_point = <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer.html">EmbreeRaytracer</a>.<a class="code hl_function" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer.html#a51936c4b5e5718f4fa2a7696bf7a9108">IntersectForPoint</a>(bvh, origin, direction);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Print the x, y, and z components of the intersection_point</span></div>
<div class="line">Debug.Log(</div>
<div class="line">    <span class="stringliteral">&quot;(&quot;</span> + intersection_point.<a class="code hl_variable" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#a46b34f99709c14b7d8be79cf1b0debbc">x</a> +</div>
<div class="line">    <span class="stringliteral">&quot;,&quot;</span> + intersection_point.<a class="code hl_variable" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#a15acdf142c31ca74018da12d8516a85f">y</a> +</div>
<div class="line">    <span class="stringliteral">&quot;,&quot;</span> + intersection_point.<a class="code hl_variable" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#abac3c90f7958d6d98ba3e7c81cfbd6ab">z</a> +</div>
<div class="line"><span class="stringliteral">&quot;)&quot;</span>)</div>
<div class="ttc" id="aclass_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer_html"><div class="ttname"><a href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer.html">DHARTAPI.RayTracing.EmbreeRaytracer</a></div><div class="ttdoc">Cast rays with Intel's Embree raytracing library.</div><div class="ttdef"><b>Definition:</b> EmbreeRayTracer.cs:41</div></div>
<div class="ttc" id="aclass_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer_html_a51936c4b5e5718f4fa2a7696bf7a9108"><div class="ttname"><a href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer.html#a51936c4b5e5718f4fa2a7696bf7a9108">DHARTAPI.RayTracing.EmbreeRaytracer.IntersectForPoint</a></div><div class="ttdeci">static Vector3D IntersectForPoint(EmbreeBVH bvh, float x, float y, float z, float dx, float dy, float dz, float max_distance=-1)</div><div class="ttdoc">Cast a single ray, and get a point in return if it intersects any geometry.</div></div>
<div class="ttc" id="astruct_d_h_a_r_t_a_p_i_1_1_vector3_d_html_a15acdf142c31ca74018da12d8516a85f"><div class="ttname"><a href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#a15acdf142c31ca74018da12d8516a85f">DHARTAPI.Vector3D.y</a></div><div class="ttdeci">readonly float y</div><div class="ttdoc">Y component of this vector.</div><div class="ttdef"><b>Definition:</b> CommonTypes.cs:42</div></div>
<div class="ttc" id="astruct_d_h_a_r_t_a_p_i_1_1_vector3_d_html_a46b34f99709c14b7d8be79cf1b0debbc"><div class="ttname"><a href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#a46b34f99709c14b7d8be79cf1b0debbc">DHARTAPI.Vector3D.x</a></div><div class="ttdeci">readonly float x</div><div class="ttdoc">X component of this vector.</div><div class="ttdef"><b>Definition:</b> CommonTypes.cs:41</div></div>
<div class="ttc" id="astruct_d_h_a_r_t_a_p_i_1_1_vector3_d_html_abac3c90f7958d6d98ba3e7c81cfbd6ab"><div class="ttname"><a href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#abac3c90f7958d6d98ba3e7c81cfbd6ab">DHARTAPI.Vector3D.z</a></div><div class="ttdeci">readonly float z</div><div class="ttdoc">Z component of this vector.</div><div class="ttdef"><b>Definition:</b> CommonTypes.cs:43</div></div>
</div><!-- fragment --><p ><b>Make sure to copy over any other using declarations that the selected tutorial uses</b>, since those are required for it to function. Once you've finished this, <em><b>SAVE</b></em> your script, minimize Visual Studio, and switch to the Unity Editor.</p>
<h1><a class="anchor" id="autotoc_md42"></a>
Testing the Script</h1>
<p >Like in the previous tutorials, drag the HFExampleScript onto the Main Camera object in the scene hierarchy to set it as a component. In the previous scripts we were ready to go after this step, but here we need to assign the Plane GameObject to the script in the Unity Inspector.</p>
<h2><a class="anchor" id="autotoc_md43"></a>
Adding References to Properties Through the Unity Inspector</h2>
<div class="image">
<img src="inspect_new_attribute.png" alt=""/>
<div class="caption">
Unity Inspector New Attribute</div></div>
    <p ><em>Figure</em> <b>4.10</b>: <em>Red circle: Main Camera, Highlighted: PlaneInScene Reference, Blue Circle: Assign Reference Button</em></p>
<p >Click on the Main Camera in the left under the scene hierarchy. Notice that the HF Example Script component now has a new element under it titled <em>Plane In Scene</em>. This is the class member we created earlier, and we must assign it to the Plane we created. To assign the plane to this script, click the icon to the right of <em>Plane In Scene</em> (Circled in blue in Figure 4.10).</p>
<div class="image">
<img src="gameobject_select_window.png" alt=""/>
<div class="caption">
Gameobject Select Window</div></div>
    <p ><em>Figure</em> <b>4.11</b>: <em>Gameobject Select Window</em></p>
<p >A new window will appear asking you to select a game object. Double click on Plane, highlighted in Figure 4.11, then look back at the Unity Inspector.</p>
<div class="image">
<img src="inspect_with_plane.png" alt=""/>
<div class="caption">
Gameobject Select Window</div></div>
    <p ><em>Figure</em> <b>4.12</b>: <em>Inspector With Plane</em></p>
<p >You should now see the plane in the Unity Inspector next to PlaneInScene, like in Figure 4.12. If you see this, then you have successfully added the plane to the script as a reference.</p>
<h2><a class="anchor" id="autotoc_md44"></a>
Comparing Output</h2>
<p >Now, enter play mode by clicking the play button. If you have performed the above steps correctly, then your output should match The output below for the code you've chosen:</p>
<p ><em><b>Graph Generator</b></em> : <code>[(0.000,0.000,0.000), (-1.000,-1.000,0.000), (-1.000,0.000,0.000), (-1.000,1.000,0.000), (0.000,-1.000,0.000), . . . (2.000,5.000,0.000), (3.000,5.000,0.000), (4.000,-5.000,0.000), (4.000,5.000,0.000)]</code></p>
<p ><em><b>Raytracer</b></em> : <code>(1,0,0)</code></p>
<blockquote class="doxtable">
<p >&zwj;<b>NOTE</b>: For the raytracer you might get an extremely low number for the Z component such as 5.960464E-08 instead of 0. This is normal, since none of the plane's vertices are exactly at whole numbers like they were in our example script. In fact, if you try to print any Vector3s like the ones returned from Mesh.vertices, they will round their components before displaying them. The nodelist returned from the graph will also round the components for every node it contains when converted to a string. Keep this in mind when reviewing results in the future. </p>
</blockquote>
<p>If your output matches the above output for the code you've chosen, then you have successfully completed this tutorial.</p>
<h1><a class="anchor" id="autotoc_md45"></a>
Conclusion</h1>
<p >Here is a link the full project created in this guide: <a href="Tutorial%204%20-%20Reading%20Mesh%20From%20Unity.zip">Full Project</a></p>
<p >With this you have successfully read geometry from the Unity Scene and passed it to <a class="el" href="namespace_d_h_a_r_t_a_p_i.html" title="Automated analysis of the built environent">DHARTAPI</a>. This concludes the tutorial series for this point.</p>
<p >If you want a more indepth look at using the Inspector to assign properties to components, see the <a href="https://docs.unity3d.com/Manual/EditingValueProperties.html">Official Unity Documentation</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Jul 4 2022 20:02:47 for DHART by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
