\hypertarget{a00020_source}{}\doxysection{view\+\_\+analysis.\+cpp}
\label{a00020_source}\index{Cpp/analysismethods/src/view\_analysis.cpp@{Cpp/analysismethods/src/view\_analysis.cpp}}
\mbox{\hyperlink{a00020}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{a00020_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00007}00007 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00008}00008 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00023}{view\_analysis.h}}>}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00009}00009 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00010}00010 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00011}00011 \textcolor{preprocessor}{\#include <array>}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00012}00012 \textcolor{preprocessor}{\#include <cmath>}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00013}00013 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00014}00014 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00146}{embree\_raytracer.h}}>}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00015}00015 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00170}{RayRequest.h}}>}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00016}00016 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00209}{node.h}}>}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00018}00018 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00019}00019 \textcolor{keyword}{using namespace }\mbox{\hyperlink{a00398}{HF::RayTracer}};}
\DoxyCodeLine{\Hypertarget{a00020_source_l00020}00020 \textcolor{keyword}{using }std::vector;}
\DoxyCodeLine{\Hypertarget{a00020_source_l00021}00021 \textcolor{keyword}{using }\mbox{\hyperlink{a02005}{HF::SpatialStructures::Node}};}
\DoxyCodeLine{\Hypertarget{a00020_source_l00022}00022 \textcolor{preprocessor}{\#undef min}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00023}00023 \textcolor{preprocessor}{\#undef max}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00024}\mbox{\hyperlink{a00400}{00024}} \textcolor{keyword}{namespace }\mbox{\hyperlink{a00400}{HF::ViewAnalysis}} \{}
\DoxyCodeLine{\Hypertarget{a00020_source_l00025}00025 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00027}\mbox{\hyperlink{a00400_a9dcf81751f63f5c7356a4f45159184bb}{00027}}     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{float} \mbox{\hyperlink{a00400_a9dcf81751f63f5c7356a4f45159184bb}{ConvertToRadians}}(\textcolor{keywordtype}{float} num\_in\_degrees) \{}
\DoxyCodeLine{\Hypertarget{a00020_source_l00028}00028         \textcolor{keywordflow}{return} num\_in\_degrees * (\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(M\_PI) / 180.00f);}
\DoxyCodeLine{\Hypertarget{a00020_source_l00029}00029     \}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00030}00030 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00033}\mbox{\hyperlink{a00400_a38ed3d26d2fcc4bde1790c53eda3945a}{00033}}     \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{a00400_a38ed3d26d2fcc4bde1790c53eda3945a}{Normalize}}(std::array<float, 3> \& vec) \{}
\DoxyCodeLine{\Hypertarget{a00020_source_l00034}00034         \textcolor{keywordtype}{float}\& x = vec[0];}
\DoxyCodeLine{\Hypertarget{a00020_source_l00035}00035         \textcolor{keywordtype}{float}\& y = vec[1];}
\DoxyCodeLine{\Hypertarget{a00020_source_l00036}00036         \textcolor{keywordtype}{float}\& z = vec[2];}
\DoxyCodeLine{\Hypertarget{a00020_source_l00037}00037 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00038}00038         \textcolor{keywordtype}{float} magnitude = sqrt(}
\DoxyCodeLine{\Hypertarget{a00020_source_l00039}00039             pow(x, 2) + pow(y, 2) + pow(z, 2)}
\DoxyCodeLine{\Hypertarget{a00020_source_l00040}00040         );}
\DoxyCodeLine{\Hypertarget{a00020_source_l00041}00041         vec[0] /= magnitude;}
\DoxyCodeLine{\Hypertarget{a00020_source_l00042}00042         vec[1] /= magnitude;}
\DoxyCodeLine{\Hypertarget{a00020_source_l00043}00043         vec[2] /= magnitude;}
\DoxyCodeLine{\Hypertarget{a00020_source_l00044}00044 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00045}00045     \}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00046}00046 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00062}\mbox{\hyperlink{a00400_a94327f2628a43ffe3dc4ab854e8aa20d}{00062}}     \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a00400_a94327f2628a43ffe3dc4ab854e8aa20d}{AltitudeWithinRange}}(\textcolor{keyword}{const} std::array<float, 3>\& vec, \textcolor{keywordtype}{float} max\_angle, \textcolor{keywordtype}{float} min\_angle) \{}
\DoxyCodeLine{\Hypertarget{a00020_source_l00063}00063         \textcolor{keywordtype}{float} x = vec[0]; \textcolor{keywordtype}{float} y = vec[1]; \textcolor{keywordtype}{float} z = vec[2];}
\DoxyCodeLine{\Hypertarget{a00020_source_l00064}00064         \textcolor{keywordtype}{float} r = sqrt(pow(x, 2) + pow(y, 2) + pow(z, 2));}
\DoxyCodeLine{\Hypertarget{a00020_source_l00065}00065         \textcolor{keywordtype}{float} phi = acos(z / r);}
\DoxyCodeLine{\Hypertarget{a00020_source_l00066}00066 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00067}00067         \textcolor{keywordflow}{return} (phi >= min\_angle \&\& phi <= max\_angle);}
\DoxyCodeLine{\Hypertarget{a00020_source_l00068}00068     \}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00069}00069 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00084}\mbox{\hyperlink{a00400_a5b45790c767b670bc00bf3fd2335159a}{00084}}     vector<std::array<float, 3>> \mbox{\hyperlink{a00400_a5b45790c767b670bc00bf3fd2335159a}{FibbonacciDist}}(\textcolor{keywordtype}{int} num\_points, \textcolor{keywordtype}{float} upwards\_fov, \textcolor{keywordtype}{float} downward\_fov) }
\DoxyCodeLine{\Hypertarget{a00020_source_l00085}00085     \{}
\DoxyCodeLine{\Hypertarget{a00020_source_l00086}00086 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00087}00087         \textcolor{comment}{// Convert limits to radians}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00088}00088         \textcolor{keyword}{const} \textcolor{keywordtype}{float} upperlimit = \mbox{\hyperlink{a00400_a9dcf81751f63f5c7356a4f45159184bb}{ConvertToRadians}}(upwards\_fov);}
\DoxyCodeLine{\Hypertarget{a00020_source_l00089}00089         \textcolor{keyword}{const} \textcolor{keywordtype}{float} lowerlimit = \mbox{\hyperlink{a00400_a9dcf81751f63f5c7356a4f45159184bb}{ConvertToRadians}}(downward\_fov);}
\DoxyCodeLine{\Hypertarget{a00020_source_l00090}00090 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00091}00091         \textcolor{comment}{// Calculate maximum and minimum altitude}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00092}00092         \textcolor{keyword}{const} \textcolor{keywordtype}{float} max\_phi = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(M\_PI\_2) + lowerlimit;}
\DoxyCodeLine{\Hypertarget{a00020_source_l00093}00093         \textcolor{keyword}{const} \textcolor{keywordtype}{float} min\_phi = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(M\_PI\_2) -\/ upperlimit;}
\DoxyCodeLine{\Hypertarget{a00020_source_l00094}00094 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00095}00095         \textcolor{keyword}{const} \textcolor{keywordtype}{int} n = num\_points;}
\DoxyCodeLine{\Hypertarget{a00020_source_l00096}00096         std::vector<std::array<float, 3>> out\_points;}
\DoxyCodeLine{\Hypertarget{a00020_source_l00097}00097         \textcolor{keywordtype}{float} offset = 2.0f / float(n);}
\DoxyCodeLine{\Hypertarget{a00020_source_l00098}00098         \textcolor{keyword}{const} \textcolor{keywordtype}{float} increment = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(M\_PI)* (3.0f -\/ sqrtf(5.0f));}
\DoxyCodeLine{\Hypertarget{a00020_source_l00099}00099 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00100}00100         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 5; i < n + 5; i++) \{}
\DoxyCodeLine{\Hypertarget{a00020_source_l00101}00101             \textcolor{keywordtype}{float} y = ((float(i) * offset) -\/ 1.0f) -\/ (offset / 0.2f);}
\DoxyCodeLine{\Hypertarget{a00020_source_l00102}00102             \textcolor{keywordtype}{float} r = sqrtf(1.0f -\/ powf(y, 2));}
\DoxyCodeLine{\Hypertarget{a00020_source_l00103}00103             }
\DoxyCodeLine{\Hypertarget{a00020_source_l00104}00104             \textcolor{keywordtype}{float} phi = (float(i + 1) * increment);}
\DoxyCodeLine{\Hypertarget{a00020_source_l00105}00105             \textcolor{keywordtype}{float} x = cosf(phi) * r;}
\DoxyCodeLine{\Hypertarget{a00020_source_l00106}00106             \textcolor{keywordtype}{float} z = sinf(phi) * r;}
\DoxyCodeLine{\Hypertarget{a00020_source_l00107}00107 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00108}00108             \textcolor{comment}{// Check for nans. These can sometimes occur at the beginning and end of the result set}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00109}00109             \textcolor{comment}{// due to imprecision.}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00110}00110             \textcolor{keywordflow}{if} (!isnan(x) \&\& !isnan(y) \&\& !isnan(z)) \{}
\DoxyCodeLine{\Hypertarget{a00020_source_l00111}00111                 \textcolor{keyword}{auto} new\_point = std::array<float, 3>\{x, y, z\};}
\DoxyCodeLine{\Hypertarget{a00020_source_l00112}00112                 \mbox{\hyperlink{a00400_a38ed3d26d2fcc4bde1790c53eda3945a}{Normalize}}(new\_point);}
\DoxyCodeLine{\Hypertarget{a00020_source_l00113}00113                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{a00400_a94327f2628a43ffe3dc4ab854e8aa20d}{AltitudeWithinRange}}(new\_point, max\_phi, min\_phi))}
\DoxyCodeLine{\Hypertarget{a00020_source_l00114}00114                     out\_points.emplace\_back(new\_point);}
\DoxyCodeLine{\Hypertarget{a00020_source_l00115}00115             \}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00116}00116         \}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00117}00117         \textcolor{keywordflow}{return} out\_points;}
\DoxyCodeLine{\Hypertarget{a00020_source_l00118}00118 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00119}00119     \}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00120}00120 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00121}\mbox{\hyperlink{a00393_ga6ca336e3887ef82d17b0713c2bf862df}{00121}}     vector<std::array<float, 3>> \mbox{\hyperlink{a00393_ga6ca336e3887ef82d17b0713c2bf862df}{FibbonacciDistributePoints}}(\textcolor{keywordtype}{int} num\_points, \textcolor{keywordtype}{float} upwards\_fov, \textcolor{keywordtype}{float} downward\_fov)}
\DoxyCodeLine{\Hypertarget{a00020_source_l00122}00122     \{}
\DoxyCodeLine{\Hypertarget{a00020_source_l00123}00123         \textcolor{comment}{// Generate initial set of directions}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00124}00124         \textcolor{keyword}{auto} out\_points = \mbox{\hyperlink{a00400_a5b45790c767b670bc00bf3fd2335159a}{FibbonacciDist}}(num\_points, upwards\_fov, downward\_fov);}
\DoxyCodeLine{\Hypertarget{a00020_source_l00125}00125         }
\DoxyCodeLine{\Hypertarget{a00020_source_l00126}00126         \textcolor{comment}{// Calculate a percentage of points discarded. }}
\DoxyCodeLine{\Hypertarget{a00020_source_l00127}00127         \textcolor{keywordtype}{int} points\_removed = num\_points -\/ out\_points.size();}
\DoxyCodeLine{\Hypertarget{a00020_source_l00128}00128         \textcolor{keywordtype}{double} percent\_removed = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(points\_removed) / \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(num\_points);}
\DoxyCodeLine{\Hypertarget{a00020_source_l00129}00129 }
\DoxyCodeLine{\Hypertarget{a00020_source_l00130}00130         \textcolor{comment}{// Calculate a new total based on percentage of points removed}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00131}00131         \textcolor{keywordtype}{int} new\_out\_points = (num\_points / (1.0 -\/ percent\_removed));}
\DoxyCodeLine{\Hypertarget{a00020_source_l00132}00132         }
\DoxyCodeLine{\Hypertarget{a00020_source_l00133}00133         \textcolor{comment}{// Generate a set of points with the new total.}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00134}00134         out\_points.clear();}
\DoxyCodeLine{\Hypertarget{a00020_source_l00135}00135         \textcolor{keywordflow}{return} \mbox{\hyperlink{a00400_a5b45790c767b670bc00bf3fd2335159a}{FibbonacciDist}}(new\_out\_points, upwards\_fov, downward\_fov);}
\DoxyCodeLine{\Hypertarget{a00020_source_l00136}00136     \}}
\DoxyCodeLine{\Hypertarget{a00020_source_l00137}00137 \}}

\end{DoxyCode}
